!function(){return function r(e,t,n){function o(s,a){if(!t[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=t[s]={exports:{}};e[s][0].call(d.exports,function(t){return o(e[s][1][t]||t)},d,d.exports,r,e,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}}()({1:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("wildemitter"),s=e("loglevel"),o=e("./nexmoClientError"),a=n(e("./user")),c=n(e("./conversation")),u=n(e("./modules/nxmCall")),d=n(e("./handlers/sip_events")),l=n(e("./handlers/rtc_events")),p=n(e("./handlers/application_events")),h=n(e("./utils")),f=n(e("./pages/page_config")),m=n(e("./pages/conversations_page")),g=n(e("./pages/user_sessions_page")),v=e("./handlers/events_queue"),y=n(e("./member"));let b=null,_=null,w=null;class Application{constructor(e,t){this.log=s.getLogger(this.constructor.name),this.session=e,this.conversations=new Map,this.synced_conversations_count=0,this.start_sync_time=0,this.stop_sync_time=0,this.calls=new Map,this._call_draft_list=new Map,this.pageConfig=new f.default((e.config||{}).conversations_page_config),this.conversations_page_last=null,this.activeStreams=[],b=new d.default(this),_=new l.default(this),w=new p.default(this),this.me=null,Object.assign(this,t),i.mixin(Application)}updateOrCreateConversation(e){const t=this.conversations.get(e.id);return t?(t._updateObjectInstance(e),this.conversations.set(e.id,t)):this.conversations.set(e.id,new c.default(this,e)),this.conversations.get(e.id)}async _enqueueEvent(e){this.session.config.enableEventsQueue?(this.eventsQueue||(this.eventsQueue=new v.EventsQueue(e=>this._handleEvent(e))),this.eventsQueue.enqueue(e,this)):this._handleEvent(e)}async _handleEvent(e){var t,r,n,i,s,o,a;const c=(null===(t=e._embedded)||void 0===t?void 0:t.from_user)?(null===(n=null===(r=e._embedded)||void 0===r?void 0:r.from_user)||void 0===n?void 0:n.id)===(null===(i=this.me)||void 0===i?void 0:i.id):(null===(o=null===(s=e.body)||void 0===s?void 0:s.user)||void 0===o?void 0:o.user_id)===(null===(a=this.me)||void 0===a?void 0:a.id),u=h.default._checkIfUserIsReInvited(this.conversations,e);if(e.type.startsWith("sip"))return b._handleSipCallEvent(e),e;if(this.conversations.has(e.cid)&&"rtc:transfer"!==e.type&&!u)return e.type.startsWith("rtc")&&_._handleRtcEvent(e),this.conversations.get(e.cid)._handleEvent(e),"member:joined"!==e.type&&"member:invited"!==e.type||!c||this._handleApplicationEvent(e),e;if(e.cid)try{let t;return u&&this.conversations.delete(e.cid),t=h.default._isCallEvent(e)?await this.getConversation(e.cid,Application.CONVERSATION_API_VERSION.v1):await this.getConversation(e.cid,Application.CONVERSATION_API_VERSION.v3),this.conversations.set(e.cid,t),await t._handleEvent(e),await this._handleApplicationEvent(e),e.type.startsWith("rtc")&&_._handleRtcEvent(e),Promise.resolve(e)}catch(e){return this.log.error(e),Promise.reject(e)}}async updateToken(e){if(this.session.connection&&this.session.connection.disconnected)return this.session.config.token=e,this.session.connection.io.opts.query.token=e,Promise.resolve();const t={url:`${this.session.config.nexmo_api_url}/v0.2/sessions/${this.session.session_id}`,type:"PUT",token:e};try{await h.default.networkRequest(t),this.me&&(this.session.config.token=e,this.session.connection.io.opts.query.token=e)}catch(e){throw new o.NexmoApiError(e)}}async _handleApplicationEvent(e){try{this.log.debug("_handleApplicationEvent: ",{event:e});const t=w.handleEvent(e),r=this.conversations.get(e.cid);let n;if(r.members.has((t||{}).from))n=r.members.get(t.from);else if("member:joined"===e.type||"member:invited"===e.type){const t={...e.body,...e.from&&{member_id:e.from}};n=new y.default(r,t)}else try{n=await r.getMember(t.from)}catch(e){this.log.warn(`There is an error getting the member ${e}`)}return this.emit(t.type,n,t),e}catch(e){throw this.log.error("_handleApplicationEvent: ",e),e}}async inAppCall(e){if(!e||!Array.isArray(e)||0===e.length)return Promise.reject(new o.NexmoClientError("error:application:call:params"));try{const t=new u.default(this);return await t.createCall(e),t.direction=t.CALL_DIRECTION.OUTBOUND,t}catch(e){throw e}}async callServer(e,t="phone",r={}){try{const n=new u.default(this);return n.direction=n.CALL_DIRECTION.OUTBOUND,await n.createServerCall(e,t,r),n}catch(e){throw e}}async reconnectCall(e,t,r={}){try{if(!e||!t)throw new o.NexmoClientError("error:missing:params");const n=await this.getConversation(e,Application.CONVERSATION_API_VERSION.v1);await n.media.enable({...r,reconnectRtcId:t});const i=new u.default(this,n),s=Array.from(n.events.values()).map(e=>e.type);return s.includes("sip:answered")?i.status=i.CALL_STATUS.ANSWERED:s.includes("sip:ringing")?i.status=i.CALL_STATUS.RINGING:i.status=i.CALL_STATUS.STARTED,i.rtcObjects=n.media.rtcObjects,this.calls.set(n.id,i),i}catch(e){throw e}}async newConversation(e={}){try{const t=await this.session.sendNetworkRequest({type:"POST",path:"conversations",data:e}),r=new c.default(this,t);return this.conversations.set(r.id,r),this.getConversation(r.id,Application.CONVERSATION_API_VERSION.v1)}catch(e){throw new o.NexmoApiError(e)}}async newConversationAndJoin(e){const t=await this.newConversation(e);return await t.join(),t}async getConversation(e,t=Application.CONVERSATION_API_VERSION.v3){if(t!==Application.CONVERSATION_API_VERSION.v1&&t!==Application.CONVERSATION_API_VERSION.v3)throw new o.NexmoClientError("error:conversation-service:version");let r;if(t===Application.CONVERSATION_API_VERSION.v1)try{(r=await this.session.sendNetworkRequest({type:"GET",path:`conversations/${e}`})).id=r.uuid,delete r.uuid}catch(e){throw new o.NexmoApiError(e)}else try{r=await this.session.sendNetworkRequest({type:"GET",path:`conversations/${e}`,version:"v0.3"})}catch(e){throw new o.NexmoApiError(e)}const n=this.updateOrCreateConversation(r);if(t===Application.CONVERSATION_API_VERSION.v3&&!n.me)try{const e=await n.getMyMember();n.me=e,n.members.set(e.id,e)}catch(e){try{const e=await n.getMyMember();n.me=e,n.members.set(e.id,e)}catch(e){this.log.warn(`You don't have any membership in ${n.id}`)}}if("full"===this.session.config.sync){const{items:e}=await n.getEvents();return n.events=e,n}return n}async getConversations(e={}){const t=`${this.session.config.nexmo_api_url}/beta2/users/${this.me.id}/conversations`;let r=0===Object.keys(e).length?this.pageConfig:new f.default(e);try{const e=await h.default.paginationRequest(t,r,this.session.config.token);e.application=this;const n=new m.default(e);return this.conversations_page_last=n,n}catch(e){throw new o.NexmoApiError(e)}}syncConversations(e){const t=Array.from(e.values()),r=t.length,n=new Date;this.start_sync_time="undefined"!=typeof window&&window.performance?window.performance.now():n.getTime();const i=async()=>{this.synced_conversations_percentage=Number((this.synced_conversations_count/r*100).toFixed(2));const e={sync_progress:this.synced_conversations_percentage};if(this.emit("sync:progress",e),this.log.info("Loading sync progress: "+this.synced_conversations_count+"/"+r+" - "+this.synced_conversations_percentage+"%"),this.synced_conversations_percentage>=100){const e=new Date;this.stop_sync_time="undefined"!=typeof window&&window.performance?window.performance.now():e.getTime(),this.log.info("Loaded conversations in "+(this.stop_sync_time-this.start_sync_time)+"ms")}this.synced_conversations_count<r&&(await this.getConversation(t[this.synced_conversations_count].id),i(),this.synced_conversations_count++,this.sync_progress_buffer++)};i()}async getUser(e=this.me.id){try{const t=await this.session.sendNetworkRequest({type:"GET",path:`users/${e}`});return new a.default(this,t)}catch(e){throw new o.NexmoApiError(e)}}async getUserSessions(e={}){var t;const r=(null===(t=e)||void 0===t?void 0:t.user_id)||this.me.id,n=`${this.session.config.nexmo_api_url}/v0.3/users/${r}/sessions`;let i=0===Object.keys(e).length?this.pageConfig:new f.default(e);try{const e=await h.default.paginationRequest(n,i,this.session.config.token,Application.CONVERSATION_API_VERSION.v3);e.application=this;const t=new g.default(e);return this.user_sessions_page_last=t,t}catch(e){throw new o.NexmoApiError(e)}}}r.default=Application,Application.CONVERSATION_API_VERSION={v1:"v0.1",v3:"v0.3"},t.exports=Application},{"./conversation":2,"./handlers/application_events":7,"./handlers/events_queue":9,"./handlers/rtc_events":10,"./handlers/sip_events":11,"./member":13,"./modules/nxmCall":16,"./nexmoClientError":20,"./pages/conversations_page":22,"./pages/page_config":26,"./pages/user_sessions_page":27,"./user":29,"./utils":31,loglevel:63,wildemitter:107}],2:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("wildemitter"),s=e("loglevel"),o=e("./nexmoClientError"),a=n(e("./member")),c=n(e("./events/nxmEvent")),u=n(e("./events/text_event")),d=n(e("./events/message_event")),l=n(e("./modules/media")),p=n(e("./handlers/conversation_events")),h=n(e("./utils")),f=n(e("./pages/page_config")),m=n(e("./pages/events_page")),g=n(e("./pages/members_page")),v=n(e("./application"));class Conversation{constructor(e,t){this.log=s.getLogger(this.constructor.name),this.application=e,this.id=null,this.name=null,this.display_name=null,this.timestamp=null,this.members=new Map,this.events=new Map,this.sequence_number=0,this.pageConfig=new f.default(((this.application.session||{}).config||{}).events_page_config),this.events_page_last=null,this.members_page_last=null,this.conversationEventHandler=new p.default(e,this),this.media=new l.default(this),this.me=null,this._updateObjectInstance(t),i.mixin(Conversation)}_updateObjectInstance(e){for(let t in e)switch(t){case"id":this.id=e.id;break;case"name":this.name=e.name;break;case"display_name":this.display_name=e.display_name;break;case"members":e.members.forEach(e=>{if(this.members.has(e.member_id))this.members.get(e.member_id)._normalise(e),e.user_id===this.application.me.id&&"LEFT"!==e.state&&(this.me=this.members.get(e.member_id),this.members.set(this.me.id,this.me));else{const t=new a.default(this,e);e.user_id===this.application.me.id&&"LEFT"!==e.state&&(this.me=t),this.members.set(t.id,t)}});break;case"timestamp":this.timestamp=e.timestamp;break;case"sequence_number":this.sequence_number=e.sequence_number;break;case"member_id":const r={id:e.member_id,state:e.state,user:this.application.me};if(this.members.has(e.member_id)){const t=this.members.get(e.member_id);Object.assign(t,r)}else{const e=new a.default(this,r);this.me=e,this.members.set(e.id,e)}}}async join(e){var t,r;try{let n={state:"joined",channel:{type:"app"},user:{...!e&&{name:this.application.me.name,id:this.application.me.id},...e&&e.user_name&&{name:e.user_name},...e&&e.user_id&&{id:e.user_id}}};(null===(t=null===this||void 0===this?void 0:this.me)||void 0===t?void 0:t.id)&&"LEFT"!==(null===(r=null===this||void 0===this?void 0:this.me)||void 0===r?void 0:r.state)&&(n.from=this.me.id);const i=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/members`,version:"v0.3",data:n}),s=new a.default(this,i);return i._embedded.user.id===this.application.me.id&&(this.me=s,this.members.set(s.id,s)),this.application.getConversation(this.id,v.default.CONVERSATION_API_VERSION.v3),s}catch(e){throw new o.NexmoApiError(e)}}async del(){try{const e=await this.application.session.sendNetworkRequest({type:"DELETE",path:`conversations/${this.id}`});return this.application.conversations.delete(this.id),e}catch(e){throw new o.NexmoApiError(e)}}deleteEvent(e){return e.del()}async invite(e){var t,r;if(!e||!e.id&&!e.user_name)throw new o.NexmoClientError("error:invite:missing:params");const n={state:"invited",user:{...e.id&&{id:e.id},...e.user_name&&{name:e.user_name}},media:e.media,channel:{from:{type:"app"},to:{type:"app"},type:"app"}};(null===(t=null===this||void 0===this?void 0:this.me)||void 0===t?void 0:t.id)&&"LEFT"!==(null===(r=null===this||void 0===this?void 0:this.me)||void 0===r?void 0:r.state)&&(n.from=this.me.id);try{const e=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/members`,version:"v0.3",data:n});return new a.default(this,e)}catch(e){throw new o.NexmoApiError(e)}}inviteWithAudio(e){return e&&(e.id||e.user_name)?(e.media={audio_settings:{enabled:!0,muted:!1,earmuffed:!1}},this.invite(e)):Promise.reject(new o.NexmoClientError("error:invite:missing:params"))}leave(e){return this.me.kick(e)}async sendText(e){try{if(null===this.me)throw new o.NexmoClientError("error:self");const t={type:"text",cid:this.id,from:this.me.id,body:{text:e}},{id:r,timestamp:n}=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:t});return t.id=r,t.body.timestamp=n,new u.default(this,t)}catch(e){throw new o.NexmoApiError(e)}}async sendCustomEvent({type:e,body:t}){try{if(null===this.me)throw new o.NexmoClientError("error:self");if(!e||"string"!=typeof e||e.length<1)throw new o.NexmoClientError("error:custom-event:invalid");const r={type:`custom:${e}`,cid:this.id,from:this.me.id,body:t},{id:n,timestamp:i}=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:r});return r.id=n,r.timestamp=i,new c.default(this,r)}catch(e){throw new o.NexmoApiError(e)}}async sendEphemeralEvent(e){try{if(null===this.me)throw new o.NexmoClientError("error:self");const t={type:"ephemeral",cid:this.id,from:this.me.id,body:e},{id:r,timestamp:n}=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:t});return t.timestamp=n,new c.default(this,t)}catch(e){throw new o.NexmoApiError(e)}}async uploadImage(e,t={quality_ratio:"100",medium_size_ratio:"50",thumbnail_size_ratio:"30"}){const r=new FormData;r.append("file",e),r.append("quality_ratio",t.quality_ratio),r.append("medium_size_ratio",t.medium_size_ratio),r.append("thumbnail_size_ratio",t.thumbnail_size_ratio);const n=await h.default.networkRequest({type:"POST",url:this.application.session.config.ips_url,data:r,token:this.application.session.config.token});return n.upload.addEventListener("progress",e=>{e.lengthComputable&&this.log.debug("uploading image "+e.loaded+"/"+e.total)},!1),n.onreadystatechange=(()=>{200!==n.status&&this.log.error(n)}),n}async sendImage(e,t={quality_ratio:"100",medium_size_ratio:"50",thumbnail_size_ratio:"30"}){const r=await this.uploadImage(e,t);return r.onreadystatechange=(()=>{if(4===r.readyState&&200===r.status)try{this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:{type:"image",from:this.me.id,body:{representations:JSON.parse(r.responseText)}}}),this.log.info(r)}catch(e){this.log.error(new o.NexmoApiError(e))}}),r}abortSendImage(e){return e instanceof XMLHttpRequest?e.abort():new o.NexmoClientError("error:invalid:param:type")}async sendMessage(e){if(null===this.me)throw new o.NexmoClientError("error:self");if(!(null===e||void 0===e?void 0:e.message_type))throw new o.NexmoClientError("error:message-event:invalid");try{const t={type:"message",cid:this.id,from:this.me.id,body:{...e}},{id:r,timestamp:n}=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:t});return t.id=r,t.body.timestamp=n,new d.default(this,t)}catch(e){throw new o.NexmoApiError(e)}}async _typing(e){const t={activity:"on"===e?1:0},r={type:"text:typing:"+e,cid:this.id,from:this.me.id,body:t};try{return await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:r}),`text:typing:${e}:success`}catch(e){throw new o.NexmoApiError(e)}}startTyping(){return this._typing("on")}stopTyping(){return this._typing("off")}async getEvents(e={}){const t=`${this.application.session.config.nexmo_api_url}/beta2/conversations/${this.id}/events`;let r=0===Object.keys(e).length?this.pageConfig:new f.default(e);try{const e=await h.default.paginationRequest(t,r,this.application.session.config.token);e.application=this.application,e.conversation=this;const n=new m.default(e);return this.events_page_last=n,n}catch(e){throw new o.NexmoApiError(e)}}async getMembers(e={}){const t=`${this.application.session.config.nexmo_api_url}/beta2/conversations/${this.id}/members`;let r=0===Object.keys(e).length?this.pageConfig:new f.default(e);try{const e=await h.default.paginationRequest(t,r,this.application.session.config.token);e.application=this.application,e.conversation=this;const n=new g.default(e);return this.members_page_last=n,n}catch(e){throw new o.NexmoApiError(e)}}async getMyMember(){try{const e=await this.application.session.sendNetworkRequest({type:"GET",path:`conversations/${this.id}/members/me`,version:"v0.3"});return new a.default(this,e)}catch(e){throw new o.NexmoApiError(e)}}async getMember(e){try{const t=await this.application.session.sendNetworkRequest({type:"GET",path:`conversations/${this.id}/members/${e}`,version:"v0.3"});return new a.default(this,t)}catch(e){throw new o.NexmoApiError(e)}}_handleEvent(e){var t,r;if(e.type.startsWith("rtc"))return this.emit(e.type,e),Promise.resolve(e);this.sequence_number++,e.body&&e.body.event_id&&"string"==typeof e.body.event_id&&(e.body.event_id=parseInt(e.body.event_id));let n={memberId:e.from};if(null===(t=null===e||void 0===e?void 0:e.body)||void 0===t?void 0:t.user){const{id:t,name:r,display_name:i,image_url:s,custom_data:o}=e.body.user;n={...n,...{...t&&{userId:t},...r&&{userName:r},...i&&{displayName:i},...s&&{imageUrl:s},...o&&{customData:o}}}}else if(null===(r=null===e||void 0===e?void 0:e._embedded)||void 0===r?void 0:r.from_user){const{id:t,name:r,display_name:i,image_url:s,custom_data:o}=e._embedded.from_user;n={...n,...{...t&&{userId:t},...r&&{userName:r},...i&&{displayName:i},...s&&{imageUrl:s},...o&&{customData:o}}}}let i=this.conversationEventHandler.handleEvent(e);return["text:typing:on","text:typing:off","ephemeral"].includes(e.type)||this.events.set(i.id,i),e.type.startsWith("custom:")?(this.emit(i.type,n,i),Promise.resolve(e)):(this.emit(e.type,n,i),Promise.resolve(e))}}r.default=Conversation,t.exports=Conversation},{"./application":1,"./events/message_event":4,"./events/nxmEvent":5,"./events/text_event":6,"./handlers/conversation_events":8,"./member":13,"./modules/media":15,"./nexmoClientError":20,"./pages/events_page":23,"./pages/members_page":24,"./pages/page_config":26,"./utils":31,loglevel:63,wildemitter:107}],3:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("../utils")),s=e("loglevel"),o=n(e("./nxmEvent"));class ImageEvent extends o.default{constructor(e,t){super(e,t),this.log=s.getLogger(this.constructor.name),this.type="image",this.conversation=e,this.state={seen_by:{},delivered_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}async del(){return await i.default.networkRequest({type:"DELETE",url:this.body.representations.original.url,token:this.conversation.application.session.config.token}),super.del()}async fetchImage(e="thumbnail",t=this.body.representations){try{return i.default._fetchImage(t[e].url,this.conversation.application.session.config.token)}catch(e){throw this.log.error(e),e}}}r.default=ImageEvent,t.exports=ImageEvent},{"../utils":31,"./nxmEvent":5,loglevel:63}],4:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("loglevel"),s=n(e("../utils")),o=n(e("./nxmEvent")),a=e("../nexmoClientError");class MessageEvent extends o.default{constructor(e,t){super(e,t),this.log=i.getLogger(this.constructor.name),this.type="message",this.conversation=e,this.state={seen_by:{},delivered_to:{},submitted_to:{},rejected_by:{},undeliverable_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}del(){return super.del()}async fetchImage(){if("image"!==this.body.message_type)throw new a.NexmoClientError("error:message-event:invalid");try{return s.default._fetchImage(this.body.image.url,this.conversation.application.session.config.token)}catch(e){throw this.log.error(e),e}}}r.default=MessageEvent,t.exports=MessageEvent},{"../nexmoClientError":20,"../utils":31,"./nxmEvent":5,loglevel:63}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("wildemitter"),i=e("../nexmoClientError");class NXMEvent{constructor(e,t){var r,i,s,o;if(this.conversation=e,t)for(const e in t)switch(e){case"type":t.type.startsWith("custom:")?this.type=t.type.replace("custom:",""):this.type=t.type;break;case"application_id":this.application_id=t.application_id;break;case"cid":this.cid=t.cid;break;case"from":["member:invited","member:joined","member:left"].indexOf(t.type)>-1?(null===(i=null===(r=t._embedded)||void 0===r?void 0:r.from_member)||void 0===i?void 0:i.id)&&(this.from=null===(o=null===(s=t._embedded)||void 0===s?void 0:s.from_member)||void 0===o?void 0:o.id):this.from=t.from;break;case"timestamp":this.timestamp=t.timestamp;break;case"id":this.id=t.id;break;case"state":this.state=t.state;break;case"index":this.index=t.index;break;case"streamIndex":this.streamIndex=t.streamIndex;break;case"body":this.body=t.body,this.body.user&&this.body.user.user_id&&(this.body.user.id=this.body.user.user_id,delete this.body.user.user_id),this.body.digit&&(this.digit=this.body.digit,delete this.body.digit),this.body.digits&&(this.digit=this.body.digits,delete this.body.digits)}n.mixin(NXMEvent)}async del(e=this.id){try{return void await this.conversation.application.session.sendNetworkRequest({type:"DELETE",path:`conversations/${this.conversation.id}/events/${e}?from=${this.conversation.me.id}`,version:"beta2"})}catch(e){throw new i.NexmoApiError(e)}}async delivered(e=this.id){if("text"!==this.type&&"image"!==this.type&&"message"!==this.type&&(this.type="event"),this.conversation.me.id===this.from)throw new i.NexmoClientError("error:delivered:own-message");if(this.state&&this.state.delivered_to&&this.state.delivered_to[this.conversation.me.id])throw new i.NexmoClientError("error:already-delivered");try{return void await this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.conversation.id}/events`,data:{type:`${this.type}:delivered`,from:this.conversation.me.id,body:{event_id:e}}})}catch(e){throw new i.NexmoApiError(e)}}async seen(e=this.id){if("text"!==this.type&&"image"!==this.type&&"message"!==this.type&&(this.type="event"),this.conversation.me.id===this.from)throw new i.NexmoClientError("error:seen:own-message");if(this.state&&this.state.seen_by&&this.state.seen_by[this.conversation.me.id])throw new i.NexmoClientError("error:already-seen");try{return void await this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.conversation.id}/events`,data:{type:`${this.type}:seen`,from:this.conversation.me.id,body:{event_id:e}}})}catch(e){throw new i.NexmoApiError(e)}}}r.default=NXMEvent,t.exports=NXMEvent},{"../nexmoClientError":20,wildemitter:107}],6:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("./nxmEvent"));class TextEvent extends i.default{constructor(e,t){super(e,t),this.type="text",this.conversation=e,this.state={seen_by:{},delivered_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}del(){return super.del()}}r.default=TextEvent,t.exports=TextEvent},{"./nxmEvent":5}],7:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("loglevel"),s=n(e("../events/nxmEvent")),o=n(e("../modules/nxmCall")),a=n(e("../utils")),c=n(e("../modules/rtc_helper"));class ApplicationEventsHandler{constructor(e){this.log=i.getLogger(this.constructor.name),this.application=e,this._handleApplicationEventMap={"member:joined":this._processMemberJoined,"member:invited":this._processMemberInvited}}handleEvent(e){const t=this.application.conversations.get(e.cid),r=Object.assign({},e);return this._handleApplicationEventMap.hasOwnProperty(e.type)?this._handleApplicationEventMap[e.type].call(this,t,new s.default(t,r),e):new s.default(t,r)}_processMemberJoined(e,t,r){try{if(t.body.channel&&this.application._call_draft_list.has(t.body.channel.id)){this.log.debug("_processMemberJoined: outbound serverCall from sdk",{event:t});const r=this.application._call_draft_list.get(t.body.channel.id);let n=((r.rtcObjects||{})[t.body.channel.id]||{}).pc;if(r._setFrom(e.me),r._setupConversationObject(e,t.body.channel.id),e.media._attachEndingEventHandlers(),0===Object.entries(e.media.rtcObjects).length&&0!==Object.entries(r.rtcObjects).length&&Object.assign(e.media.rtcObjects,r.rtcObjects),!e.media.pc&&n&&Object.assign(e.media.pc=n),0===e.application.activeStreams.length&&r.application.activeStreams.length>0&&(e.application.activeStreams=r.application.activeStreams),delete r.client_ref,delete r.knocking_id,r.rtcStats&&(e.media.rtcStats=r.rtcStats),this.application._call_draft_list.delete(t.body.channel.id),this.application.calls.set(e.id,r),r._handleStatusChange(t),this.log.debug("_processMemberJoined: processedCall ",{nxmCall:r}),e.members&&t.body.member_id){const n=e.members.get(t.body.member_id);n&&this.application.emit("member:call",n,r)}setTimeout(()=>{(null===e||void 0===e?void 0:e.me)&&c.default.emitMediaStream(e.me,n,r.stream)},200)}return this.log.debug("_processMemberJoined: default member joined: ",{event:t}),t}catch(e){this.log.error("_processMemberJoined: ",{e:e})}}_processMemberInvited(e,t){var r,n,i,s,c,u;try{if(!e)return this.log.warn(`no conversation object for ${t.type}`),t;if((null===(r=e.me)||void 0===r?void 0:r.user.id)===t.body.invited_by||!(null===(i=null===(n=t.body.user.media)||void 0===n?void 0:n.audio_settings)||void 0===i?void 0:i.enabled))return t;const d=a.default.getMemberNumberFromEventOrNull(t.body.channel)||a.default.getMemberFromNameOrNull(e,t.body.invited_by)||"unknown",l=new o.default(this.application,e,d);return this.application.calls.set(e.id,l),(null===(s=t.body)||void 0===s?void 0:s.sdp)&&this.application.session.config.enableInboundOffer&&l._setOffer({sdp:t.body.sdp,leg_id:t.body.channel.id}),(null===(c=e.display_name)||void 0===c?void 0:c.startsWith("CALL_"))||l._handleStatusChange(t),this.application.emit("member:call",this.application.conversations.get(t.cid).members.get(null===(u=t.body)||void 0===u?void 0:u.member_id),l),t}catch(e){this.log.error("_processMemberInvited: ",{e:e})}}}r.default=ApplicationEventsHandler,t.exports=ApplicationEventsHandler},{"../events/nxmEvent":5,"../modules/nxmCall":16,"../modules/rtc_helper":18,"../utils":31,loglevel:63}],8:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("loglevel"),s=n(e("../events/nxmEvent")),o=n(e("../events/text_event")),a=n(e("../events/image_event")),c=n(e("../events/message_event"));class ConversationEventHandler{constructor(e,t){this.log=i.getLogger(this.constructor.name),this.application=e,this.conversation=t,this.constructed_event=null,this._handleEventMap={"event:delete":this._processDelete,image:this._processImage,"image:delivered":this._processDelivered,"image:seen":this._processSeen,"member:invited":this._processMember,"member:joined":this._processMember,"member:left":this._processMember,"audio:ringing:start":this._processMember,"leg:status:update":this._processLegStatus,"member:media":this._processMedia,text:this._processText,"text:delivered":this._processDelivered,"text:seen":this._processSeen,"audio:mute:on":this._processMuteForMedia,"audio:mute:off":this._processMuteForMedia,message:this._processMessage,"message:delivered":this._processDelivered,"message:seen":this._processSeen,"message:submitted":this._processSubmitted,"message:rejected":this._processRejected,"message:undeliverable":this._processUndeliverable}}handleEvent(e){return this._handleEventMap.hasOwnProperty(e.type)&&this._handleEventMap[e.type].call(this,e)||new s.default(this.conversation,e)}_processDelivered(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.delivered_to=t.state.delivered_to||{},t.state.delivered_to[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}_processDelete(e){var t;let r=this.conversation.events.get(null===(t=null===e||void 0===e?void 0:e.body)||void 0===t?void 0:t.event_id);return r?(r.body.text&&(r.body.text=""),r.body.representations&&(r.body.representations=""),r.body.timestamp={deleted:e.timestamp},r):(this.log.warn("NXMEvent not found"),null)}_processImage(e){var t;const r=new a.default(this.conversation,e);return(null===(t=this.conversation.me)||void 0===t?void 0:t.id)!==r.from&&r.delivered(),r}_processMember(e){if(this.application.calls.has(this.conversation.id)){this.application.calls.get(this.conversation.id)._handleStatusChange(e)}return this.conversation.members.has(e.from)&&this.conversation.members.get(e.from)._handleEvent(e),new s.default(this.conversation,e)}_processLegStatus(e){return this.conversation.members.has(e.from)&&this.conversation.members.get(e.from)._handleEvent(e),new s.default(this.conversation,e)}_processMedia(e){return this.conversation.members.has(e.from)&&this.conversation.members.get(e.from)._handleEvent(e),null}_processMuteForMedia(e){return this.conversation.media.rtcObjects[e.body.rtc_id]?e.streamIndex=this.conversation.media.rtcObjects[e.body.rtc_id].streamIndex:this.log.warn("No audio stream was found"),null}_processSeen(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.seen_by=t.state.seen_by||{},t.state.seen_by[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}_processText(e){var t,r;const n=new o.default(this.conversation,e);return(null===(r=null===(t=this.conversation)||void 0===t?void 0:t.me)||void 0===r?void 0:r.id)!==n.from&&n.delivered(),n}_processMessage(e){var t,r;const n=new c.default(this.conversation,e);return(null===(r=null===(t=this.conversation)||void 0===t?void 0:t.me)||void 0===r?void 0:r.id)!==n.from&&n.delivered(),n}_processSubmitted(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.submitted_to=t.state.submitted_to||{},t.state.submitted_to[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}_processRejected(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.rejected_by=t.state.rejected_by||{},t.state.rejected_by[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}_processUndeliverable(e){let t=this.conversation.events.get(e.body.event_id);return t?(t.state=t.state||{},t.state.undeliverable_to=t.state.undeliverable_to||{},t.state.undeliverable_to[e.from]=e.timestamp,t):(this.log.warn("NXMEvent not found"),null)}}r.default=ConversationEventHandler,t.exports=ConversationEventHandler},{"../events/image_event":3,"../events/message_event":4,"../events/nxmEvent":5,"../events/text_event":6,loglevel:63}],9:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ConversationEventsProcessor=r.EventsQueue=void 0;const i=e("../nexmoClientError"),s=n(e("../utils")),o=e("loglevel");class EventsQueue{constructor(e){this.callback=e,this.cidMap=new Map,this.log=o.getLogger(this.constructor.name)}async enqueue(e,t){var r,n,i,s;const{cid:o,id:a}=e,c=Number(a);if(!o||isNaN(c))return this.callback(e);if(!this.cidMap.get(o)){this.log.debug(`enqueue: create new ConversationEventsProcessor for ${o}`);const a=new ConversationEventsProcessor(o,c-1,t);if(this.cidMap.set(o,a),"member:media"==e.type&&(null===(n=null===(r=e.body)||void 0===r?void 0:r.media)||void 0===n?void 0:n.audio)||"member:joined"==e.type&&(null===(s=null===(i=e.body)||void 0===i?void 0:i.channel)||void 0===s?void 0:s.id)){const t=c-20<1?1:c-20;let r=!1;(await a.fetchConversationEvents(t,20)).forEach(t=>{"rtc:transfer"===t.type&&t.from===e.from&&(r=!0,a.lastEventIdProcessed=Number(t.id)-1),r&&a.enqueue(Number(t.id),t)})}}const u=this.cidMap.get(o);u.enqueue(c,e),u.processing||(u.processing=!0,await u.processEvents())}}r.EventsQueue=EventsQueue;class ConversationEventsProcessor{constructor(e,t,r){this.cid=e,this.eventsMap=new Map,this.callback=(e=>r._handleEvent(e)),this.lastEventIdProcessed=t,this.largestEventIdInQueue=t,this.processing=!1,this.application=r,this.eventsFetchRange=9,this.log=o.getLogger(this.constructor.name)}enqueue(e,t){return e>this.largestEventIdInQueue&&(this.largestEventIdInQueue=e),e>this.lastEventIdProcessed&&this.eventsMap.set(e,t),t}dequeue(e){const t=this.eventsMap.get(e);return this.eventsMap.delete(e),t}async processEvents(){const e=()=>(this.eventsMap.clear(),this.log.debug("processEvents: Done Processing"),this.processing=!1);if(this.eventsMap.size<1)return e();const t=this.lastEventIdProcessed+1,r=await this.processNextEvent(t);return r?(this.lastEventIdProcessed=Number(r.id),this.processEvents()):e()}async processNextEvent(e){this.log.debug(`processNextEvent: processing event number ${e}`);const t=this.dequeue(e);try{if(t)return await this.callback(t),t;if(this.largestEventIdInQueue>e){this.log.debug(`processNextEvent: largestEventIdInQueue-${this.largestEventIdInQueue} > eventId-${e}`);const t=await this.fetchEventsAndProcess(e);return t?(this.log.debug("processNextEvent: foundEvent ",{foundEvent:t}),await this.callback(t),t):(this.log.debug(`processNextEvent: not found process next ${e+1}`),this.processNextEvent(e+1))}return}catch(e){return}}async fetchEventsAndProcess(e){try{const t=await this.fetchConversationEvents(e,this.eventsFetchRange);let r;return this.log.debug("fetchEventsAndProcess: fetched events list ",{eventsList:t}),t.forEach(t=>{t.cid=this.cid;const n=Number(t.id);isNaN(n)||n<e||(n>e?(this.log.debug(`fetchEventsAndProcess: event > missingEvent ${n} `,{missingEvent:e}),this.enqueue(n,t)):(this.log.debug("fetchEventsAndProcess: foundEvent ",{event:t}),r=t))}),r}catch(e){return void this.log.debug("fetchEventsAndProcess: error ",{e:e})}}async fetchConversationEvents(e,t){this.log.debug("fetchConversationEvents: ",this.cid,e);const r=this.largestEventIdInQueue>e?this.largestEventIdInQueue+t:e+t,n=`${this.application.session.config.nexmo_api_url}/beta2/conversations/${this.cid}/events`;try{return(await s.default.paginationRequest(n,{start_id:e,end_id:r},this.application.session.config.token)).items}catch(e){throw new i.NexmoApiError(e)}}}r.ConversationEventsProcessor=ConversationEventsProcessor,t.exports={EventsQueue:EventsQueue,ConversationEventsProcessor:ConversationEventsProcessor}},{"../nexmoClientError":20,"../utils":31,loglevel:63}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("loglevel");class RtcEventHandler{constructor(e){this.log=n.getLogger(this.constructor.name),this.application=e,this._handleRtcEventMap={"rtc:transfer":this._processRtcTransfer,"rtc:answer":this._processRtcAnswer,"rtc:hangup":this._processRtcHangup}}_handleRtcEvent(e){if(this._handleRtcEventMap.hasOwnProperty(e.type))return this._handleRtcEventMap[e.type].call(this,e)}_processRtcTransfer(e){this.log.debug("_processRtcTransfer: ",{event:e});const t=this.application.conversations.get(e.body.transferred_from),r=this.application.conversations.get(e.cid),n=this.application.calls.get(e.body.transferred_from);n?(n.conversation.members.get(e.body.was_member).transferred_to=r,n._setupConversationObject(r),n.transferred=!0,this.application.calls.set(e.cid,n),this.application.calls.delete(e.body.transferred_from),t&&(r.members.get(e.from).transferred_from=t,r.media._attachEndingEventHandlers(),0===Object.entries(r.media.rtcObjects).length&&0!==Object.entries(t.media.rtcObjects).length&&Object.assign(r.media.rtcObjects,t.media.rtcObjects),!r.media.pc&&t.media.pc&&Object.assign(r.media.pc=t.media.pc),0===r.application.activeStreams.length&&t.application.activeStreams.length>0&&(r.application.activeStreams=t.application.activeStreams))):this.log.warn("NXMCall transfer for unknown nxmCall")}_processRtcAnswer(e){this.log.debug("_processRtcAnswer: ",{event:e}),this.application.calls.has(e.cid)&&(this.application.calls.get(e.cid).id=e.body.rtc_id)}_processRtcHangup(e){if(this.log.debug("_processRtcHangup: ",{event:e}),this.application.calls.has(e.cid)){this.application.calls.get(e.cid)._handleStatusChange(e)}}}r.default=RtcEventHandler,t.exports=RtcEventHandler},{loglevel:63}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("loglevel");class SipEventHandler{constructor(e){this.log=n.getLogger(this.constructor.name),this.application=e,this._handleSipCallEventMap={"sip:hangup":this._processSipHangup,"sip:ringing":this._processSipRinging}}_handleSipCallEvent(e){if(this.log.debug("_handleSipCallEvent: ",{event:e}),!this.application.calls.has(e.cid))return void this.log.warn("There is no call object for this Conversation id.");const t=this.application.calls.get(e.cid);return this._handleSipCallEventMap.hasOwnProperty(e.type)?this._handleSipCallEventMap[e.type].call(this,t,e):void 0}_processSipHangup(e,t){this.log.debug("_processSipHangup: ",t),e._handleStatusChange(t)}_processSipRinging(e,t){this.log.debug("_processSipRinging: ",t),e._handleStatusChange(t)}}r.default=SipEventHandler,t.exports=SipEventHandler},{loglevel:63}],12:[function(e,t,r){(function(t){(function(){"use strict";let r=t.NexmoClient||{};r=e("./sdk"),t.NexmoClient=r}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./sdk":28}],13:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("wildemitter"),s=e("./nexmoClientError"),o=n(e("./events/nxmEvent")),a=n(e("./utils"));class Member{constructor(e,t){this.conversation=e,this.callStatus=null,this._normalise(t),i.mixin(Member)}_normalise(e){if(e){let t;for(t in this.user=this.user||{},this.channel=e.channel||{type:"app"},e)switch(t){case"member_id":this.id=e.member_id;break;case"timestamp":this.timestamp=e.timestamp;break;case"state":this.state=e.state;break;case"from":this.id=e.from;break;case"user_id":this.user.id=e.user_id;break;case"name":this.user.name=e.name;break;case"user":this.user={name:e.user.name,id:e.user.user_id||e.user.id},this.display_name=this.display_name||e.user.display_name;break;case"invited_by":this.invited_by=e.invited_by;break;case"display_name":this.display_name=this.display_name||e.display_name;break;case"_embedded":e._embedded.user&&(this.user={id:e._embedded.user.id||this.user.id,name:e._embedded.user.name||this.user.name},this.display_name=this.display_name||e._embedded.user.display_name);case"conversation":break;default:e.type||(this[t]=e[t])}this.conversation.application.me&&e.user_id===this.conversation.application.me.id&&(this.user.name=this.conversation.application.me.name),delete this.user_id,delete this.name,delete this.user.user_id}}async playStream(e){try{const t=await this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:{type:"audio:play",to:this.id,body:e}});return new o.default(this.conversation,t)}catch(e){throw new s.NexmoApiError(e)}}async sayText(e){try{const t=await this.conversation.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.id}/events`,data:{type:"audio:say",cid:this.id,from:this.conversation.me.id,to:this.id,body:{text:e.text,voice_name:e.voice_name||"Amy",level:e.level||1,queue:e.queue||!0,loop:e.loop||1,ssml:e.ssml||!1}}});return new o.default(this.conversation,t)}catch(e){throw new s.NexmoApiError(e)}}async kick(e){var t,r;let n=`conversations/${this.conversation.id}/members/${this.id}`,i=new URLSearchParams;(null===(r=null===(t=null===this||void 0===this?void 0:this.conversation)||void 0===t?void 0:t.me)||void 0===r?void 0:r.id)&&i.append("from",this.conversation.me.id),e&&Object.keys(e).forEach(t=>{i.append(t,e[t])}),n+=`?${i.toString()}`;try{return await this.conversation.application.session.sendNetworkRequest({type:"DELETE",path:n})}catch(e){throw new s.NexmoApiError(e)}}mute(e,t=null){return this.conversation.media.mute(e,t)}earmuff(e){return this.conversation.media.earmuff(e)}_handleEvent(e){switch(e.type){case"member:invited":this._normalise(e.body),this.state="INVITED",this.timestamp.invited=e.body.timestamp.invited,!e.body.invited_by&&e.body.user.media&&e.body.user.media.audio_settings&&e.body.user.media.audio_settings.enabled&&this._setCallStatusAndEmit("started");break;case"member:joined":this._normalise(e.body),this.state="JOINED",this.timestamp.joined=e.body.timestamp.joined,e.body.channel&&e.body.channel.knocking_id&&this._setCallStatusAndEmit("started");break;case"member:left":this._normalise(e.body),this.state="LEFT",this.timestamp.left=e.body.timestamp.left,e.body.reason&&e.body.reason.text&&this._setCallStatusAndEmit(e.body.reason.text);break;case"member:media":this.media=e.body.media;break;case"leg:status:update":this.channel.legs=a.default.updateMemberLegs(this.channel.legs,e),this._setCallStatusAndEmit(e.body.status);break;case"audio:ringing:start":this.callStatus&&"started"!==this.callStatus||this._setCallStatusAndEmit("ringing")}}_setCallStatusAndEmit(e){this.callStatus!==String(e)&&(this.callStatus=e,this.conversation.emit("member:call:status",this))}}r.default=Member,t.exports=Member},{"./events/nxmEvent":5,"./nexmoClientError":20,"./utils":31,wildemitter:107}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("loglevel"),i=e("../nexmoClientError");class ErrorsEmitter{constructor(e){if(this.log=n.getLogger(this.constructor.name),!e)throw new i.NexmoClientError("no emitter object passed for the Error Emitter");this.emitter=e,this.LISTENER_GROUP="NXM-errors"}emitResponseIfError(e){if(this._isTypeError(e.type))return this.emitter.emit(e.type,this.LISTENER_GROUP,e)}cleanup(){return this.emitter.releaseGroup(this.LISTENER_GROUP)}_isTypeError(e){return-1!==e.indexOf("error")}}r.default=ErrorsEmitter,t.exports=ErrorsEmitter},{"../nexmoClientError":20,loglevel:63}],15:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("loglevel"),s=e("../nexmoClientError"),o=n(e("./rtc_helper")),a=n(e("../utils")),c=n(e("../events/nxmEvent")),u=n(e("../conversation")),d=n(e("../application"));class Media{constructor(e){var t,r,n;const s=e instanceof u.default?e:null,a=e instanceof d.default?e:null;this.log=i.getLogger(this.constructor.name),s?(this.rtcHelper=new o.default,this.application=s.application,this.application.activeStreams=this.application.activeStreams||[],this.parentConversation=s,this.rtcObjects={},this.streamIndex=0,this.rtcstats_conf=(null===(n=null===(r=null===(t=this.application)||void 0===t?void 0:t.session)||void 0===r?void 0:r.config)||void 0===n?void 0:n.rtcStats)||{},this.rtcStats=null):a?(this.rtcHelper=new o.default,this.application=a):this.log.warn("No conversation object in Media")}_attachEndingEventHandlers(){this.parentConversation&&(this.log.debug("attaching leave listeners in media for "+this.parentConversation.id),this.parentConversation.on("rtc:hangup",async e=>{let t;if(this.parentConversation.members.has(e.from))t=this.parentConversation.members.get(e.from);else try{t=await this.parentConversation.getMember(e.from)}catch(e){this.log.warn(`There is an error getting the member ${e}`)}t.user.id===this.application.me.id&&this.application.activeStreams.length&&this._cleanMediaProperties(),t.user.id===this.application.me.id&&t.transferred_from&&t.transferred_from.media._cleanMediaProperties(),t.user.id===this.application.me.id&&this.parentConversation.off("rtc:hangup")}))}_enableStatsEvents(){this.rtcstats_conf.emit_rtc_analytics=!0,this.rtcstats_conf.remote_collection=!0;const e=this._findRtcObjectByType("audio");!this.rtcStats&&e&&(this.log.debug(`enabling stats events for ${e.rtc_id}`),this.rtcStats=o.default._initStatsEvents({application:this.application,rtc_id:e.rtc_id,pc:this.pc,conversation:this.parentConversation}))}_disableStatsEvents(){this.rtcstats_conf.emit_events=!1,this.rtcstats_conf.emit_rtc_analytics=!1,this.rtcstats_conf.remote_collection=!1,this.rtcStats.removeIntervals(),delete this.rtcStats}_audioInitHandler(e={},t){return new Promise(async(r,n)=>{const i=this.streamIndex;this.streamIndex++;const{audioConstraints:a}=e;try{const e=await o.default.getUserAudio(a),c=o.default.createPeerConnection(this.application);this.pc=c;const{application:u,log:d,parentConversation:l,rtcObjects:p}=this,h={pc:c,streamIndex:i,localStream:e,application:u,conversation:l,log:d,rtcObjects:p};t({...h,resolve:r,reject:n}),o.default.attachConversationEventHandlers(h),this._attachEndingEventHandlers()}catch(e){n(new s.NexmoClientError(e))}})}_execAnswer(e={}){const{offer:{sdp:t,leg_id:r}}=e;return this._audioInitHandler(e,e=>o.default.doAnswer(e,t,r))}_handleAudio(e={}){const{reconnectRtcId:t}=e;return this._audioInitHandler(e,e=>o.default.attachPeerConnectionEventHandlers({...e,reconnectRtcId:t}))}_findRtcObjectByType(e){return Object.values(this.rtcObjects).find(t=>t.type===e)}async _cleanConversationProperties(){this.pc&&this.pc.close(),delete this.pc,this.rtcStats=null,this.application.activeStreams=[],this.listeningToRtcEvent=!1,await Promise.resolve()}_cleanMediaProperties(){if(this.pc&&this.pc.close(),this.rtcObjects)for(const e in this.rtcObjects)o.default.closeStream(this.rtcObjects[e].stream);delete this.pc,this.rtcStats=null,this.application.activeStreams=[],this.rtcObjects={},this.listeningToRtcEvent=!1}async _disableLeg(e){const t=new Promise(async(t,r)=>{try{await this.application.session.sendNetworkRequest({type:"DELETE",path:`conversations/${this.parentConversation.id}/rtc/${e}?from=${this.parentConversation.me.id}&originating_session=${this.application.session.session_id}`,version:"beta2"}),t("rtc:terminate:success")}catch(e){r(new s.NexmoApiError(e))}}),r=new Promise(t=>{this.rtcObjects[e].pc&&this.rtcObjects[e].pc.close(),this.rtcObjects[e].stream&&o.default.closeStream(this.rtcObjects[e].stream),t()});try{return await Promise.all([t,r]),this.parentConversation.me.emit("media:stream:off",this.rtcObjects[e].streamIndex),delete this.rtcObjects[e],"rtc:terminate:success"}catch(e){throw e}}_enableMediaTracks(e,t){e.forEach(e=>{e.enabled=t})}async _setMediaTracksAndMute(e,t,r,n){this._enableMediaTracks(t,!r);try{return await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:n,to:this.parentConversation.me.id,from:this.parentConversation.me.id,body:{rtc_id:e}}})}catch(e){throw this._enableMediaTracks(t,r),new s.NexmoApiError(e)}}async updateAudioConstraints(e={}){let t=this._findRtcObjectByType("audio");if(!t||!t.pc)throw new s.NexmoApiError("error:media:stream:not-found");try{const r=await o.default.getUserAudio(e);return r.getTracks().forEach(e=>{const r=t.pc.getSenders().find(t=>t.track.kind===e.kind);r&&(e.enabled=r.track.enabled,r.replaceTrack(e))}),o.default.closeStream(t.stream),t.stream=r,r}catch(e){return e}}mute(e=!1,t=null){const r="audio:mute:"+(e?"on":"off");let n=[],i={};if(null!==t){if(i[0]=Object.values(this.rtcObjects).find(e=>e.streamIndex===t),!i[0])throw new s.NexmoClientError("error:media:stream:not-found")}else i=this.rtcObjects;return Object.values(i).forEach(t=>{const i=t.stream.getAudioTracks(),s=this._setMediaTracksAndMute(t.rtc_id,i,e,r);n.push(s)}),Promise.all(n)}async earmuff(e){try{if(null===this.me)throw new s.NexmoClientError("error:self");{let t="audio:earmuff:off";e&&(t="audio:earmuff:on");const{response:r}=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:t,to:this.parentConversation.me.id}});return r}}catch(e){throw new s.NexmoApiError(e)}}async enable(e){try{if(null===this.parentConversation.me)throw new s.NexmoClientError("error:self");{const{offer:t}=null!==e&&void 0!==e?e:{};let r=await(void 0!==t?this._execAnswer(e):this._handleAudio(e)),n=e&&(e.autoPlayAudio||void 0===e.autoPlayAudio);return e&&!n||o.default.playAudioStream(r),r}}catch(e){throw e}}disable(){let e=[];e.push(this._cleanConversationProperties());for(const t in this.rtcObjects)e.push(this._disableLeg(t));return Promise.all(e)}async sayText(e){try{const t=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:say",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{text:e.text,voice_name:e.voice_name||"Amy",level:e.level||1,queue:e.queue||!0,loop:e.loop||1,ssml:e.ssml||!1}}});return new c.default(this.parentConversation,t)}catch(e){throw new s.NexmoApiError(e)}}async sendDTMF(e){try{if(!a.default.validateDTMF(e))throw new s.NexmoClientError("error:audio:dtmf:invalid-digit");if(!(this._findRtcObjectByType("audio")||{}).rtc_id)throw new s.NexmoClientError("error:audio:dtmf:audio-disabled");const{id:t,timestamp:r}=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:dtmf",from:this.parentConversation.me.id,body:{digit:e,channel:{type:"app",id:this._findRtcObjectByType("audio").rtc_id}}}}),n={body:{digit:e,dtmf_id:""},cid:this.parentConversation.id,from:this.parentConversation.me.id,id:t,timestamp:r,type:"audio:dtmf"},i=new c.default(this.parentConversation,n);return this.parentConversation.events.set(n.id,i),i}catch(e){throw new s.NexmoApiError(e)}}async playStream(e){try{const t=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:play",body:e}});return new c.default(this.parentConversation,t)}catch(e){throw new s.NexmoApiError(e)}}async startRinging(){try{const e=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:ringing:start",from:this.parentConversation.me.id,body:{}}});return new c.default(this.parentConversation,e)}catch(e){throw new s.NexmoApiError(e)}}async stopRinging(){try{const e=await this.application.session.sendNetworkRequest({type:"POST",path:`conversations/${this.parentConversation.id}/events`,data:{type:"audio:ringing:stop",from:this.parentConversation.me.id,body:{}}});return new c.default(this.parentConversation,e)}catch(e){throw new s.NexmoApiError(e)}}}r.default=Media,t.exports=Media},{"../application":1,"../conversation":2,"../events/nxmEvent":5,"../nexmoClientError":20,"../utils":31,"./rtc_helper":18,loglevel:63}],16:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("wildemitter"),s=e("loglevel"),o=e("../nexmoClientError"),a=n(e("./rtc_helper"));class NXMCall{constructor(e,t,r){this.application=e,this.log=s.getLogger(this.constructor.name),this.from=r,this.conversation=null,this.rtcObjects={},this.CALL_STATUS={STARTED:"started",RINGING:"ringing",ANSWERED:"answered",COMPLETED:"completed",BUSY:"busy",TIMEOUT:"timeout",UNANSWERED:"unanswered",REJECTED:"rejected",FAILED:"failed"},this.CALL_DIRECTION={INBOUND:"inbound",OUTBOUND:"outbound"},Object.freeze(this.CALL_DIRECTION),this.STATUS_PERMITTED_FLOW=new Map([["STARTED",new Set([this.CALL_STATUS.RINGING,this.CALL_STATUS.ANSWERED,this.CALL_STATUS.FAILED,this.CALL_STATUS.TIMEOUT,this.CALL_STATUS.UNANSWERED,this.CALL_STATUS.REJECTED,this.CALL_STATUS.BUSY])],["RINGING",new Set([this.CALL_STATUS.ANSWERED,this.CALL_STATUS.FAILED,this.CALL_STATUS.TIMEOUT,this.CALL_STATUS.UNANSWERED,this.CALL_STATUS.REJECTED,this.CALL_STATUS.BUSY])],["ANSWERED",new Set([this.CALL_STATUS.COMPLETED,this.CALL_STATUS.FAILED])]]),Object.freeze(this.STATUS_PERMITTED_FLOW),this.status=null,this.call_disconnect_timeout=null,this.direction=this.CALL_DIRECTION.INBOUND,this._setupConversationObject(t),i.mixin(NXMCall)}_enableStatsEvents(){this.conversation.media._enableStatsEvents()}_attachCallListeners(){this.log.debug("_attachCallListeners : ",{nxmCall:this});try{this.conversation.releaseGroup("call_module"),this.conversation.on("member:media","call_module",(e,t)=>{this.application.calls&&this.application.calls.has(this.conversation.id)&&this.application.calls.get(this.conversation.id)._handleStatusChange(t)})}catch(e){this.log.error("_attachCallListeners_error: ",{e:e})}}_isValidStatusTransition(e){if(!e)throw new o.NexmoClientError(`Provide the status to validate the transition from '${this.status}'`);if(!this.status)return!0;const t=this.status.toUpperCase();return!!this.STATUS_PERMITTED_FLOW.has(t)&&(this.status!==e&&this.STATUS_PERMITTED_FLOW.get(t).has(e))}hangUpIfAllLeft(){if(this.log.debug("hangUpIfAllLeft: ",{nxmCall:this}),!this.conversation.me||"LEFT"===this.conversation.me.state||this.conversation.members.size<=1)return Promise.resolve();for(let e of this.conversation.members.values())if("LEFT"!==e.state&&this.conversation.me.user.id!==e.user.id)return Promise.resolve();return this.hangUp()}_setupConversationObject(e,t){e&&(this.conversation=e,e.me?(this.to=new Map(e.members),this.from&&this.to.delete(this.from.id)):this.log.warn("missing own member object"),this._attachCallListeners())}_setFrom(e){this.from=e}_setOffer(e){this.offer=e}_handleStatusChange(e){var t;const r=!this.conversation||(null===(t=this.conversation.me)||void 0===t?void 0:t.id)===e.from,n=this.direction===this.CALL_DIRECTION.OUTBOUND;this.log.debug("_handleStatusChange: ",{event:e},`_isEventFromMe: ${r} _isOutbound: ${n}`);let i=new Map;if(i.set("member:joined",async()=>{if(e.body.channel&&e.body.channel.id)try{return void this._setStatusAndEmit(this.CALL_STATUS.STARTED)}catch(e){throw this._setStatusAndEmit(this.CALL_STATUS.FAILED),this.log.error(e),e}return Promise.resolve()}),i.set("member:invited",()=>(null===e.body.invited_by&&e.body.user.media&&e.body.user.media.audio_settings&&this._setStatusAndEmit(this.CALL_STATUS.STARTED),Promise.resolve())),i.set("rtc:hangup",()=>this.status===this.CALL_STATUS.ANSWERED?(this._setStatusAndEmit(this.CALL_STATUS.COMPLETED),Promise.resolve()):r&&n||!r&&!n?(this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve()):(this._setStatusAndEmit(this.CALL_STATUS.REJECTED),Promise.resolve())),i.set("member:left",()=>{if(!e.body.timestamp.hasOwnProperty("joined")&&this.status!==this.CALL_STATUS.ANSWERED)return r&&n||!r&&!n?(this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve()):(this._setStatusAndEmit(this.CALL_STATUS.REJECTED),Promise.resolve())}),i.set("member:media",()=>(this.status!==this.CALL_STATUS.ANSWERED&&e.body.audio&&(r&&e.body.channel&&(this.id=e.body.channel.id),r&&n||!this.id||this._setStatusAndEmit(this.CALL_STATUS.ANSWERED)),Promise.resolve())),i.set("sip:ringing",()=>(this.status!==this.CALL_STATUS.RINGING&&this._setStatusAndEmit(this.CALL_STATUS.RINGING),Promise.resolve())),i.set("sip:hangup",()=>{switch(e.body.reason.sip_code){case 486:this._setStatusAndEmit(this.CALL_STATUS.BUSY);break;case 487:this._setStatusAndEmit(this.CALL_STATUS.TIMEOUT);break;case 403:this._setStatusAndEmit(this.CALL_STATUS.FAILED)}return Promise.resolve()}),i.set("knocking:delete:success",()=>(this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve())),i.has(e.type))return i.get(e.type).call(this)}_setStatusAndEmit(e){this._isValidStatusTransition(e)&&(this.status=e,this.log.debug(`_setStatusAndEmit: ${e}`,{nxmCall:this}),this.application.emit("call:status:changed",this))}async answer(e=!0){if(this.log.debug(`answer: { autoPlayAudio: ${e}`),!this.conversation)throw new o.NexmoClientError("error:call:answer");try{await this.conversation.join();const t=await this.conversation.media.enable({autoPlayAudio:e,offer:this.offer});return this.offer=void 0,t}catch(e){throw this._setStatusAndEmit(this.CALL_STATUS.FAILED),this.log.error(e),e}}async createCall(e,t=!0){if(this.log.debug(`createCall: { usernames: ${e}, autoPlayAudio: ${t} }`),!e||!Array.isArray(e)||0===e.length)return Promise.reject(new o.NexmoClientError("error:application:call:params"));try{const r=await this.application.newConversationAndJoin({display_name:"CALL_"+this.application.me.name+"_"+e.join("_").replace(" ","")});r.members.set(r.me.id,r.me),this.from=r.me,this.successful_invited_members=new Map;const n=e.map(async e=>{try{const t=await r.inviteWithAudio({user_name:e});return r.members.set(t.id,t),this.successful_invited_members.set(t.id,t),t}catch(e){return this.log.error(e),e}}),i=async()=>{if(this.successful_invited_members.size>0)return await r.media.enable({audio:{muted:!1,earmuffed:!1},autoPlayAudio:t}),this.application.calls.set(r.id,this),n;throw n};return await Promise.all(n),this._setupConversationObject(r),await i()}catch(e){throw this.log.error(e),this._setStatusAndEmit(this.CALL_STATUS.FAILED),e}}async createServerCall(e,t,r){this.log.debug(`createServerCall: { user: ${e}, type: ${t}, custom_data: `,{custom_data:r});const n={type:t};"phone"===t?n.number=e:n.user=e;try{const{stream:e,legId:t,rtcObjects:i}=await a.default.prewarmLeg(this);this.log.debug("createServerCall: ",{stream:e},{legId:t},{rtcObjects:i}),this.rtcObjects=i,this.stream=e,this.id=t,this.application._call_draft_list.set(t,this),a.default.playAudioStream(e);const s={type:"POST",path:"knocking",data:{channel:{type:"app",from:{type:"app"},to:n,id:t||null},...r&&Object.keys(r).length&&{properties:{custom_data:r}}}};try{const e=await this.application.session.sendNetworkRequest(s);this.knocking_id=e.id}catch(e){throw new o.NexmoApiError(e)}return a.default.cleanCallMediaIfFailed(this),e}catch(e){throw a.default.cleanMediaProperties(this),e}}async hangUp(e){if(this.log.debug(`hangUp: { reason: ${e} }`),this.conversation&&await this.conversation.media.disable(),!this.knocking_id&&this.conversation)return this.conversation.leave(e).catch(e=>{if("conversation:error:invalid-member-state"!==e.type)return Promise.reject(e)});{let t=`knocking/${this.knocking_id}`;if(e){let r=new URLSearchParams;Object.keys(e).forEach(t=>{r.append(t,e[t])}),t+=`?${r.toString()}`}try{const r=await this.application.session.sendNetworkRequest({type:"DELETE",path:t});return this.application._call_draft_list.get(this.client_ref)._handleStatusChange(r),this.application._call_draft_list.delete(this.client_ref),r}catch(t){return this.conversation?(this.log.error(new o.NexmoApiError(t)),this.conversation.leave(e).catch(e=>{if("conversation:error:invalid-member-state"!==e.type)return Promise.reject(e)})):void this.log.debug("hangup: Problem cancelling the call. Knocking cancel failed and Conversation. Leave not available",t)}}}reject(e){return this.log.debug(`reject: { reason: ${e} }`),this.conversation?this.conversation.leave(e):Promise.reject(new o.NexmoClientError("error:call:reject"))}}r.default=NXMCall,t.exports=NXMCall},{"../nexmoClientError":20,"./rtc_helper":18,loglevel:63,wildemitter:107}],17:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("is-ip"));class CancelError extends Error{constructor(){super("Request was cancelled"),this.name="CancelError"}get isCanceled(){return!0}}const s={timeout:5e3},o={v4:["https://ipv4.icanhazip.com/","https://api.ipify.org/"],v6:["https://ipv6.icanhazip.com/","https://api6.ipify.org/"]},a=(e,t,r)=>{const n=new XMLHttpRequest;let s;return new Promise((o,a)=>{s=a,n.addEventListener("error",a,{once:!0}),n.addEventListener("timeout",a,{once:!0}),n.addEventListener("load",()=>{const e=n.responseText.trim();(e&&"v4"!==r?i.default.v6(e):i.default.v4(e))?o(e):a()},{once:!0}),n.open("GET",e),n.timeout=t.timeout,n.send()})},c=(e,t)=>{let r;return async function(){const n=[].concat.apply(o[e],t.fallbackUrls||[]);for(const i of n)try{return r=a(i,t,e),await r}catch(e){if(e instanceof CancelError)throw e}throw new Error("Couldn't find your IP")}()};class PublicIp{}r.default=PublicIp,PublicIp.v4=(e=>c("v4",{...s,...e})),PublicIp.v6=(e=>c("v6",{...s,...e})),t.exports=PublicIp},{"is-ip":61}],18:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),e("webrtc-adapter");const a=e("sdp-transform"),c=e("loglevel"),u=s(e("detect-browser")),d=e("../nexmoClientError"),l=o(e("./rtcstats_analytics")),p=2e4;class RtcHelper{constructor(){this.log=c.getLogger(this.constructor.name)}static getUserAudio(e=!0){let t={video:!1,audio:e};return navigator.mediaDevices.getUserMedia(t)}createRTCPeerConnection(e){const t=new RTCPeerConnection(e);return t.trace=(()=>{}),t}_getWindowLocationProtocol(){return window.location.protocol}static _getBrowserName(){return u.detect().name}static isNode(){return"node"===this._getBrowserName()}checkValidKeys(e,t){let r=!0;return Object.keys(e).forEach(e=>{t.hasOwnProperty(e)||(r=!1)}),r}static cleanCallMediaIfFailed(e){setTimeout(()=>{e.conversation||(this.cleanMediaProperties(e),e.status=e.CALL_STATUS.FAILED,e.application.emit("call:status:changed",e))},5e3)}static callDisconnectHandler(e,t){const r=[e.CALL_STATUS.ANSWERED,e.CALL_STATUS.STARTED,e.CALL_STATUS.RINGING];if("disconnected"===t.connectionState&&e&&e.conversation)return setTimeout(()=>{"connected"!==t.connectionState&&-1!=r.indexOf(e.status)&&(this.cleanMediaProperties(e),e.status=e.CALL_STATUS.COMPLETED,e.application.emit("call:status:changed",e))},p)}static cleanMediaProperties(e){if(e.rtcObjects)for(const t in e.rtcObjects)e.rtcObjects[t].pc.close(),delete e.rtcObjects[t].pc,RtcHelper.closeStream(e.rtcObjects[t].stream);e.application.activeStreams=[],e.rtcObjects={},e.conversation&&e.conversation.media&&(e.conversation.media.rtcStats=null)}static playAudioStream(e){const t=new Audio;return t.srcObject=e,t.autoplay=!0,t}static createDummyCandidateSDP(e){const t=a.parse(e.localDescription.sdp);return t.media[0].candidates=[{foundation:1176891032,component:1,transport:"udp",priority:2122260223,ip:"0.0.0.0",port:9,type:"host",generation:0,"network-id":1,"network-cost":50}],a.write(t)}static createRTCPeerConnectionConfig(e){return{iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0",...e.session.config&&e.session.config.iceServers&&{iceServers:e.session.config.iceServers}}}static createPeerConnection(e){const t=this.createRTCPeerConnectionConfig(e);return new RTCPeerConnection(t)}static sendOffer(e,t,r,n){const i={sdp:this.createDummyCandidateSDP(t)};let s={from:r.me.id,body:{offer:i}},o=`conversations/${r.id}/rtc`;return n&&(o+=`/${n}/offer`),e.session.sendNetworkRequest({type:"POST",path:o,data:s})}static sendAnswer(e,t,r,n){const i=this.createDummyCandidateSDP(t);let s={from:r.me.id,body:{answer:i}},o=`conversations/${r.id}/rtc/${n}/answer`;return e.session.sendNetworkRequest({type:"POST",path:o,data:s})}static createLeg(e,t){const r={sdp:this.createDummyCandidateSDP(t),type:"offer"};return e.session.sendNetworkRequest({type:"POST",path:"legs",version:"beta",data:{body:{offer:r}}})}static closeStream(e){e.getTracks().forEach(e=>{e.stop()})}static emitMediaStream(e,t,r){e.emit("media:stream:on",{pc:t,stream:r,type:"audio",streamIndex:0})}static _initStatsEvents(e){var t,r,n;if(!RtcHelper.isNode()&&(null===(n=null===(r=null===(t=null===e||void 0===e?void 0:e.application)||void 0===t?void 0:t.session)||void 0===r?void 0:r.config)||void 0===n?void 0:n.rtcstats)){const t=e.application.session.config.rtcstats,{emit_events:r,remote_collection:n,emit_rtc_analytics:i}=t;if(r||n||i){const r={...e,config:{...t}};return new l.default(r)}}}static attachConversationEventHandlers(e){const{conversation:t,pc:r,log:n}=e;t.once("rtc:answer",e=>{r?r.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.body.answer})):n.warn("RTC: received an answer too late")})}static doAnswer(e,t,r){const{application:n,conversation:i,pc:s,reject:o,localStream:a}=e;this.addPeerConnectionListeners(e,()=>RtcHelper.sendAnswer(n,s,i,r).then(()=>({rtc_id:r}))),s.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:t})).then(()=>s.createAnswer()).then(e=>s.setLocalDescription(e)).catch(e=>{a&&this.closeStream(a),o(e)})}static attachPeerConnectionEventHandlers(e){const{application:t,conversation:r,pc:n,reconnectRtcId:i}=e;this.addPeerConnectionListeners(e,()=>RtcHelper.sendOffer(t,n,r,i))}static addPeerConnectionListeners(e,t){const{application:r,conversation:n,pc:i,streamIndex:s,localStream:o,log:a,rtcObjects:c,resolve:u,reject:l}=e;let p,h,f=!1;n.id&&(h=r.calls.get(n.id)),i.ontrack=(e=>{p=e.streams[0],r.activeStreams.push(p),RtcHelper.emitMediaStream(n.me,i,p)}),i.onconnectionstatechange=(e=>this.onconnectionstatechangeHandler(i,a,h,()=>u(p),()=>l())),i.onnegotiationneeded=(()=>this.onnegotiationneededHandler(i,e=>l(e))),i.oniceconnectionstatechange=(e=>this.oniceconnectionstatechange(e,i,a,e=>l(e))),i.onicecandidate=(async e=>{if(e.candidate&&!f&&i){f=!0;try{const{rtc_id:e}=await t();RtcHelper._initStatsEvents({application:r,rtc_id:e,pc:i,conversation:n}),i.trace&&i.trace("rtc_id",e),c[e]={rtc_id:e,pc:i,stream:o,type:"audio",streamIndex:s}}catch(e){o&&this.closeStream(o),l(new d.NexmoClientError(e))}}}),o.getTracks().forEach(e=>i.addTrack(e))}static prewarmLeg(e){const t=e.application;return new Promise(async(r,n)=>{let i,s,o=!1,a={};const u=c.getLogger(this.constructor.name);try{let c=await this.getUserAudio();const l=this.createPeerConnection(t);l.ontrack=(e=>{i=e.streams[0],t.activeStreams.push(i)}),l.onconnectionstatechange=(t=>this.onconnectionstatechangeHandler(l,u,e,()=>r({stream:i,legId:s,rtcObjects:a}),()=>n())),l.onnegotiationneeded=(()=>this.onnegotiationneededHandler(l,e=>n(e))),l.oniceconnectionstatechange=(e=>this.oniceconnectionstatechange(e,l,u,e=>n(e))),l.onicecandidate=(async e=>{if(e.candidate&&!o&&l){o=!0;const{rtc_id:e,sdp:r}=await this.createLeg(t,l);return RtcHelper._initStatsEvents({application:t,rtc_id:e,pc:l}),a[s=e]={rtc_id:e,pc:l,stream:c,type:"audio",streamIndex:1},l.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:r}))}}),c.getTracks().forEach(e=>l.addTrack(e))}catch(e){n(new d.NexmoClientError(e))}})}}r.default=RtcHelper,RtcHelper.onconnectionstatechangeHandler=((e,t,r,n,i)=>{switch(e.connectionState){case"connected":t.info("The connection has become fully connected"),n();break;case"disconnected":if(!r)break;r.call_disconnect_timeout&&clearTimeout(r.call_disconnect_timeout),r.call_disconnect_timeout=RtcHelper.callDisconnectHandler(r,e);break;case"failed":i(),t.info("One or more transports has terminated unexpectedly or in an error");break;case"closed":t.info("The connection has been closed")}}),RtcHelper.oniceconnectionstatechange=((e,t,r,n)=>{switch(t.iceConnectionState){case"disconnected":r.warn("One or more transports is disconnected",t.iceConnectionState);break;case"failed":n(new d.NexmoClientError(e)),r.warn("One or more transports has terminated unexpectedly or in an error",e);break;default:r.info("The ice connection status changed",t.iceConnectionState)}}),RtcHelper.onnegotiationneededHandler=(async(e,t)=>{try{const r=await e.createOffer();return e.setLocalDescription(r)}catch(e){t(new d.NexmoClientError(e))}}),t.exports=RtcHelper},{"../nexmoClientError":20,"./rtcstats_analytics":19,"detect-browser":38,loglevel:63,"sdp-transform":72,"webrtc-adapter":92}],19:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=e("rtc-stats-adapter"),s=e("rtc-stats-adapter/calculate-mos"),o=n(e("../utils"));class RTCStatsAnalytics{constructor(e){this.mos_report={min:5,max:0},this._reportsCount=0,this._mosSum=0,this.intervals=[],this._deprecationWarningSent=!1,e&&e.application&&e.rtc_id&&e.pc&&(this.conversation=null,this.application_id=null,this.attachHandlers(e),this.startSendingStats(e),this.startEmittingStats(e))}attachHandlers(e){const{pc:t}=e,r=t.onconnectionstatechange?t.onconnectionstatechange:()=>{};if(t.onconnectionstatechange=(n=>{switch(r.call(t,n),t.connectionState){case"disconnected":case"failed":case"closed":this.removeIntervals(),this.emitLastReport(e)}}),e.conversation){e.conversation.on("member:media",(t,r)=>{this.application_id||(null===e||void 0===e?void 0:e.rtc_id)!==r.body.channel.id||(this.application_id=r.application_id)})}else{e.application.on("member:joined",(t,r)=>{this.conversation&&this.application_id||(null===e||void 0===e?void 0:e.rtc_id)!==r.body.channel.id||(this.conversation=t.conversation,this.application_id=r.application_id)})}}emitLastReport(e){const{application:t,conversation:r=null,rtc_id:n,config:{emit_events:i,emit_rtc_analytics:s}}=e,o=this.getMOSReport(),a=o.last;a&&(s&&t.emit("rtcstats:analytics",{type:"mos_report",mos:a,rtc_id:n,mos_report:o,api_key:t.session.apiKey,...this.application_id&&{application_id:this.application_id},...r&&{conversation_id:r.id,conversation_name:r.name}}),i&&(this._deprecationWarningSent||(this._deprecationWarningSent=!0,console.warn('"rtcstats:report" event is deprecated. Use "rtcstats:analytics" instead')),t.emit("rtcstats:report",a,null,r,o)))}startSendingStats(e){const{application:t,conversation:r=null,pc:n,rtc_id:s,config:{remote_collection:a,remote_collection_url:c,remote_collection_interval:u}}=e;if(!a)return;const d=setInterval(()=>{n.getStats(null).then(e=>{var n;const a=null!==(n=null!==r&&void 0!==r?r:this.conversation)&&void 0!==n?n:null;o.default.networkRequest({url:c,type:"POST",data:{...i(e),legId:s,apiKey:t.session.apiKey,...this.application_id&&{applicationId:this.application_id},...a&&{conversationId:a.id,conversationName:a.name}}}).catch(()=>{})}).catch(()=>{}),"closed"!==n.connectionState&&"closed"!==n.signalingState||this.removeIntervals()},u);this.intervals.push(d)}startEmittingStats(e){const{application:t,conversation:r=null,pc:n,rtc_id:i,config:{emit_events:s,emit_rtc_analytics:o,emit_interval:a}}=e;if(!s&&!o)return;const c=setInterval(()=>{var a;n.getStats(null).then(e=>{var n;const a=this.getMos(e);if(!a)return;const c=null!==(n=null!==r&&void 0!==r?r:this.conversation)&&void 0!==n?n:null;o&&t.emit("rtcstats:analytics",{type:"mos",mos:a,report:e,rtc_id:i,api_key:t.session.apiKey,...this.application_id&&{application_id:this.application_id},...c&&{conversation_id:c.id,conversation_name:c.name}}),s&&(this._deprecationWarningSent||(this._deprecationWarningSent=!0,console.warn('"rtcstats:report" event is deprecated. Use "rtcstats:analytics" instead')),t.emit("rtcstats:report",a,e,r))}).catch(()=>{}),"closed"!==n.connectionState&&"closed"!==n.signalingState||(this.removeIntervals(),this.emitLastReport({...e,conversation:null!==(a=null!==r&&void 0!==r?r:this.conversation)&&void 0!==a?a:null}))},a);this.intervals.push(c)}removeIntervals(){this.intervals.forEach(e=>clearInterval(e)),this.intervals=[]}getMos(e){const t=s(e);return this.updateMOSReport(parseInt(t)),t}updateMOSReport(e){this._reportsCount++,this._mosSum+=e,this.mos_report.last=e,this.mos_report.min=e<this.mos_report.min?e:this.mos_report.min,this.mos_report.max=e>this.mos_report.max?e:this.mos_report.max,this.mos_report.average=this._mosSum/this._reportsCount}getMOSReport(){return this.mos_report.min=RTCStatsAnalytics.normaliseFloat(this.mos_report.min),this.mos_report.max=RTCStatsAnalytics.normaliseFloat(this.mos_report.max),this.mos_report.last=RTCStatsAnalytics.normaliseFloat(this.mos_report.last),this.mos_report.average=RTCStatsAnalytics.normaliseFloat(this.mos_report.average),this.mos_report}static normaliseFloat(e){return parseFloat(e).toFixed(6)}}r.default=RTCStatsAnalytics,t.exports=RTCStatsAnalytics},{"../utils":31,"rtc-stats-adapter":67,"rtc-stats-adapter/calculate-mos":66}],20:[function(e,t,r){(function(n){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NexmoApiError=r.NexmoClientError=void 0;const i=e("./nexmoClientErrorTypes"),s=e("loglevel");function decorateError(e,t){var r,n;(null===t||void 0===t?void 0:t.code)&&(t.type=t.code,delete t.code),Object.assign(e,t),e.message="type: "+e.type+", description: "+(null!==(n=null!==(r=e.description)&&void 0!==r?r:e.detail)&&void 0!==n?n:"")}class NexmoClientError{constructor(e){const t=i[e];t?decorateError(this,t):(this.message=e&&e.message?e.message:e,this.stack=e.stack),this.log=s.getLogger(this.constructor.name),this.log.error(this),this.name="NexmoClientError",void 0!==n.NXMbugsnagClient&&n.NXMbugsnagClient.notify(this,{severity:"info"})}}r.NexmoClientError=NexmoClientError;class NexmoApiError{constructor(e){this.log=s.getLogger(this.constructor.name),e?decorateError(this,e):(this.message=e&&e.message?e.message:e,this.stack=e&&e.stack?e.stack:(new Error).stack),this.name="NexmoApiError",this.log=s.getLogger(this.constructor.name),this.log.error(this),void 0!==n.NXMbugsnagClient&&n.NXMbugsnagClient.notify(this,{severity:"info"})}}r.NexmoApiError=NexmoApiError,t.exports={NexmoClientError:NexmoClientError,NexmoApiError:NexmoApiError}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./nexmoClientErrorTypes":21,loglevel:63}],21:[function(e,t,r){"use strict";t.exports={"error:application:call:params":{type:"error:application:call:params",description:"not a valid String[] of usernames param"},"error:application:callServer:params":{type:"error:application:call:params",description:"not a valid String of phone number"},"error:call:reject":{type:"error:call:reject",description:"failed to reject the call"},"error:getUserMedia:permissions":{type:"error:getUserMedia:permissions",description:"missing getUserMedia permissions"},"error:media:params":{type:"error:media:params",description:"currently supported params media type= {audio:{muted:false, earmuffed:false}}"},"error:media:reenable":{type:"error:media:reenable",description:"missing reconnectRtcId required to reenable media"},"error:self":{type:"error:self",description:"Conversation Object is missing self (me)"},"error:user:relogin":{type:"error:user:relogin",description:"please relogin"},"error:seen:own-message":{type:"error:seen:own-message",description:"attempt to send seen for own message"},"error:already-seen":{type:"error:already-seen",description:"already marked as seen"},"error:delivered:own-message":{type:"error:delivered:own-message",description:"attempt to send delivered for own message"},"error:already-delivered":{type:"error:already-delivered",description:"already marked as delivered"},"error:fetch-image":{type:"error:fetch-image",description:"xhr.status received other than 200"},"error:delete-image":{type:"error:delete-image",description:"xhr.status received other than 204"},"error:missing:params":{type:"error:missing:params",description:"missing parameters"},"error:invite:missing:params":{type:"error:missing:params",description:"This invite cannot be sent to empty username and user_id"},"error:invalid:param:type":{type:"error:invalid:param:type",description:"Invalid Object type, passed in the parameters"},"error:audio:already-connecting":{type:"error:audio:already-connecting",description:"Audio call already in progress"},"error:audio:not-enabled":{type:"error:audio:not-enabled",description:"Audio is not enabled"},"error:media:already-connecting":{type:"error:media:already-connecting",description:"Media is already in progress"},"error:media:unsupported-browser":{type:"error:media:unsupported-browser",description:"This action is not supported on this browser"},"error:media:extension":{type:"error:media:extension",description:"Chrome extension has thrown an error"},"error:media:extension-not-installed":{type:"error:media:extension-not-installed",description:"Chrome extension should be installed"},"error:media:update:streams":{type:"error:media:update:streams",description:"cant update more than one stream"},"error:media:update:invalid":{type:"error:media:update:invalid",description:"state of media is not supported for this update"},"error:media:stream:not-found":{type:"error:media:stream:not-found",description:"A stream with the given index was not found"},"error:audio:dtmf:invalid-digit":{type:"error:audio:dtmf:invalid-digit",description:"not a valid string of dtmf digits (0-9,a-d,A-D,p,P,*,#)"},"error:audio:dtmf:audio-disabled":{type:"error:audio:dtmf:audio-disabled",description:"Audio must be enabled to send DTMF"},"error:invalid-order":{type:"error:invalid-order",description:"params not valid. Order must be asc or desc"},"error:custom-event:invalid":{type:"error:custom-event:invalid",description:"Custom event type not valid"},"error:message-event:invalid":{type:"error:message-event:invalid",description:"message_type is missing or is invalid"},"error:invalid-cursor":{type:"error:invalid-cursor",description:"page does not exist"},"error:client:reconnection_failed":{type:"error:client:reconnection_failed",description:"websocket failed to reconnect"},"error:conversation-service:version":{type:"error:conversation:version",description:'Wrong version of Conversation Service API. It should be one of "v1" or "v3"'},"error:no-media-offer":{type:"error:no-media-offer",description:"Media preload attempt without having an offer available"}}},{}],22:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("./page"));class ConversationsPage extends i.default{constructor(e){super(e),this.items=new Map,e.items.forEach(e=>{const t=this.application.updateOrCreateConversation(e);this.items.set(t.id,t)})}getPrev(){return this.hasPrev()?this.application.getConversations(this._getConfig(this.cursor.prev)):this._getError()}getNext(){return this.hasNext()?this.application.getConversations(this._getConfig(this.cursor.next)):this._getError()}}r.default=ConversationsPage,t.exports=ConversationsPage},{"./page":25}],23:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("./page")),s=n(e("../events/nxmEvent")),o=n(e("../events/text_event")),a=n(e("../events/image_event")),c=n(e("../events/message_event"));class EventsPage extends i.default{constructor(e){super(e),this.items=new Map,this.conversation=e.conversation,e.items.forEach(e=>{switch(e.type){case"text":this.items.set(e.id,new o.default(this.conversation,e));break;case"image":this.items.set(e.id,new a.default(this.conversation,e));break;case"message":this.items.set(e.id,new c.default(this.conversation,e));break;default:this.items.set(e.id,new s.default(this.conversation,e))}}),this.conversation.events=new Map([...this.conversation.events,...this.items])}getPrev(){return this.hasPrev()?this.conversation.getEvents(this._getConfig(this.cursor.prev)):this._getError()}getNext(){return this.hasNext()?this.conversation.getEvents(this._getConfig(this.cursor.next)):this._getError()}}r.default=EventsPage,t.exports=EventsPage},{"../events/image_event":3,"../events/message_event":4,"../events/nxmEvent":5,"../events/text_event":6,"./page":25}],24:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("./page")),s=n(e("../member"));class MembersPage extends i.default{constructor(e){super(e),this.conversation=e.conversation,this.items=new Map,e.items.forEach(e=>{this.items.set(e.id,new s.default(this.conversation,e))})}getPrev(){return this.hasPrev()?this.conversation.getMembers(this._getConfig(this.cursor.prev)):this._getError()}getNext(){return this.hasNext()?this.conversation.getMembers(this._getConfig(this.cursor.next)):this._getError()}}r.default=MembersPage,t.exports=MembersPage},{"../member":13,"./page":25}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../nexmoClientError");class Page{constructor(e={}){this.page_size=e.page_size,this.order=e.order,this.cursor=e.cursor,this.application=e.application,e.event_type&&e.event_type.length>0&&(this.event_type=e.event_type)}hasPrev(){return!!this.cursor.prev&&this.cursor.prev.length>0}hasNext(){return!!this.cursor.next&&this.cursor.next.length>0}_getConfig(e){return{page_size:this.page_size,order:this.order,cursor:e,...this.event_type&&{event_type:this.event_type}}}_getError(){return Promise.reject(new n.NexmoClientError("error:invalid-cursor"))}}r.default=Page,t.exports=Page},{"../nexmoClientError":20}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});class PageConfig{constructor(e={}){this.page_size=e.page_size||10,this.order=e.order||"asc",this.cursor=e.cursor||"",this.state=e.state||"",e.event_type&&(this.event_type=e.event_type)}}r.default=PageConfig,t.exports=PageConfig},{}],27:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("./page")),s=n(e("../user_session"));class UserSessionsPage extends i.default{constructor(e){super(e),this.items=new Map,e.items.forEach(e=>{this.items.set(e.id,new s.default(this.application,e))})}getPrev(){return this.hasPrev()?this.application.getUserSessions(this._getConfig(this.cursor.prev)):this._getError()}getNext(){return this.hasNext()?this.application.getUserSessions(this._getConfig(this.cursor.next)):this._getError()}}r.default=UserSessionsPage,t.exports=UserSessionsPage},{"../user_session":30,"./page":25}],28:[function(e,t,r){(function(n){(function(){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const s=e("wildemitter"),o=i(e("loglevel-plugin-prefix")),a=i(e("loglevel")),c=e("./nexmoClientError"),u=i(e("socket.io-client")),d=i(e("@bugsnag/js")),l=i(e("./modules/publicip")),p=i(e("./utils")),h=i(e("./application")),f=i(e("./modules/errors_emitter")),m=i(e("./user")),g=i(e("./modules/rtc_helper"));o.default.reg(a.default),o.default.apply(a.default,{template:"[%t] %l (NXM-%n):",timestampFormatter:e=>e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),levelFormatter:e=>e.toUpperCase(),nameFormatter:e=>e||"SDK"});class NexmoClient{constructor(e={}){const t=e;if(this.config={debug:"silent",log_reporter:{enabled:!1,bugsnag_key:null},environment:"production",ips_url:"https://api-us.vonage.com/v1/image",nexmo_api_url:"https://api-us.vonage.com",path:"/v2/rtc",repository:"https://github.com/Nexmo/conversation-js-sdk",SDK_version:"9.4.0",socket_io:{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:2e3,randomizationFactor:.75,reconnectionDelayMax:15e3,forceNew:!0,autoConnect:!0,transports:["websocket"]},sync:"none",url:"https://ws-us.vonage.com",iceServers:[],rtcstats:{remote_collection:!0,remote_collection_url:"https://hlg.tokbox.com/prod/logging/nexmo_client_js_stats",remote_collection_interval:5e3,emit_events:!1,emit_rtc_analytics:!1,emit_interval:1e3},conversations_page_config:{page_size:10,order:"asc",cursor:""},events_page_config:{page_size:10,order:"asc",event_type:""},enableEventsQueue:!0,enableInboundOffer:!1,acknowledgeEvents:!0,token:null},this.config.socket_io.query={token:"",SDK_version:this.config.SDK_version,session_version:e.enableInboundOffer?"0.0.2":"0.0.1",acknowledge_events:this.config.acknowledgeEvents,OS_family:"js",OS_revision:"undefined"!=typeof navigator?navigator.userAgent:"undefined"!=typeof window?window.navigator.userAgent:"Generic JS navigator"},this.sessionReady=!1,this.disconnectTimestamp=null,this.session_id=null,this.apiKey=null,this.requests={},this.application=null,["debug","info","warn","error"].includes(t.debug)?a.default.setLevel(t.debug):!0===t.debug?a.default.setLevel("debug"):a.default.setLevel("silent"),this.log=a.default.noConflict(),this.config=p.default.deepMergeObj(this.config,this._sanitizeConfig(t)),this.config.log_reporter.enabled){const e={apiKey:this.config.log_reporter.bugsnag_key||p.default._getBugsnagKey(),appVersion:this.config.socket_io.query.SDK_version,releaseStage:this.config.environment};n.NXMbugsnagClient=d.default(e)}s.mixin(NexmoClient)}_createAndSetConnection(){let e,t=Object.assign({path:this.config.path},this.config.socket_io);return e=u.default.connect(this.config.url,t),this.connection=e,e.on("connect",()=>{this.emit("ready"),this.sessionReady=!0,this.log.info("websocket ready")}),e.on("disconnect",(e,t)=>{this.emit("disconnect","io client disconnect"===e?NexmoClient.DISCONNECT_REASON.ClientDisconnected:"io server disconnect"===e&&this.session_id?NexmoClient.DISCONNECT_REASON.TokenExpired:NexmoClient.DISCONNECT_REASON.ConnectionError),this.disconnectTimestamp=Date.now(),this.log.info("websocket disconnected",e,t)}),e.io.on("reconnect",e=>{this.emit("reconnect",e),this.log.info("websocket reconnect",e),p.default.networkRequest({url:`${this.config.url.replace("wss://","https://")}/v2/rtc/metrics`,type:"POST",token:this.config.token,data:{sessionId:this.session_id,metrics:[{name:"TIME_TO_RECONNECT_SUCCESS",time:this.disconnectTimestamp?Date.now()-this.disconnectTimestamp:void 0,attempt:e}]}}).catch(e=>{this.log.warn("Failed to publish socket reconnection metrics",e)})}),e.io.on("reconnect_attempt",e=>{this.emit("reconnecting",e),this.log.info("websocket reconnecting",e)}),e.on("connect_error",e=>{this.emit("error",new c.NexmoClientError(e)),this.log.error("Socket.io reported a generic error",e)}),e.io.on("reconnect_failed",()=>{this.emit("error",new c.NexmoClientError("error:client:reconnection_failed")),this.log.error("websocket reconnection error")}),e.io.on("packet",e=>{if(2!==e.type)return;if("echo"===e.data[0])return;const t=e.data[2];t&&"function"==typeof t&&t();const r=e.data[1];if(r.type=e.data[0],this.log.debug("<--",r.type,r),this.requests["session:login"]){const e=this.requests["session:login"].callback;delete this.requests["session:login"],e(r)}else if(r.rid in this.requests){const e=this.requests[r.rid].callback;delete this.requests[r.rid],delete r.delay,this.errorsEmitter&&this.errorsEmitter.emitResponseIfError(r),e(r)}else this.errorsEmitter&&r.type.startsWith("system:error:")?this.errorsEmitter.emitResponseIfError(r):r.type.startsWith("session:")?this.updateSession(r):this.application&&this.application._enqueueEvent(r)}),e}_sanitizeConfig(e){let t=e;return e.sync&&-1===["none","lite","full"].indexOf(e.sync)&&(this.log.warn(`invalid param '${e.sync}' for sync, reverting to ${this.config.sync}`),t.sync=this.config.sync),t}sendRequest(e,t){e.tid=p.default.allocateUUID();const r=e.type;delete e.type,this.log.debug("--\x3e",r,e),this.log.info("--\x3e",r,e.tid),this.connection.emit(r,e),this.requests[e.tid]={type:r,request:e,callback:t}}async sendNetworkRequest(e){const t=e.version||"beta",r=`${this.config.nexmo_api_url}/${t}/${e.path}`;"GET"!==e.type&&"DELETE"!==e.type&&(e.data?e.data.originating_session=this.session_id:e.data={originating_session:this.session_id});try{const t={type:e.type,url:r,data:e.data?e.data:null,token:(e.data||{}).token?e.data.token:this.config.token||null};this.log.debug("sendNetworkRequest: ",{request:t});const{response:n}=await p.default.networkRequest(t);return n}catch({response:e}){throw e}}createSession(e){return this.config.socket_io.query.token=e,this._createAndSetConnection(),new Promise((t,r)=>{this.log.info(`Client-SDK Version: ${this.config.SDK_version}`),this.config.token=null,this.requests["session:login"]={type:"session:login",callback:async i=>{if("session:success"===i.type)if(this.session_id=i.body.id,this.apiKey=i.body.api_key,this.config.token=e,this.connection.io.opts.query={session_id:this.session_id,token:this.config.token},(!this.application||this.application.me&&this.application.me.id!==i.body.user_id)&&(this.application=new h.default(this,{})),this.application.me||(this.application.me=new m.default(this.application,{id:i.body.user_id,name:i.body.name})),this.errorsEmitter||(this.errorsEmitter=new f.default(this.application)),this.config.log_reporter.enabled&&(n.NXMbugsnagClient.user={id:this.application.me.id,name:this.application.me.name,session_id:i.body.id}),"none"!==this.config.sync)try{await this.application.getConversations(),t(this.application)}catch(e){r(e)}else t(this.application);else r(new c.NexmoApiError(i))}}})}deleteSession(){return new Promise(async(e,t)=>{const r=()=>this.sendRequest({type:"session:logout",body:{}},r=>{"session:logged-out"===r.type||"session:terminated"===r.type?(this.disconnect(),delete this.errorsEmitter,delete this.application,delete this.connection,this.requests={},this.sessionReady=!1,e(r)):t(r)});if(this.application){let e=[];if(this.application.conversations.size)for(let t of this.application.conversations.values())e.push(t.media.disable());try{await Promise.all(e)}catch(e){this.log.error("deleteSession: ",e)}return r()}return r()})}updateSession(e){"session:success"===e.type&&(this.session_id=e.body.id,this.connection.io.opts.query.session_id=e.body.id)}disconnect(){return this.connection.disconnect()}connect(){return this.connection.connect()}async connectivityReport(e,t){const r={machineInfo:{ip:g.default.isNode()?void 0:await l.default.v4()},connectivityReport:[]};try{const{response:n}=await p.default.networkRequest({type:"GET",url:`${this.config.nexmo_api_url}/v0.3/discovery/api`,token:e});let i=n;(null===t||void 0===t?void 0:t.dcListCallback)&&(i=t.dcListCallback(i));for(const t in i){const n=i[t].endpoint,s=i[t].https,o=i[t].ws;try{const i={name:t,signalConnectionReport:{https:await p.default._checkHttpConnectivity(s),ws:await p.default._checkWsConnectivity(o,this.config.path,this.config.socket_io)},mediaConnectionReport:await p.default._checkMediaServers(e,n,t)};r.connectivityReport.push(i)}catch(e){this.log.error(`Error generating report for ${t}`,e)}}}catch(e){this.log.error("Error fetching nexmo servers information",e)}return r}async checkMediaServers(e,t,r){return await p.default._checkMediaServers(e,t,r)}async checkMediaConnectivity(e,t){return await p.default._checkMediaConnectivity(e,t)}}r.default=NexmoClient,NexmoClient.DISCONNECT_REASON={ClientDisconnected:"ClientDisconnected",TokenExpired:"TokenExpired",ConnectionError:"ConnectionError"},t.exports=NexmoClient}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./application":1,"./modules/errors_emitter":14,"./modules/publicip":17,"./modules/rtc_helper":18,"./nexmoClientError":20,"./user":29,"./utils":31,"@bugsnag/js":33,loglevel:63,"loglevel-plugin-prefix":62,"socket.io-client":77,wildemitter:107}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("wildemitter");class User{constructor(e,t){this.application=e,Object.assign(this,t),n.mixin(User)}}r.default=User,t.exports=User},{wildemitter:107}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("wildemitter");class UserSession{constructor(e,t){var r,i;this.application=e,this.id=null!==(r=null===t||void 0===t?void 0:t.id)&&void 0!==r?r:null,this._embedded=null!==(i=null===t||void 0===t?void 0:t._embedded)&&void 0!==i?i:null,n.mixin(UserSession)}}r.default=UserSession,t.exports=UserSession},{wildemitter:107}],31:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("uuid")),s=n(e("socket.io-client")),o=n(e("./application")),a=4e4,c=2e4;class Utils{static getMemberFromNameOrNull(e,t){if(!e||!t)return null;for(let r of e.members.values())if(r.user.name===t)return r;return null}static getMemberNumberFromEventOrNull(e){const t=e&&e.from;return t&&(t.number||t.uri)?t.number||t.uri:null}static networkRequest(e){return new Promise((t,r)=>{e.token||e.url.includes("logging")||e.url.includes("ping")||r({response:{type:"error:user:token",description:"network error on request. Please create a new session."}});const n=new XMLHttpRequest;let i;n.open(e.type,e.url,!0),e.token&&n.setRequestHeader("Authorization","Bearer "+e.token),e&&e.url.includes("image")?(n.responseType="",i=e.data,n.onloadstart=(()=>{t(n)})):(n.responseType=e.responseType||"json",i=JSON.stringify(e.data)||null,n.setRequestHeader("Content-type","application/json; charset=utf-8")),n.onload=(()=>{200===n.status||201===n.status||204===n.status?t(n):r(n)}),n.onerror=(e=>{r(e)}),n.send(i)})}static async paginationRequest(e,t,r,n=o.default.CONVERSATION_API_VERSION.v1){try{const i=await Utils.networkRequest({type:"GET",url:Utils.addUrlSearchParams(e,t),token:r}),{page_size:s,_embedded:a,_links:c}=i.response,u=e.split("/").pop().trim();return{items:n===o.default.CONVERSATION_API_VERSION.v1?a.data[u]:a[u],cursor:{prev:c.prev?new URLSearchParams(c.prev.href).get("cursor"):"",next:c.next?new URLSearchParams(c.next.href).get("cursor"):"",self:c.self?new URLSearchParams(c.self.href).get("cursor"):""},page_size:s,order:t.order||"asc",event_type:t.event_type||null}}catch({response:e}){const t=e||{type:"error:network:get-request",description:"network error on nexmo get request"};throw t.validation&&(t.description=t.validation[Object.keys(t.validation)[0]]),t}}static addUrlSearchParams(e,t={}){let r=new URL(e);return Object.keys(t).forEach(e=>{!t[e]||"string"==typeof t[e]&&t[e].length<1||null===t[e]||r.searchParams.set(e,t[e])}),r.href}static deepMergeObj(e,t){const r=JSON.parse(JSON.stringify(e));for(let e in t)"[object Object]"===Object.prototype.toString.call(t[e])?r[e]=Utils.deepMergeObj(r[e],t[e]):r[e]=t[e];return r}static injectScript(e,t){if("undefined"!=typeof document){let r=document.getElementsByTagName("head")[0],n=document.createElement("script");n.async=!0,n.src=e,n.onload=n.onreadystatechange=(()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||(n.onload=n.onreadystatechange=null,n=null,t&&t())}),r.insertBefore(n,r.firstChild)}}static allocateUUID(){return i.default.v4()}static validateDTMF(e){return"string"==typeof e&&/^[\da-dA-D#*pP]{1,45}$$/.test(e)}static _getBugsnagKey(){return"76498fc1ca8d9b0a173a44e2b873d7ed"}static updateMemberLegs(e,t){if(e){const r=e.find(e=>e.leg_id===t.body.leg_id);if(r){if(r.status!==t.body.status){let n=e.indexOf(r);e.fill(r.status=t.body.status,n,n++)}}else e.push({leg_id:t.body.leg_id,status:t.body.status})}else e=[{leg_id:t.body.leg_id,status:t.body.status}];return e}static _isCallEvent(e){const{channel:t,media:r}=e.body;return"rtc:transfer"===e.type||!(!t||!(r&&r.audio_settings&&r.audio_settings.enabled||r&&r.audio&&r.audio.enabled||t.knocking_id))}static async _fetchImage(e,t){const{response:r}=await Utils.networkRequest({type:"GET",url:e,responseType:"arraybuffer",token:t}),n=new Uint8Array(r);let i="";let s;for(s=0;s<n.length/8192;s++)i+=String.fromCharCode.apply(null,n.subarray(8192*s,8192*(s+1)));return i+=String.fromCharCode.apply(null,n.subarray(8192*s)),"data:image/jpeg;base64,"+btoa(i)}static async _checkHttpConnectivity(e){const t=Date.now();try{return await Utils.networkRequest({type:"GET",url:e}),{url:e,canConnect:!0,connectionTime:Date.now()-t}}catch(t){return{url:e,canConnect:!1,error:t}}}static _checkWsConnectivity(e,t,r){return new Promise((n,i)=>{const o=Object.assign({path:t},r),a=Date.now(),u=s.default.connect(e,o),d=setTimeout(()=>n({url:e,canConnect:!1}),c);u.on("connect",()=>{const t=Date.now()-a;u.disconnect(),clearTimeout(d),n({url:e,canConnect:!0,connectionTime:t})}),u.on("error",t=>{u.disconnect(),clearTimeout(d),n({url:e,canConnect:!1,error:t})})})}static async _checkMediaServers(e,t,r){try{const{response:n}=await Utils.networkRequest({type:"GET",url:`${t}/v0.3/discovery/media/${r}`,token:e}),i=n.map(e=>Utils._checkMediaConnectivity(e.ip,e.port));return await Promise.all(i)}catch(e){return[]}}static async _checkMediaConnectivity(e,t){return new Promise(async(r,n)=>{const i={iceServers:[{urls:`stun:${e}:${t}`}]},s=new RTCPeerConnection(i),o=Date.now(),c=await s.createOffer({offerToReceiveAudio:!0});s.setLocalDescription(c);const u=setTimeout(()=>{s.close(),r({ip:e,canConnect:!1})},a);s.onicecandidate=(({candidate:t})=>{if("srflx"===(null===t||void 0===t?void 0:t.type)){const t=Date.now()-o;clearTimeout(u),s.close(),r({ip:e,canConnect:!0,connectionTime:t})}}),s.onicecandidateerror=(t=>{t.errorCode&&(s.close(),clearTimeout(u),r({ip:e,canConnect:!1,error:t}))})})}static _checkIfUserIsReInvited(e,t){var r;if(!e.has(t.cid))return!1;if("member:invited"!==t.type&&"member:joined"!==t.type)return!1;const n=null===(r=e.get(t.cid))||void 0===r?void 0:r.me;return!!n&&(n.user.name===t.body.user.name&&"LEFT"===n.state)}}r.default=Utils,t.exports=Utils},{"./application":1,"socket.io-client":77,uuid:87}],32:[function(e,t,r){(function(e){(function(){!function(n){if("object"==typeof r&&void 0!==t)t.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).bugsnag=n()}}(function(){var e=function(e,t,r){for(var n=r,i=0,s=e.length;i<s;i++)n=t(n,e[i],i,e);return n},t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=function(e){return e<10?"0"+e:e},i=function(t,r){return e(t,function(e,t,n,i){return e.concat(r(t,n,i))},[])},s=e,o=function(t,r){return e(t,function(e,t,n,i){return r(t,n,i)?e.concat(t):e},[])},a=function(t,r){return e(t,function(e,t,n,i){return!0===e||t===r},!1)},c=function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=function(){var e=new Date;return e.getUTCFullYear()+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())+"T"+n(e.getUTCHours())+":"+n(e.getUTCMinutes())+":"+n(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},d={intRange:function(e,t){return void 0===e&&(e=1),void 0===t&&(t=1/0),function(r){return"number"==typeof r&&parseInt(""+r,10)===r&&r>=e&&r<=t}},stringWithLength:function(e){return"string"==typeof e&&!!e.length}},l={},p=o,h=s,f=function(e){var n,i=[];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.push(n);if(!t)return i;for(var s=0,o=r.length;s<o;s++)Object.prototype.hasOwnProperty.call(e,r[s])&&i.push(r[s]);return i},m=c,g=a,v=d.intRange,y=d.stringWithLength;function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}l.schema={apiKey:{defaultValue:function(){return null},message:"is required",validate:y},appVersion:{defaultValue:function(){return null},message:"should be a string",validate:function(e){return null===e||y(e)}},appType:{defaultValue:function(){return null},message:"should be a string",validate:function(e){return null===e||y(e)}},autoNotify:{defaultValue:function(){return!0},message:"should be true|false",validate:function(e){return!0===e||!1===e}},beforeSend:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:function(e){return"function"==typeof e||m(e)&&p(e,function(e){return"function"==typeof e}).length===e.length}},endpoints:{defaultValue:function(){return{notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}},message:"should be an object containing endpoint URLs { notify, sessions }. sessions is optional if autoCaptureSessions=false",validate:function(e,t){return e&&"object"==typeof e&&y(e.notify)&&(!1===t.autoCaptureSessions||y(e.sessions))&&0===p(f(e),function(e){return!g(["notify","sessions"],e)}).length}},autoCaptureSessions:{defaultValue:function(e,t){return void 0===t.endpoints||!!t.endpoints&&!!t.endpoints.sessions},message:"should be true|false",validate:function(e){return!0===e||!1===e}},notifyReleaseStages:{defaultValue:function(){return null},message:"should be an array of strings",validate:function(e){return null===e||m(e)&&p(e,function(e){return"string"==typeof e}).length===e.length}},releaseStage:{defaultValue:function(){return"production"},message:"should be a string",validate:function(e){return"string"==typeof e&&e.length}},maxBreadcrumbs:{defaultValue:function(){return 20},message:"should be a number ≤40",validate:function(e){return v(0,40)(e)}},autoBreadcrumbs:{defaultValue:function(){return!0},message:"should be true|false",validate:function(e){return"boolean"==typeof e}},user:{defaultValue:function(){return null},message:"(object) user should be an object",validate:function(e){return"object"==typeof e}},metaData:{defaultValue:function(){return null},message:"should be an object",validate:function(e){return"object"==typeof e}},logger:{defaultValue:function(){},message:"should be null or an object with methods { debug, info, warn, error }",validate:function(e){return!e||e&&h(["debug","info","warn","error"],function(t,r){return t&&"function"==typeof e[r]},!0)}},filters:{defaultValue:function(){return["password"]},message:"should be an array of strings|regexes",validate:function(e){return m(e)&&e.length===p(e,function(e){return"string"==typeof e||e&&"function"==typeof e.test}).length}}},l.mergeDefaults=function(e,t){if(!e||!t)throw new Error("opts and schema objects are required");return h(f(t),function(r,n){return r[n]=void 0!==e[n]?e[n]:t[n].defaultValue(e[n],e),r},{})},l.validate=function(e,t){if(!e||!t)throw new Error("opts and schema objects are required");var r=h(f(t),function(r,n){return t[n].validate(e[n],e)?r:r.concat({key:n,message:t[n].message,value:e[n]})},[]);return{valid:!r.length,errors:r}};var b=l.schema,_=i,w={releaseStage:{defaultValue:function(){return/^localhost(:\d+)?$/.test(window.location.host)?"development":"production"},message:"should be set",validate:d.stringWithLength},logger:_extends({},b.logger,{defaultValue:function(){return"undefined"!=typeof console&&"function"==typeof console.debug?C():void 0}})},C=function(){var e={},t=console.log;return _(["debug","info","warn","error"],function(r){var n=console[r];e[r]="function"==typeof n?n.bind(console,"[bugsnag]"):t.bind(console,"[bugsnag]")}),e},S=u,E=function(){function BugsnagBreadcrumb(e,t,r,n){void 0===e&&(e="[anonymous]"),void 0===t&&(t={}),void 0===r&&(r="manual"),void 0===n&&(n=S()),this.type=r,this.name=e,this.metaData=t,this.timestamp=n}return BugsnagBreadcrumb.prototype.toJSON=function toJSON(){return{type:this.type,name:this.name,timestamp:this.timestamp,metaData:this.metaData}},BugsnagBreadcrumb}(),T=function(e){return e.app&&"string"==typeof e.app.releaseStage?e.app.releaseStage:e.config.releaseStage};var k=function isError(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},R=function(e,t){return e.isIgnored()||!1===t},P={};!function(e,t){"use strict";"object"==typeof P?P=t():e.StackFrame=t()}(this,function(){"use strict";function _isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function _capitalize(e){return e.charAt(0).toUpperCase()+e.substring(1)}function _getter(e){return function(){return this[e]}}var e=["isConstructor","isEval","isNative","isToplevel"],t=["columnNumber","lineNumber"],r=["fileName","functionName","source"],n=e.concat(t,r,["args"]);function StackFrame(e){if(e instanceof Object)for(var t=0;t<n.length;t++)e.hasOwnProperty(n[t])&&void 0!==e[n[t]]&&this["set"+_capitalize(n[t])](e[n[t]])}StackFrame.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof StackFrame)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new StackFrame(e)}},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(_isNumber(this.getLineNumber())?":"+this.getLineNumber():"")+(_isNumber(this.getColumnNumber())?":"+this.getColumnNumber():"")}};for(var i=0;i<e.length;i++)StackFrame.prototype["get"+_capitalize(e[i])]=_getter(e[i]),StackFrame.prototype["set"+_capitalize(e[i])]=function(e){return function(t){this[e]=Boolean(t)}}(e[i]);for(var s=0;s<t.length;s++)StackFrame.prototype["get"+_capitalize(t[s])]=_getter(t[s]),StackFrame.prototype["set"+_capitalize(t[s])]=function(e){return function(t){if(!_isNumber(t))throw new TypeError(e+" must be a Number");this[e]=Number(t)}}(t[s]);for(var o=0;o<r.length;o++)StackFrame.prototype["get"+_capitalize(r[o])]=_getter(r[o]),StackFrame.prototype["set"+_capitalize(r[o])]=function(e){return function(t){this[e]=String(t)}}(r[o]);return StackFrame});var x={};!function(e,t){"use strict";"object"==typeof x?x=t(P):e.ErrorStackParser=t(e.StackFrame)}(this,function ErrorStackParser(e){"use strict";var t=/(^|@)\S+\:\d+/,r=/^\s*at .*(\S+\:\d+|\(native\))/m,n=/^(eval@)?(\[native code\])?$/;return{parse:function ErrorStackParser$$parse(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(r))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function ErrorStackParser$$extractLocation(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(e.replace(/[\(\)]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function ErrorStackParser$$parseV8OrIE(t){return t.stack.split("\n").filter(function(e){return!!e.match(r)},this).map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var r=t.replace(/^\s+/,"").replace(/\(eval code/g,"("),n=r.match(/ (\((.+):(\d+):(\d+)\)$)/),i=(r=n?r.replace(n[0],""):r).split(/\s+/).slice(1),s=this.extractLocation(n?n[1]:i.pop()),o=i.join(" ")||void 0,a=["eval","<anonymous>"].indexOf(s[0])>-1?void 0:s[0];return new e({functionName:o,fileName:a,lineNumber:s[1],columnNumber:s[2],source:t})},this)},parseFFOrSafari:function ErrorStackParser$$parseFFOrSafari(t){return t.stack.split("\n").filter(function(e){return!e.match(n)},this).map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var r=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=t.match(r),i=n&&n[1]?n[1]:void 0,s=this.extractLocation(t.replace(r,""));return new e({functionName:i,fileName:s[0],lineNumber:s[1],columnNumber:s[2],source:t})},this)},parseOpera:function ErrorStackParser$$parseOpera(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function ErrorStackParser$$parseOpera9(t){for(var r=/Line (\d+).*script (?:in )?(\S+)/i,n=t.message.split("\n"),i=[],s=2,o=n.length;s<o;s+=2){var a=r.exec(n[s]);a&&i.push(new e({fileName:a[2],lineNumber:a[1],source:n[s]}))}return i},parseOpera10:function ErrorStackParser$$parseOpera10(t){for(var r=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=t.stacktrace.split("\n"),i=[],s=0,o=n.length;s<o;s+=2){var a=r.exec(n[s]);a&&i.push(new e({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:n[s]}))}return i},parseOpera11:function ErrorStackParser$$parseOpera11(r){return r.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var r,n=t.split("@"),i=this.extractLocation(n.pop()),s=n.shift()||"",o=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;s.match(/\(([^\)]*)\)/)&&(r=s.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===r||"[arguments not available]"===r?void 0:r.split(",");return new e({functionName:o,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})},this)}}});var O=x,A=function(e){return!(!e||!e.stack&&!e.stacktrace&&!e["opera#sourceloc"]||"string"!=typeof(e.stack||e.stacktrace||e["opera#sourceloc"])||e.stack===e.name+": "+e.message)},M={};function ___extends_24(){return(___extends_24=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}!function(e,t){"use strict";"object"==typeof M?M=t(P):e.StackGenerator=t(e.StackFrame)}(this,function(e){return{backtrace:function StackGenerator$$backtrace(t){var r=[],n=10;"object"==typeof t&&"number"==typeof t.maxStackSize&&(n=t.maxStackSize);for(var i=arguments.callee;i&&r.length<n&&i.arguments;){for(var s=new Array(i.arguments.length),o=0;o<s.length;++o)s[o]=i.arguments[o];/function(?:\s+([\w$]+))+\s*\(/.test(i.toString())?r.push(new e({functionName:RegExp.$1||void 0,args:s})):r.push(new e({args:s}));try{i=i.caller}catch(e){break}}return r}}});var j=s,N=o,I=function(){function BugsnagReport(e,t,r,n,i){void 0===r&&(r=[]),void 0===n&&(n=B()),this.__isBugsnagReport=!0,this._ignored=!1,this._handledState=n,this.app=void 0,this.apiKey=void 0,this.breadcrumbs=[],this.context=void 0,this.device=void 0,this.errorClass=F(e,"[no error class]"),this.errorMessage=F(t,"[no error message]"),this.groupingHash=void 0,this.metaData={},this.request=void 0,this.severity=this._handledState.severity,this.stacktrace=j(r,function(e,t){var r=D(t);try{return"{}"===JSON.stringify(r)?e:e.concat(r)}catch(t){return e}},[]),this.user=void 0,this.session=void 0,this.originalError=i}var e=BugsnagReport.prototype;return e.ignore=function ignore(){this._ignored=!0},e.isIgnored=function isIgnored(){return this._ignored},e.updateMetaData=function updateMetaData(e){var t,r;return e?null===(arguments.length<=1?void 0:arguments[1])?this.removeMetaData(e):null===(arguments.length<=2?void 0:arguments[2])?this.removeMetaData(e,arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):("object"==typeof(arguments.length<=1?void 0:arguments[1])&&(r=arguments.length<=1?void 0:arguments[1]),"string"==typeof(arguments.length<=1?void 0:arguments[1])&&((t={})[arguments.length<=1?void 0:arguments[1]]=arguments.length<=2?void 0:arguments[2],r=t),r?(this.metaData[e]||(this.metaData[e]={}),this.metaData[e]=___extends_24({},this.metaData[e],r),this):this):this},e.removeMetaData=function removeMetaData(e,t){return"string"!=typeof e?this:t?this.metaData[e]?(delete this.metaData[e][t],this):this:(delete this.metaData[e],this)},e.toJSON=function toJSON(){return{payloadVersion:"4",exceptions:[{errorClass:this.errorClass,message:this.errorMessage,stacktrace:this.stacktrace,type:"browserjs"}],severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,breadcrumbs:this.breadcrumbs,context:this.context,user:this.user,metaData:this.metaData,groupingHash:this.groupingHash,request:this.request,session:this.session}},BugsnagReport}(),D=function(e){var t={file:e.fileName,method:L(e.functionName),lineNumber:e.lineNumber,columnNumber:e.columnNumber,code:void 0,inProject:void 0};return t.lineNumber>-1&&!t.file&&!t.method&&(t.file="global code"),t},L=function(e){return/^global code$/i.test(e)?"global code":e},B=function(){return{unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}},F=function(e,t){return"string"==typeof e&&e?e:t};I.getStacktrace=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=0),A(e))return O.parse(e).slice(t);try{throw e}catch(t){if(A(t))return O.parse(e).slice(1+r);try{return N(M.backtrace(),function(e){return-1===(e.functionName||"").indexOf("StackGenerator$$")}).slice(1+r)}catch(e){return[]}}},I.ensureReport=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=0),e.__isBugsnagReport)return e;try{var n=I.getStacktrace(e,t,1+r);return new I(e.name,e.message,n,void 0,e)}catch(t){return new I(e.name,e.message,[],void 0,e)}};var U=I,q=function pad(e,t){var r="000000000"+e;return r.substr(r.length-t)},$="object"==typeof window?window:self,W=0;for(var G in $)Object.hasOwnProperty.call($,G)&&W++;var V=navigator.mimeTypes?navigator.mimeTypes.length:0,z=q((V+navigator.userAgent.length).toString(36)+W.toString(36),4),H=function fingerprint(){return z},K=0,J=4,X=36,Y=Math.pow(X,J);function randomBlock(){return q((Math.random()*Y<<0).toString(X),J)}function cuid(){return"c"+(new Date).getTime().toString(X)+q(function safeCounter(){return K=K<Y?K:0,++K-1}().toString(X),J)+H()+(randomBlock()+randomBlock())}cuid.fingerprint=H;var Q=cuid,Z=u,ee=function(){function Session(){this.id=Q(),this.startedAt=Z(),this._handled=0,this._unhandled=0}var e=Session.prototype;return e.toJSON=function toJSON(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}},e.trackError=function trackError(e){this[e._handledState.unhandled?"_unhandled":"_handled"]+=1},Session}();function ___extends_4(){return(___extends_4=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var te=i,re=a,ne=c,ie=function(){function BugsnagClient(e){if(!(e&&e.name&&e.version&&e.url))throw new Error("`notifier` argument is required");this.notifier=e,this._configured=!1,this._opts={},this.config={},this._delivery={sendSession:function(){},sendReport:function(){}},this._logger={debug:function(){},info:function(){},warn:function(){},error:function(){}},this._plugins={},this._session=null,this.breadcrumbs=[],this.app={},this.context=void 0,this.device=void 0,this.metaData=void 0,this.request=void 0,this.user={},this.BugsnagClient=BugsnagClient,this.BugsnagReport=U,this.BugsnagBreadcrumb=E,this.BugsnagSession=ee;var t=this,r=this.notify;this.notify=function(){return r.apply(t,arguments)}}var e=BugsnagClient.prototype;return e.setOptions=function setOptions(e){this._opts=___extends_4({},this._opts,e)},e.configure=function configure(e){void 0===e&&(e=l.schema);var t=l.mergeDefaults(this._opts,e),r=l.validate(t,e);if(!0==!r.valid)throw new Error(ae(r.errors));return"function"==typeof t.beforeSend&&(t.beforeSend=[t.beforeSend]),t.appVersion&&(this.app.version=t.appVersion),t.appType&&(this.app.type=t.appType),t.metaData&&(this.metaData=t.metaData),t.user&&(this.user=t.user),t.logger&&this.logger(t.logger),this.config=___extends_4({},this.config,t),this._configured=!0,this},e.use=function use(e){if(!this._configured)throw new Error("client not configured");e.configSchema&&this.configure(e.configSchema);for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=e.init.apply(e,[this].concat(r));return e.name&&(this._plugins["~"+e.name+"~"]=i),this},e.getPlugin=function getPlugin(e){return this._plugins["~"+e+"~"]},e.delivery=function delivery(e){return this._delivery=e(this),this},e.logger=function logger(e,t){return this._logger=e,this},e.sessionDelegate=function sessionDelegate(e){return this._sessionDelegate=e,this},e.startSession=function startSession(){return this._sessionDelegate?this._sessionDelegate.startSession(this):(this._logger.warn("No session implementation is installed"),this)},e.leaveBreadcrumb=function leaveBreadcrumb(e,t,r,n){if(!this._configured)throw new Error("client not configured");if(e=e||void 0,r="string"==typeof r?r:void 0,n="string"==typeof n?n:void 0,t="object"==typeof t&&null!==t?t:void 0,"string"==typeof e||t){var i=new E(e,t,r,n);return this.breadcrumbs.push(i),this.breadcrumbs.length>this.config.maxBreadcrumbs&&(this.breadcrumbs=this.breadcrumbs.slice(this.breadcrumbs.length-this.config.maxBreadcrumbs)),this}},e.notify=function notify(e,t,r){var n=this;if(void 0===t&&(t={}),void 0===r&&(r=function(){}),!this._configured)throw new Error("client not configured");var i=T(this),s=se(e,t,this._logger),o=s.err,a=s.errorFramesToSkip,c=s._opts;c&&(t=c),"object"==typeof t&&null!==t||(t={});var u=U.ensureReport(o,a,2);if(u.app=___extends_4({},{releaseStage:i},u.app,this.app),u.context=u.context||t.context||this.context||void 0,u.device=___extends_4({},u.device,this.device,t.device),u.request=___extends_4({},u.request,this.request,t.request),u.user=___extends_4({},u.user,this.user,t.user),u.metaData=___extends_4({},u.metaData,this.metaData,t.metaData),u.breadcrumbs=this.breadcrumbs.slice(0),this._session&&(this._session.trackError(u),u.session=this._session),void 0!==t.severity&&(u.severity=t.severity,u._handledState.severityReason={type:"userSpecifiedSeverity"}),ne(this.config.notifyReleaseStages)&&!re(this.config.notifyReleaseStages,i))return this._logger.warn("Report not sent due to releaseStage/notifyReleaseStages configuration"),r(null,u);var d=u.severity,l=function(e){n._logger.error("Error occurred in beforeSend callback, continuing anyway…"),n._logger.error(e)};!function(e,t,r){var n=e.length,i=0,s=function(){if(i>=n)return r(null,!1);t(e[i],function(e,t){return e?r(e,!1):!0===t?r(null,!0):(i++,void s())})};s()}([].concat(t.beforeSend).concat(this.config.beforeSend),function(e,t){return function(r,n){if("function"!=typeof r)return n(null,!1);try{if(2!==r.length){var i=r(e);return i&&"function"==typeof i.then?i.then(function(t){return setTimeout(function(){return n(null,R(e,t))},0)},function(e){setTimeout(function(){return t(e),n(null,!1)})}):n(null,R(e,i))}r(e,function(r,i){if(r)return t(r),n(null,!1);n(null,R(e,i))})}catch(e){t(e),n(null,!1)}}}(u,l),function(e,t){if(e&&l(e),t)return n._logger.debug("Report not sent due to beforeSend callback"),r(null,u);n.config.autoBreadcrumbs&&n.leaveBreadcrumb(u.errorClass,{errorClass:u.errorClass,errorMessage:u.errorMessage,severity:u.severity},"error"),d!==u.severity&&(u._handledState.severityReason={type:"userCallbackSetSeverity"}),n._delivery.sendReport({apiKey:u.apiKey||n.config.apiKey,notifier:n.notifier,events:[u]},function(e){return r(e,u)})})},BugsnagClient}(),se=function(e,t,r){var n,i,s=function(e){var t=ce(e);return r.warn("Usage error. "+t),new Error("Bugsnag usage error. "+t)},o=0;switch(typeof e){case"string":"string"==typeof t?(n=s("string/string"),i={metaData:{notifier:{notifyArgs:[e,t]}}}):(n=new Error(String(e)),o=3);break;case"number":case"boolean":n=new Error(String(e));break;case"function":n=s("function");break;case"object":null!==e&&(k(e)||e.__isBugsnagReport)?n=e:null!==e&&oe(e)?((n=new Error(e.message||e.errorMessage)).name=e.name||e.errorClass,o=3):n=s(null===e?"null":"unsupported object");break;default:n=s("nothing")}return{err:n,errorFramesToSkip:o,_opts:i}},oe=function(e){return!("string"!=typeof e.name&&"string"!=typeof e.errorClass||"string"!=typeof e.message&&"string"!=typeof e.errorMessage)},ae=function(e){return"Bugsnag configuration error\n"+te(e,function(e){return'"'+e.key+'" '+e.message+" \n    got "+ue(e.value)}).join("\n\n")},ce=function(e){return"notify() expected error/opts parameters, got "+e},ue=function(e){return"object"==typeof e?JSON.stringify(e):String(e)},de=ie,le=function(e,t,r,n){var i=n&&n.filterKeys?n.filterKeys:[],s=n&&n.filterPaths?n.filterPaths:[];return JSON.stringify(function prepareObjForSerialization(e,t,r){var n=[],i=0;return function visit(e,s){function edgesExceeded(){return s.length>fe&&i>he}i++;if(s.length>pe)return me;if(edgesExceeded())return me;if(null===e||"object"!=typeof e)return e;if(function find(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1}(n,e))return"[Circular]";n.push(e);if("function"==typeof e.toJSON)try{i--;var o=visit(e.toJSON(),s);return n.pop(),o}catch(e){return throwsMessage(e)}var a=function __isError_19(e){return e instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(e))}(e);if(a){i--;var c=visit({name:e.name,message:e.message},s);return n.pop(),c}if(function __isArray_19(e){return"[object Array]"===Object.prototype.toString.call(e)}(e)){for(var u=[],d=0,l=e.length;d<l;d++){if(edgesExceeded()){u.push(me);break}u.push(visit(e[d],s.concat("[]")))}return n.pop(),u}var p={};try{for(var h in e)if(Object.prototype.hasOwnProperty.call(e,h))if(isDescendent(r,s.join("."))&&shouldFilter(t,h))p[h]="[Filtered]";else{if(edgesExceeded()){p[h]=me;break}p[h]=visit(safelyGetProp(e,h),s.concat(h))}}catch(e){}n.pop();return p}(e,[])}(e,i,s),t,r)},pe=20,he=25e3,fe=8,me="...";function throwsMessage(e){return"[Throws: "+(e?e.message:"?")+"]"}function isDescendent(e,t){for(var r=0,n=e.length;r<n;r++)if(0===t.indexOf(e[r]))return!0;return!1}function shouldFilter(e,t){for(var r=0,n=e.length;r<n;r++){if("string"==typeof e[r]&&e[r]===t)return!0;if(e[r]&&"function"==typeof e[r].test&&e[r].test(t))return!0}return!1}function safelyGetProp(e,t){try{return e[t]}catch(e){return throwsMessage(e)}}var ge={},ve=["events.[].app","events.[].metaData","events.[].user","events.[].breadcrumbs","events.[].request","events.[].device"],ye=["device","app","user"];ge.report=function(e,t){var r=le(e,null,null,{filterPaths:ve,filterKeys:t});if(r.length>1e6&&(delete e.events[0].metaData,e.events[0].metaData={notifier:"WARNING!\nSerialized payload was "+r.length/1e6+"MB (limit = 1MB)\nmetaData was removed"},(r=le(e,null,null,{filterPaths:ve,filterKeys:t})).length>1e6))throw new Error("payload exceeded 1MB limit");return r},ge.session=function(e,t){var r=le(e,null,null,{filterPaths:ye,filterKeys:t});if(r.length>1e6)throw new Error("payload exceeded 1MB limit");return r};var be,_e=this,we=u;be=function(e,t){return void 0===t&&(t=window),{sendReport:function(r,n){void 0===n&&(n=function(){});var i=Ce(e.config,"notify","4",t),s=new t.XDomainRequest;s.onload=function(){n(null)},s.open("POST",i),setTimeout(function(){try{s.send(ge.report(r,e.config.filters))}catch(t){e._logger.error(t),n(t)}},0)},sendSession:function(r,n){void 0===n&&(n=function(){});var i=Ce(e.config,"sessions","1",t),s=new t.XDomainRequest;s.onload=function(){n(null)},s.open("POST",i),setTimeout(function(){try{s.send(ge.session(r,e.config.filters))}catch(e){_e._logger.error(e),n(e)}},0)}}};var Ce=function(e,t,r,n){return Se(e.endpoints[t],n.location.protocol)+"?apiKey="+encodeURIComponent(e.apiKey)+"&payloadVersion="+r+"&sentAt="+encodeURIComponent(we())},Se=be._matchPageProtocol=function(e,t){return"http:"===t?e.replace(/^https:/,"http:"):e},Ee=u,Te=function(e,t){return void 0===t&&(t=window),{sendReport:function(r,n){void 0===n&&(n=function(){});try{var i=e.config.endpoints.notify,s=new t.XMLHttpRequest;s.onreadystatechange=function(){s.readyState===t.XMLHttpRequest.DONE&&n(null)},s.open("POST",i),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Bugsnag-Api-Key",r.apiKey||e.config.apiKey),s.setRequestHeader("Bugsnag-Payload-Version","4"),s.setRequestHeader("Bugsnag-Sent-At",Ee()),s.send(ge.report(r,e.config.filters))}catch(t){e._logger.error(t)}},sendSession:function(r,n){void 0===n&&(n=function(){});try{var i=e.config.endpoints.sessions,s=new t.XMLHttpRequest;s.onreadystatechange=function(){s.readyState===t.XMLHttpRequest.DONE&&n(null)},s.open("POST",i),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Bugsnag-Api-Key",e.config.apiKey),s.setRequestHeader("Bugsnag-Payload-Version","1"),s.setRequestHeader("Bugsnag-Sent-At",Ee()),s.send(ge.session(r,e.config.filters))}catch(t){e._logger.error(t)}}}},ke={init:function(e,t){void 0===t&&(t=window),e.config.beforeSend.unshift(function(e){e.context||(e.context=t.location.pathname)})}};function ___extends_29(){return(___extends_29=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Re=u,Pe={init:function(e,t){void 0===t&&(t=navigator);var r={locale:t.browserLanguage||t.systemLanguage||t.userLanguage||t.language,userAgent:t.userAgent};e.device=___extends_29({},r,e.device),e.config.beforeSend.unshift(function(e){e.device=___extends_29({},e.device,{time:Re()})})}};function ___extends_30(){return(___extends_30=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var xe={init:function(e,t){void 0===t&&(t=window),e.config.beforeSend.unshift(function(e){e.request&&e.request.url||(e.request=___extends_30({},e.request,{url:t.location.href}))})}};function ___extends_31(){return(___extends_31=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Oe=c,Ae=a,Me={init:function(e){return e.sessionDelegate(je)}},je={startSession:function(e){var t=e;t._session=new e.BugsnagSession;var r=T(t);return Oe(t.config.notifyReleaseStages)&&!Ae(t.config.notifyReleaseStages,r)?(t._logger.warn("Session not sent due to releaseStage/notifyReleaseStages configuration"),t):t.config.endpoints.sessions?(t._delivery.sendSession({notifier:t.notifier,device:t.device,app:___extends_31({},{releaseStage:r},t.app),sessions:[{id:t._session.id,startedAt:t._session.startedAt,user:t.user}]}),t):(t._logger.warn("Session not sent due to missing endpoints.sessions configuration"),t)}};function ___extends_32(){return(___extends_32=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ne={init:function(e){e.config.collectUserIp||e.config.beforeSend.push(function(e){e.user&&void 0===e.user.id&&delete e.user.id,e.user=___extends_32({id:"[NOT COLLECTED]"},e.user),e.request=___extends_32({clientIp:"[NOT COLLECTED]"},e.request)})},configSchema:{collectUserIp:{defaultValue:function(){return!0},message:"should be true|false",validate:function(e){return!0===e||!1===e}}}},Ie={},De=i,Le=s,Be=o;Ie.init=function(e){var t=/^dev(elopment)?$/.test(e.config.releaseStage),r=!1===e.config.consoleBreadcrumbsEnabled,n=(!1===e.config.autoBreadcrumbs||t)&&!0!==e.config.consoleBreadcrumbsEnabled;r||n||De(Fe,function(t){var r=console[t];console[t]=function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];e.leaveBreadcrumb("Console output",Le(i,function(e,t,r){var n="[Unknown value]";try{n=String(t)}catch(e){}if("[object Object]"===n)try{n=JSON.stringify(t)}catch(e){}return e["["+r+"]"]=n,e},{severity:0===t.indexOf("group")?"log":t}),"log"),r.apply(console,i)},console[t]._restore=function(){console[t]=r}})},Ie.configSchema={consoleBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}};var Fe=Be(["log","debug","info","warn","error"],function(e){return"undefined"!=typeof console&&"function"==typeof console[e]}),Ue=i,qe=s,$e=o,We={init:function(e,t,r){if(void 0===t&&(t=document),void 0===r&&(r=window),e.config.trackInlineScripts){var n=r.location.href,i="",s=!1,o=function(){return t.documentElement.outerHTML};i=o();var a=t.onreadystatechange;t.onreadystatechange=function(){"interactive"===t.readyState&&(i=o(),s=!0);try{a.apply(this,arguments)}catch(e){}};var c=null,u=function(e){c=e},d=function(){var e=t.currentScript||c;if(!e&&!s){var r=t.scripts||t.getElementsByTagName("script");e=r[r.length-1]}return e};e.config.beforeSend.unshift(function(e){e.stacktrace=$e(e.stacktrace,function(e){return!/__trace__$/.test(e.method)});var t=e.stacktrace[0];if(!t||!t.file||t.file.replace(/#.*$/,"")===n.replace(/#.*$/,"")){var r=d();if(r){var a=r.innerHTML;e.updateMetaData("script","content",a.length<=5e5?a:a.substr(0,5e5))}t&&t.lineNumber&&(t.code=function(e){s&&i||(i=o());var t=["\x3c!-- DOC START --\x3e"].concat(i.split("\n")),r=e-1,n=Math.max(r-3,0),a=Math.min(r+3,t.length);return qe(t.slice(n,a),function(e,t,r){return e[n+1+r]=t.length<=200?t:t.substr(0,200),e},{})}(t.lineNumber))}});var l=Ue(["setTimeout","setInterval","setImmediate","requestAnimationFrame"],function(e){return __proxy(r,e,function(e){return __traceOriginalScript(e,function(e){return{get:function(){return e[0]},replace:function(t){e[0]=t}}})})})[0];Ue(["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],function(e){r[e]&&r[e].prototype&&r[e].prototype.hasOwnProperty&&r[e].prototype.hasOwnProperty("addEventListener")&&(__proxy(r[e].prototype,"addEventListener",function(e){return __traceOriginalScript(e,eventTargetCallbackAccessor)}),__proxy(r[e].prototype,"removeEventListener",function(e){return __traceOriginalScript(e,eventTargetCallbackAccessor,!0)}))})}function __traceOriginalScript(e,t,r){return void 0===r&&(r=!1),function(){var n=Array.prototype.slice.call(arguments);try{var i=t(n),s=i.get();if(r&&e.apply(this,n),"function"!=typeof s)return e.apply(this,n);if(s.__trace__)i.replace(s.__trace__);else{var o=d();s.__trace__=function __trace__(){u(o),l(function(){u(null)},0);var e=s.apply(this,arguments);return u(null),e},s.__trace__.__trace__=s.__trace__,i.replace(s.__trace__)}}catch(e){}if(e.apply)return e.apply(this,n);switch(n.length){case 1:return e(n[0]);case 2:return e(n[0],n[1]);default:return e()}}}},configSchema:{trackInlineScripts:{validate:function(e){return!0===e||!1===e},defaultValue:function(){return!0},message:"should be true|false"}}};function __proxy(e,t,r){var n=e[t];if(!n)return n;var i=r(n);return e[t]=i,n}function eventTargetCallbackAccessor(e){var t=!!e[1]&&"function"==typeof e[1].handleEvent;return{get:function(){return t?e[1].handleEvent:e[1]},replace:function(r){t?e[1].handleEvent=r:e[1]=r}}}var Ge={init:function(e,t){if(void 0===t&&(t=window),"addEventListener"in t){var r=!1===e.config.interactionBreadcrumbsEnabled,n=!1===e.config.autoBreadcrumbs&&!0!==e.config.interactionBreadcrumbsEnabled;r||n||t.addEventListener("click",function(r){var n,i;try{n=Ve(r.target),i=function getNodeSelector(e,t){var r=[e.tagName];e.id&&r.push("#"+e.id);e.className&&e.className.length&&r.push("."+e.className.split(" ").join("."));if(!t.document.querySelectorAll||!Array.prototype.indexOf)return r.join("");try{if(1===t.document.querySelectorAll(r.join("")).length)return r.join("")}catch(e){return r.join("")}if(e.parentNode.childNodes.length>1){var n=Array.prototype.indexOf.call(e.parentNode.childNodes,e)+1;r.push(":nth-child("+n+")")}if(1===t.document.querySelectorAll(r.join("")).length)return r.join("");if(e.parentNode)return getNodeSelector(e.parentNode,t)+" > "+r.join("");return r.join("")}(r.target,t)}catch(t){n="[hidden]",i="[hidden]",e._logger.error("Cross domain error when tracking click event. See docs: https://tinyurl.com/yy3rn63z")}e.leaveBreadcrumb("UI click",{targetText:n,targetSelector:i},"user")},!0)}},configSchema:{interactionBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}}},Ve=function(e){var t=e.textContent||e.innerText||"";return t||"submit"!==e.type&&"button"!==e.type||(t=e.value),function truncate(e,t){return e&&e.length<=t?e:e.slice(0,t-"(...)".length)+"(...)"}(t=t.replace(/^\s+|\s+$/g,""),140)};var ze,He,Ke,Je={init:function(e,t){if(void 0===t&&(t=window),"addEventListener"in t){var r=!1===e.config.navigationBreadcrumbsEnabled,n=!1===e.config.autoBreadcrumbs&&!0!==e.config.navigationBreadcrumbsEnabled;if(!r&&!n){var i=function(t){return function(){return e.leaveBreadcrumb(t,{},"navigation")}};t.addEventListener("pagehide",i("Page hidden"),!0),t.addEventListener("pageshow",i("Page shown"),!0),t.addEventListener("load",i("Page loaded"),!0),t.document.addEventListener("DOMContentLoaded",i("DOMContentLoaded"),!0),t.addEventListener("load",function(){return t.addEventListener("popstate",i("Navigated back"),!0)}),t.addEventListener("hashchange",function(r){var n=r.oldURL?{from:Xe(r.oldURL,t),to:Xe(r.newURL,t),state:Qe(t)}:{to:Xe(t.location.href,t)};e.leaveBreadcrumb("Hash changed",n,"navigation")},!0),t.history.replaceState&&Ye(e,t.history,"replaceState",t),t.history.pushState&&Ye(e,t.history,"pushState",t),e.leaveBreadcrumb("Bugsnag loaded",{},"navigation")}}},configSchema:{navigationBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}}},Xe=function(e,t){var r=t.document.createElement("A");return r.href=e,""+r.pathname+r.search+r.hash},Ye=function(e,t,r,n){var i=t[r];t[r]=function(s,o,a){e.leaveBreadcrumb("History "+r,function(e,t,r,n){var i=Xe(e.location.href,e);return{title:r,state:t,prevState:Qe(e),to:n||i,from:i}}(n,s,o,a),"navigation"),"function"==typeof e.refresh&&e.refresh(),e.config.autoCaptureSessions&&e.startSession(),i.apply(t,[s,o].concat(void 0!==a?a:[]))}},Qe=function(e){try{return e.history.state}catch(e){}},Ze={},et="request",tt="BS~~U",rt="BS~~M",nt=a,it=function(){return[ze.config.endpoints.notify,ze.config.endpoints.sessions]};Ze.name="networkBreadcrumbs",Ze.init=function(e,t,r){void 0===t&&(t=it),void 0===r&&(r=window);var n=!1===e.config.networkBreadcrumbsEnabled,i=!1===e.config.autoBreadcrumbs&&!0!==e.config.networkBreadcrumbsEnabled;n||i||(ze=e,He=r,Ke=t,st(),ot())},Ze.configSchema={networkBreadcrumbsEnabled:{defaultValue:function(){},validate:function(e){return!0===e||!1===e||void 0===e},message:"should be true|false"}};var st=function(){if("addEventListener"in He.XMLHttpRequest.prototype){var e=He.XMLHttpRequest.prototype.open;He.XMLHttpRequest.prototype.open=function open(t,r){this[tt]=r,this[rt]=t,this["BS~~S"]&&(this.removeEventListener("load",handleXHRLoad),this.removeEventListener("error",handleXHRError)),this.addEventListener("load",handleXHRLoad),this.addEventListener("error",handleXHRError),this["BS~~S"]=!0,e.apply(this,arguments)}}};function handleXHRLoad(){if(!nt(Ke(),this[tt])){var e={status:this.status,request:this[rt]+" "+this[tt]};this.status>=400?ze.leaveBreadcrumb("XMLHttpRequest failed",e,et):ze.leaveBreadcrumb("XMLHttpRequest succeeded",e,et)}}function handleXHRError(){nt(Ke,this[tt])||ze.leaveBreadcrumb("XMLHttpRequest error",{request:this[rt]+" "+this[tt]},et)}var ot=function(){if("fetch"in He&&!He.fetch.polyfill){var e=He.fetch;He.fetch=function fetch(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r[0],s=r[1],o="GET";return s&&s.method&&(o=s.method),new Promise(function(t,n){e.apply(void 0,r).then(function(e){at(e,o,i),t(e)}).catch(function(e){ct(o,i),n(e)})})}}},at=function(e,t,r){var n={status:e.status,request:t+" "+r};e.status>=400?ze.leaveBreadcrumb("fetch() failed",n,et):ze.leaveBreadcrumb("fetch() succeeded",n,et)},ct=function(e,t){ze.leaveBreadcrumb("fetch() error",{request:e+" "+t},et)},ut=d.intRange,dt={init:function(e){var t=0;e.config.beforeSend.push(function(r){if(t>=e.config.maxEvents)return r.ignore();t++}),e.refresh=function(){t=0}},configSchema:{maxEvents:{defaultValue:function(){return 10},message:"should be a positive integer ≤100",validate:function(e){return ut(1,100)(e)}}}},lt={};function ___extends_39(){return(___extends_39=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var pt=i,ht=(lt={init:function(e){e.config.beforeSend.push(function(e){e.stacktrace=pt(e.stacktrace,function(e){return ___extends_39({},e,{file:ht(e.file)})})})}})._strip=function(e){return"string"==typeof e?e.replace(/\?.*$/,"").replace(/#.*$/,""):e},ft={init:function(e,t){void 0===t&&(t=window);var r=t.onerror;t.onerror=function onerror(t,n,i,s,o){if(0===i&&/Script error\.?/.test(t))e._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/yy3rn63z");else{var a,c={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}};if(o)o.name&&o.message?a=new e.BugsnagReport(o.name,o.message,mt(e.BugsnagReport.getStacktrace(o),n,i,s),c,o):(a=new e.BugsnagReport("window.onerror",String(o),mt(e.BugsnagReport.getStacktrace(o,1),n,i,s),c,o)).updateMetaData("window onerror",{error:o});else if("object"!=typeof t||null===t||n&&"string"==typeof n||i||s||o)(a=new e.BugsnagReport("window.onerror",String(t),mt(e.BugsnagReport.getStacktrace(o,1),n,i,s),c,t)).updateMetaData("window onerror",{event:t});else{var u=t.type?"Event: "+t.type:"window.onerror",d=t.message||t.detail||"";(a=new e.BugsnagReport(u,d,e.BugsnagReport.getStacktrace(new Error,1).slice(1),c,t)).updateMetaData("window onerror",{event:t,extraParameters:n})}e.notify(a)}"function"==typeof r&&r.apply(this,arguments)}}},mt=function(e,t,r,n){var i=e[0];return i?(i.fileName||"string"!=typeof t||i.setFileName(t),!i.lineNumber&&gt(r)&&i.setLineNumber(r),i.columnNumber||(gt(n)?i.setColumnNumber(n):window.event&&gt(window.event.errorCharacter)&&i.setColumnNumber(window.event.errorCharacter)),e):e},gt=function(e){return"number"==typeof e&&"NaN"!==String.call(e)},vt={},yt=s;vt.init=function(e,t){void 0===t&&(t=window);var r=function(t){var r=t.reason,n=!1;try{t.detail&&t.detail.reason&&(r=t.detail.reason,n=!0)}catch(e){}var i,s={severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}};if(r&&A(r))i=new e.BugsnagReport(r.name,r.message,O.parse(r),s,r),n&&(i.stacktrace=yt(i.stacktrace,wt(r),[]));else{(i=new e.BugsnagReport(r&&r.name?r.name:"UnhandledRejection",r&&r.message?r.message:'Rejection reason was not an Error. See "Promise" tab for more detail.',[],s,r)).updateMetaData("promise","rejection reason",_t(r))}e.notify(i)};"addEventListener"in t?t.addEventListener("unhandledrejection",r):t.onunhandledrejection=function(e,t){r({detail:{reason:e,promise:t}})},r};var bt,_t=function(e){return null===e||void 0===e?"undefined (or null)":k(e)?((t={})[Object.prototype.toString.call(e)]={name:e.name,message:e.message,code:e.code,stack:e.stack},t):e;var t},wt=function(e){return function(t,r){return r.file===e.toString()?t:(r.method&&(r.method=r.method.replace(/^\s+/,"")),t.concat(r))}};function ___extends_2(){return(___extends_2=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ct=___extends_2({},l.schema,w);return(bt=function(e){"string"==typeof e&&(e={apiKey:e});var t="";e.endpoints&&e.endpoints.notify&&!e.endpoints.sessions&&(t+="notify endpoint is set but sessions endpoint is not. No sessions will be sent.");var r=new de({name:"Bugsnag JavaScript",version:"6.4.3",url:"https://github.com/bugsnag/bugsnag-js"});return r.setOptions(e),r.delivery(window.XDomainRequest?be:Te),r.configure(Ct),t&&r._logger.warn(t),r.use(Pe),r.use(ke),r.use(xe),r.use(dt),r.use(Me),r.use(Ne),r.use(lt),!1!==r.config.autoNotify&&(r.use(ft),r.use(vt)),r.use(Je),r.use(Ge),r.use(Ze),r.use(Ie),r.use(We),r._logger.debug("Loaded!"),r.config.autoCaptureSessions?r.startSession():r}).Bugsnag={Client:de,Report:U,Session:ee,Breadcrumb:E},bt.default=bt,bt})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(e,t,r){t.exports=e("@bugsnag/browser")},{"@bugsnag/browser":32}],34:[function(e,t,r){function Emitter(e){if(e)return function mixin(e){for(var t in Emitter.prototype)e[t]=Emitter.prototype[t];return e}(e)}r.Emitter=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Emitter.prototype.once=function(e,t){function on(){this.off(e,on),t.apply(this,arguments)}return on.fn=t,this.on(e,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},Emitter.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Emitter.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],35:[function(e,t,r){"use strict";r.byteLength=function byteLength(e){var t=getLens(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function toByteArray(e){var t,r,n=getLens(e),o=n[0],a=n[1],c=new s(function _byteLength(e,t,r){return 3*(t+r)/4-r}(0,o,a)),u=0,d=a>0?o-4:o;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[u++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},r.fromByteArray=function fromByteArray(e){for(var t,r=e.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(encodeChunk(e,o,o+16383>a?a:o+16383));1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return s.join("")};for(var n=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)n[a]=o[a],i[o.charCodeAt(a)]=a;function getLens(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function encodeChunk(e,t,r){for(var i,s,o=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],36:[function(e,t,r){(function(n){(function(){r.formatArgs=function formatArgs(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&"%c"===e&&(i=++n)}),e.splice(i,0,r)},r.save=function save(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function load(){let e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},r.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function localstorage(){try{return localStorage}catch(e){}}(),r.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(r);const{formatters:i}=t.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":37,_process:65}],37:[function(e,t,r){t.exports=function setup(t){function createDebug(e){let t,r=null;function debug(...e){if(!debug.enabled)return;const r=debug,n=Number(new Date),i=n-(t||n);r.diff=i,r.prev=t,r.curr=n,t=n,e[0]=createDebug.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,n)=>{if("%%"===t)return"%";s++;const i=createDebug.formatters[n];if("function"==typeof i){const n=e[s];t=i.call(r,n),e.splice(s,1),s--}return t}),createDebug.formatArgs.call(r,e),(r.log||createDebug.log).apply(r,e)}return debug.namespace=e,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(e),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null===r?createDebug.enabled(e):r,set:e=>{r=e}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(e,t){const r=createDebug(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function toNamespace(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(e){return e instanceof Error?e.stack||e.message:e},createDebug.disable=function disable(){const e=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(e=>"-"+e)].join(",");return createDebug.enable(""),e},createDebug.enable=function enable(e){let t;createDebug.save(e),createDebug.names=[],createDebug.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+e.substr(1)+"$")):createDebug.names.push(new RegExp("^"+e+"$")))},createDebug.enabled=function enabled(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=createDebug.skips.length;t<r;t++)if(createDebug.skips[t].test(e))return!1;for(t=0,r=createDebug.names.length;t<r;t++)if(createDebug.names[t].test(e))return!0;return!1},createDebug.humanize=e("ms"),createDebug.destroy=function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{createDebug[e]=t[e]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=function selectColor(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return createDebug.colors[Math.abs(t)%createDebug.colors.length]},createDebug.enable(createDebug.load()),createDebug}},{ms:64}],38:[function(e,t,r){(function(e){(function(){"use strict";var t=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n};Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function BrowserInfo(e,t,r){this.name=e,this.version=t,this.os=r}}();r.BrowserInfo=n;var i=function(){return function NodeInfo(t){this.version=t,this.name="node",this.os=e.platform}}();r.NodeInfo=i;var s=function(){return function BotInfo(){this.bot=!0,this.name="bot",this.version=null,this.os=null}}();r.BotInfo=s;var o=3,a=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],c=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function parseUserAgent(e){var r=""!==e&&a.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var s=i.exec(e);return!!s&&[n,s]},!1);if(!r)return null;var i=r[0],c=r[1];if("searchbot"===i)return new s;var u=c[1]&&c[1].split(/[._]/).slice(0,3);return u?u.length<o&&(u=t(u,function createVersionParts(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}(o-u.length))):u=[],new n(i,u.join("."),detectOS(e))}function detectOS(e){for(var t=0,r=c.length;t<r;t++){var n=c[t],i=n[0];if(n[1].test(e))return i}return null}function getNodeVersion(){return void 0!==e&&e.version?new i(e.version.slice(1)):null}r.detect=function detect(e){return e?parseUserAgent(e):"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):getNodeVersion()},r.parseUserAgent=parseUserAgent,r.detectOS=detectOS,r.getNodeVersion=getNodeVersion}).call(this)}).call(this,e("_process"))},{_process:65}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.hasCORS=void 0;let n=!1;try{n="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}r.hasCORS=n},{}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decode=r.encode=void 0,r.encode=function encode(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},r.decode=function decode(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}},{}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parse=void 0;const n=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];r.parse=function parse(e){const t=e,r=e.indexOf("["),s=e.indexOf("]");-1!=r&&-1!=s&&(e=e.substring(0,r)+e.substring(r,s).replace(/:/g,";")+e.substring(s,e.length));let o=n.exec(e||""),a={},c=14;for(;c--;)a[i[c]]=o[c]||"";return-1!=r&&-1!=s&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function pathNames(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,a.path),a.queryKey=function queryKey(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}(0,a.query),a}},{}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.yeast=r.decode=r.encode=void 0;const n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,s={};let o,a=0,c=0;function encode(e){let t="";do{t=n[e%i]+t,e=Math.floor(e/i)}while(e>0);return t}for(r.encode=encode,r.decode=function decode(e){let t=0;for(c=0;c<e.length;c++)t=t*i+s[e.charAt(c)];return t},r.yeast=function yeast(){const e=encode(+new Date);return e!==o?(a=0,o=e):e+"."+encode(a++)};c<i;c++)s[n[c]]=c},{}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.globalThisShim=void 0,r.globalThisShim=(()=>"undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")())()},{}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.nextTick=r.parse=r.installTimerFunctions=r.transports=r.Transport=r.protocol=r.Socket=void 0;const n=e("./socket.js");Object.defineProperty(r,"Socket",{enumerable:!0,get:function(){return n.Socket}}),r.protocol=n.Socket.protocol;var i=e("./transport.js");Object.defineProperty(r,"Transport",{enumerable:!0,get:function(){return i.Transport}});var s=e("./transports/index.js");Object.defineProperty(r,"transports",{enumerable:!0,get:function(){return s.transports}});var o=e("./util.js");Object.defineProperty(r,"installTimerFunctions",{enumerable:!0,get:function(){return o.installTimerFunctions}});var a=e("./contrib/parseuri.js");Object.defineProperty(r,"parse",{enumerable:!0,get:function(){return a.parse}});var c=e("./transports/websocket-constructor.js");Object.defineProperty(r,"nextTick",{enumerable:!0,get:function(){return c.nextTick}})},{"./contrib/parseuri.js":41,"./socket.js":45,"./transport.js":46,"./transports/index.js":47,"./transports/websocket-constructor.js":49,"./util.js":52}],45:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Socket=void 0;const i=e("./transports/index.js"),s=e("./util.js"),o=e("./contrib/parseqs.js"),a=e("./contrib/parseuri.js"),c=n(e("debug")),u=e("@socket.io/component-emitter"),d=e("engine.io-parser"),l=(0,c.default)("engine.io-client:socket");class Socket extends u.Emitter{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=(0,a.parse)(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=(0,a.parse)(t.host).host),(0,s.installTimerFunctions)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=(0,o.decode)(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=(()=>{this.onClose("transport close",{description:"network connection lost"})}),addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){l('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=d.protocol,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return l("options: %j",r),new i.transports[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return l("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){l("setting transport %s",e.name),this.transport&&(l("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(e){l('probing transport "%s"',e);let t=this.createTransport(e),r=!1;Socket.priorWebsocketSuccess=!1;const n=()=>{r||(l('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",n=>{if(!r)if("pong"===n.type&&"probe"===n.data){if(l('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Socket.priorWebsocketSuccess="websocket"===t.name,l('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{r||"closed"!==this.readyState&&(l("changing transport and sending upgrade packet"),s(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{l('probe transport "%s" failed',e);const r=new Error("probe error");r.transport=t.name,this.emitReserved("upgradeError",r)}}))};function freezeTransport(){r||(r=!0,s(),t.close(),t=null)}const i=r=>{const n=new Error("probe error: "+r);n.transport=t.name,freezeTransport(),l('probe transport "%s" failed because of error: %s',e,r),this.emitReserved("upgradeError",n)};function onTransportClose(){i("transport closed")}function onclose(){i("socket closed")}function onupgrade(e){t&&e.name!==t.name&&(l('"%s" works - aborting "%s"',e.name,t.name),freezeTransport())}const s=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",onTransportClose),this.off("close",onclose),this.off("upgrading",onupgrade)};t.once("open",n),t.once("error",i),t.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),t.open()}onOpen(){if(l("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){l("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(l('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else l('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();l("flushing %d packets in socket",e.length),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=(0,s.byteLength)(r)),t>0&&e>this.maxPayload)return l("only send %d out of %d packets",t,this.writeBuffer.length),this.writeBuffer.slice(0,t);e+=2}return l("payload size is %d (max: %d)",e,this.maxPayload),this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),l("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){l("socket error %j",e),Socket.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(l('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}r.Socket=Socket,Socket.protocol=d.protocol},{"./contrib/parseqs.js":40,"./contrib/parseuri.js":41,"./transports/index.js":47,"./util.js":52,"@socket.io/component-emitter":34,debug:36,"engine.io-parser":57}],46:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Transport=void 0;const i=e("engine.io-parser"),s=e("@socket.io/component-emitter"),o=e("./util.js"),a=(0,n(e("debug")).default)("engine.io-client:transport");class TransportError extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}r.Transport=class Transport extends s.Emitter{constructor(e){super(),this.writable=!1,(0,o.installTimerFunctions)(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new TransportError(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):a("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=(0,i.decodePacket)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}},{"./util.js":52,"@socket.io/component-emitter":34,debug:36,"engine.io-parser":57}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.transports=void 0;const n=e("./polling.js"),i=e("./websocket.js");r.transports={websocket:i.WS,polling:n.Polling}},{"./polling.js":48,"./websocket.js":50}],48:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Request=r.Polling=void 0;const i=e("../transport.js"),s=n(e("debug")),o=e("../contrib/yeast.js"),a=e("../contrib/parseqs.js"),c=e("engine.io-parser"),u=e("./xmlhttprequest.js"),d=e("@socket.io/component-emitter"),l=e("../util.js"),p=e("../globalThis.js"),h=(0,s.default)("engine.io-client:polling");function empty(){}const f=null!=new u.XHR({xdomain:!1}).responseType;r.Polling=class Polling extends i.Transport{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=f&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{h("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(h("we are currently polling - waiting to pause"),e++,this.once("pollComplete",function(){h("pre-pause polling complete"),--e||t()})),this.writable||(h("we are currently writing - waiting to pause"),e++,this.once("drain",function(){h("pre-pause writing complete"),--e||t()}))}else t()}poll(){h("polling"),this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){h("polling got data %s",e),(0,c.decodePayload)(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this.poll():h('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{h("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(h("transport open - closing"),e()):(h("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,(0,c.encodePayload)(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,o.yeast)()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=(0,a.encode)(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Request(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){h("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}};class Request extends d.Emitter{constructor(e,t){super(),(0,l.installTimerFunctions)(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=(0,l.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new u.XHR(e);try{h("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=(()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof t.status?t.status:0)},0))}),h("xhr data %s",this.data),t.send(this.data)}catch(e){return void this.setTimeoutFn(()=>{this.onError(e)},0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(r.Request=Request,Request.requestsCount=0,Request.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){const e="onpagehide"in p.globalThisShim?"pagehide":"unload";addEventListener(e,unloadHandler,!1)}function unloadHandler(){for(let e in Request.requests)Request.requests.hasOwnProperty(e)&&Request.requests[e].abort()}},{"../contrib/parseqs.js":40,"../contrib/yeast.js":42,"../globalThis.js":43,"../transport.js":46,"../util.js":52,"./xmlhttprequest.js":51,"@socket.io/component-emitter":34,debug:36,"engine.io-parser":57}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultBinaryType=r.usingBrowserWebSocket=r.WebSocket=r.nextTick=void 0;const n=e("../globalThis.js");r.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),r.WebSocket=n.globalThisShim.WebSocket||n.globalThisShim.MozWebSocket,r.usingBrowserWebSocket=!0,r.defaultBinaryType="arraybuffer"},{"../globalThis.js":43}],50:[function(e,t,r){(function(t){(function(){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.WS=void 0;const i=e("../transport.js"),s=e("../contrib/parseqs.js"),o=e("../contrib/yeast.js"),a=e("../util.js"),c=e("./websocket-constructor.js"),u=n(e("debug")),d=e("engine.io-parser"),l=(0,u.default)("engine.io-client:websocket"),p="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();r.WS=class WS extends i.Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=p?{}:(0,a.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=c.usingBrowserWebSocket&&!p?t?new c.WebSocket(e,t):new c.WebSocket(e):new c.WebSocket(e,t,r)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||c.defaultBinaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=(()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()}),this.ws.onclose=(e=>this.onClose({description:"websocket connection closed",context:e})),this.ws.onmessage=(e=>this.onData(e.data)),this.ws.onerror=(e=>this.onError("websocket error",e))}write(e){this.writable=!1;for(let r=0;r<e.length;r++){const n=e[r],i=r===e.length-1;(0,d.encodePacket)(n,this.supportsBinary,e=>{const r={};!c.usingBrowserWebSocket&&(n.options&&(r.compress=n.options.compress),this.opts.perMessageDeflate)&&("string"==typeof e?t.byteLength(e):e.length)<this.opts.perMessageDeflate.threshold&&(r.compress=!1);try{c.usingBrowserWebSocket?this.ws.send(e):this.ws.send(e,r)}catch(e){l("websocket closed before onclose event")}i&&(0,c.nextTick)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,o.yeast)()),this.supportsBinary||(e.b64=1);const n=(0,s.encode)(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!c.WebSocket}}}).call(this)}).call(this,e("buffer").Buffer)},{"../contrib/parseqs.js":40,"../contrib/yeast.js":42,"../transport.js":46,"../util.js":52,"./websocket-constructor.js":49,buffer:58,debug:36,"engine.io-parser":57}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.XHR=void 0;const n=e("../contrib/has-cors.js"),i=e("../globalThis.js");r.XHR=function XHR(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n.hasCORS))return new XMLHttpRequest}catch(e){}if(!t)try{return new(i.globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},{"../contrib/has-cors.js":39,"../globalThis.js":43}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.byteLength=r.installTimerFunctions=r.pick=void 0;const n=e("./globalThis.js");r.pick=function pick(e,...t){return t.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})};const i=n.globalThisShim.setTimeout,s=n.globalThisShim.clearTimeout;r.installTimerFunctions=function installTimerFunctions(e,t){t.useNativeTimers?(e.setTimeoutFn=i.bind(n.globalThisShim),e.clearTimeoutFn=s.bind(n.globalThisShim)):(e.setTimeoutFn=n.globalThisShim.setTimeout.bind(n.globalThisShim),e.clearTimeoutFn=n.globalThisShim.clearTimeout.bind(n.globalThisShim))};const o=1.33;r.byteLength=function byteLength(e){return"string"==typeof e?function utf8Length(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)(t=e.charCodeAt(n))<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil((e.byteLength||e.size)*o)}},{"./globalThis.js":43}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ERROR_PACKET=r.PACKET_TYPES_REVERSE=r.PACKET_TYPES=void 0;const n=Object.create(null);r.PACKET_TYPES=n,n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const i=Object.create(null);r.PACKET_TYPES_REVERSE=i,Object.keys(n).forEach(e=>{i[n[e]]=e});r.ERROR_PACKET={type:"error",data:"parser error"}},{}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decode=r.encode=void 0;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<n.length;e++)i[n.charCodeAt(e)]=e;r.encode=(e=>{let t,r=new Uint8Array(e),i=r.length,s="";for(t=0;t<i;t+=3)s+=n[r[t]>>2],s+=n[(3&r[t])<<4|r[t+1]>>4],s+=n[(15&r[t+1])<<2|r[t+2]>>6],s+=n[63&r[t+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s});r.decode=(e=>{let t,r,n,s,o,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);const d=new ArrayBuffer(a),l=new Uint8Array(d);for(t=0;t<c;t+=4)r=i[e.charCodeAt(t)],n=i[e.charCodeAt(t+1)],s=i[e.charCodeAt(t+2)],o=i[e.charCodeAt(t+3)],l[u++]=r<<2|n>>4,l[u++]=(15&n)<<4|s>>2,l[u++]=(3&s)<<6|63&o;return d})},{}],55:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./commons.js"),i=e("./contrib/base64-arraybuffer.js"),s="function"==typeof ArrayBuffer,o=(e,t)=>{if(s){const r=(0,i.decode)(e);return a(r,t)}return{base64:!0,data:e}},a=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}};r.default=((e,t)=>{if("string"!=typeof e)return{type:"message",data:a(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:o(e.substring(1),t)}:n.PACKET_TYPES_REVERSE[r]?e.length>1?{type:n.PACKET_TYPES_REVERSE[r],data:e.substring(1)}:{type:n.PACKET_TYPES_REVERSE[r]}:n.ERROR_PACKET})},{"./commons.js":53,"./contrib/base64-arraybuffer.js":54}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./commons.js"),i="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),s="function"==typeof ArrayBuffer,o=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+e)},r.readAsDataURL(e)};r.default=(({type:e,data:t},r,a)=>i&&t instanceof Blob?r?a(t):o(t,a):s&&(t instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer)(t))?r?a(t):o(new Blob([t]),a):a(n.PACKET_TYPES[e]+(t||"")))},{"./commons.js":53}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decodePayload=r.decodePacket=r.encodePayload=r.encodePacket=r.protocol=void 0;const n=e("./encodePacket.js");r.encodePacket=n.default;const i=e("./decodePacket.js");r.decodePacket=i.default;const s=String.fromCharCode(30);r.encodePayload=((e,t)=>{const r=e.length,i=new Array(r);let o=0;e.forEach((e,a)=>{(0,n.default)(e,!1,e=>{i[a]=e,++o===r&&t(i.join(s))})})});r.decodePayload=((e,t)=>{const r=e.split(s),n=[];for(let e=0;e<r.length;e++){const s=(0,i.default)(r[e],t);if(n.push(s),"error"===s.type)break}return n}),r.protocol=4},{"./decodePacket.js":55,"./encodePacket.js":56}],58:[function(e,t,r){(function(t){(function(){"use strict";var t=e("base64-js"),n=e("ieee754");r.Buffer=Buffer,r.SlowBuffer=function SlowBuffer(e){+e!=e&&(e=0);return Buffer.alloc(+e)},r.INSPECT_MAX_BYTES=50;var i=2147483647;function createBuffer(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=Buffer.prototype,t}function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,r)}function from(e,t,r){if("string"==typeof e)return function fromString(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|byteLength(e,t),n=createBuffer(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return function fromArrayBuffer(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=Buffer.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var i=function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),r=createBuffer(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(void 0!==e.length)return"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e);if("Buffer"===e.type&&Array.isArray(e.data))return fromArrayLike(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function allocUnsafe(e){return assertSize(e),createBuffer(e<0?0:0|checked(e))}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),r=createBuffer(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function checked(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function byteLength(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||isInstance(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(i)return n?-1:utf8ToBytes(e).length;t=(""+t).toLowerCase(),i=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),numberIsNaN(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,i){var s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function read(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(s=r;s<a;s++)if(read(e,s)===read(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var d=!0,l=0;l<c;l++)if(read(e,s+l)!==read(t,l)){d=!1;break}if(d)return s}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(numberIsNaN(a))return o;e[r+o]=a}return o}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(function utf16leToBytes(e,t){for(var r,n,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function base64Slice(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,c,u,d=e[i],l=null,p=d>239?4:d>223?3:d>191?2:1;if(i+p<=r)switch(p){case 1:d<128&&(l=d);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&d)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&d)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],c=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&c)&&(u=(15&d)<<18|(63&o)<<12|(63&a)<<6|63&c)>65535&&u<1114112&&(l=u)}null===l?(l=65533,p=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=p}return function decodeCodePointsArray(e){var t=e.length;if(t<=s)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=s));return r}(n)}r.kMaxLength=i,Buffer.TYPED_ARRAY_SUPPORT=function typedArraySupport(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(e,t,r){return from(e,t,r)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(e,t,r){return function alloc(e,t,r){return assertSize(e),e<=0?createBuffer(e):void 0!==t?"string"==typeof r?createBuffer(e).fill(t,r):createBuffer(e).fill(t):createBuffer(e)}(e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(e)},Buffer.isBuffer=function isBuffer(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function compare(e,t){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function isEncoding(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(isInstance(s,Uint8Array)&&(s=Buffer.from(s)),!Buffer.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function swap32(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function swap64(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function toString(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function inspect(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},Buffer.prototype.compare=function compare(e,t,r,n,i){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,o=r-t,a=Math.min(s,o),c=this.slice(n,i),u=e.slice(t,r),d=0;d<a;++d)if(c[d]!==u[d]){s=c[d],o=u[d];break}return s<o?-1:o<s?1:0},Buffer.prototype.includes=function includes(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function indexOf(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function write(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var s=4096;function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=toHex(e[s]);return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,i,s){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function checkIEEE754(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,i,s){return t=+t,r>>>=0,s||checkIEEE754(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function writeDouble(e,t,r,i,s){return t=+t,r>>>=0,s||checkIEEE754(e,0,r,8),n.write(e,t,r,i,52,8),r+8}Buffer.prototype.slice=function slice(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=Buffer.prototype,n},Buffer.prototype.readUIntLE=function readUIntLE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},Buffer.prototype.readUIntBE=function readUIntBE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer.prototype.readUInt8=function readUInt8(e,t){return e>>>=0,t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function readUInt16LE(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function readIntLE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function readIntBE(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},Buffer.prototype.readInt8=function readInt8(e,t){return e>>>=0,t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function readInt16LE(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function readInt16BE(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function readInt32LE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function readFloatLE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),n.read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(e,t){return e>>>=0,t||checkOffset(e,4,this.length),n.read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(e,t){return e>>>=0,t||checkOffset(e,8,this.length),n.read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(e,t){return e>>>=0,t||checkOffset(e,8,this.length),n.read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},Buffer.prototype.writeUIntBE=function writeUIntBE(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},Buffer.prototype.writeUInt8=function writeUInt8(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function writeIntLE(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},Buffer.prototype.writeIntBE=function writeIntBE(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},Buffer.prototype.writeInt8=function writeInt8(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function writeInt16LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function writeInt16BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function writeInt32LE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function writeInt32BE(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function writeFloatLE(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function writeFloatBE(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function copy(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},Buffer.prototype.fill=function fill(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=Buffer.isBuffer(e)?e:Buffer.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var o=/[^+/0-9A-Za-z-_]/g;function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function base64ToBytes(e){return t.toByteArray(function base64clean(e){if((e=(e=e.split("=")[0]).trim().replace(o,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function blitBuffer(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":35,buffer:58,ieee754:59}],59:[function(e,t,r){r.read=function(e,t,r,n,i){var s,o,a=8*i-n-1,c=(1<<a)-1,u=c>>1,d=-7,l=r?i-1:0,p=r?-1:1,h=e[t+l];for(l+=p,s=h&(1<<-d)-1,h>>=-d,d+=a;d>0;s=256*s+e[t+l],l+=p,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=n;d>0;o=256*o+e[t+l],l+=p,d-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,n),s-=u}return(h?-1:1)*o*Math.pow(2,s-n)},r.write=function(e,t,r,n,i,s){var o,a,c,u=8*s-i-1,d=(1<<u)-1,l=d>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:s-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+l>=1?p/c:p*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=d?(a=0,o=d):o+l>=1?(a=(t*c-1)*Math.pow(2,i),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;e[r+h]=255&a,h+=f,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[r+h]=255&o,h+=f,o/=256,u-=8);e[r+h-f]|=128*m}},{}],60:[function(e,t,r){"use strict";const n=e=>e&&e.includeBoundaries?"(?:(?<=\\s|^)(?=[a-fA-F\\d:])|(?<=[a-fA-F\\d:])(?=\\s|$))":"",i="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",o=`\n(?:\n(?:${s}:){7}(?:${s}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${s}:){6}(?:${i}|:${s}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${s}:){5}(?::${i}|(?::${s}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${s}:){4}(?:(?::${s}){0,1}:${i}|(?::${s}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${s}:){3}(?:(?::${s}){0,2}:${i}|(?::${s}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${s}:){2}(?:(?::${s}){0,3}:${i}|(?::${s}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${s}:){1}(?:(?::${s}){0,4}:${i}|(?::${s}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${s}){0,5}:${i}|(?::${s}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),a=new RegExp(`(?:^${i}$)|(?:^${o}$)`),c=new RegExp(`^${i}$`),u=new RegExp(`^${o}$`),d=e=>e&&e.exact?a:new RegExp(`(?:${n(e)}${i}${n(e)})|(?:${n(e)}${o}${n(e)})`,"g");d.v4=(e=>e&&e.exact?c:new RegExp(`${n(e)}${i}${n(e)}`,"g")),d.v6=(e=>e&&e.exact?u:new RegExp(`${n(e)}${o}${n(e)}`,"g")),t.exports=d},{}],61:[function(e,t,r){"use strict";const n=e("ip-regex"),i=e=>n({exact:!0}).test(e);i.v4=(e=>n.v4({exact:!0}).test(e)),i.v6=(e=>n.v6({exact:!0}).test(e)),i.version=(e=>i(e)?i.v4(e)?4:6:void 0),t.exports=i},{"ip-regex":60}],62:[function(e,t,r){var n,i;n=this,i=function(e){"use strict";var t,r,n={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},i={},s={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:function(e,r){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var s=e.methodFactory,o=e.name||"",a=i[o]||i[""]||n;return i[o]||(e.methodFactory=function methodFactory(e,t,r){var n=s(e,t,r),a=i[r]||i[""],c=-1!==a.template.indexOf("%t"),u=-1!==a.template.indexOf("%l"),d=-1!==a.template.indexOf("%n");return function(){for(var t="",s=arguments.length,l=Array(s),p=0;p<s;p++)l[p]=arguments[p];if(o||!i[r]){var h=a.timestampFormatter(new Date),f=a.levelFormatter(e),m=a.nameFormatter(r);a.format?t+=a.format(f,m,h):(t+=a.template,c&&(t=t.replace(/%t/,h)),u&&(t=t.replace(/%l/,f)),d&&(t=t.replace(/%n/,m))),l.length&&"string"==typeof l[0]?l[0]=t+" "+l[0]:l.unshift(t)}n.apply(void 0,l)}}),(r=r||{}).template&&(r.format=void 0),i[o]=function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(t in arguments[r])Object.prototype.hasOwnProperty.call(arguments[r],t)&&(e[t]=arguments[r][t]);return e}({},a,r),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e}};return e&&(r=e.prefix,s.noConflict=function(){return e.prefix===s&&(e.prefix=r),s}),s},"function"==typeof define&&define.amd?define(i):"object"==typeof t&&t.exports?t.exports=i():n.prefix=i(n)},{}],63:[function(e,t,r){!function(e,r){"use strict";"function"==typeof define&&define.amd?define(r):"object"==typeof t&&t.exports?t.exports=r():e.log=r()}(this,function(){"use strict";var e=function(){},t="undefined",r=typeof window!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function bindMethod(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function traceForIE(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function replaceLoggingMethods(t,r){for(var i=0;i<n.length;i++){var s=n[i];this[s]=i<t?e:this.methodFactory(s,t,r)}this.log=this.debug}function defaultMethodFactory(n,i,s){return function realMethod(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?traceForIE:void 0!==console[n]?bindMethod(console,n):void 0!==console.log?bindMethod(console,"log"):e)}(n)||function enableLoggingWhenConsoleArrives(e,r,n){return function(){typeof console!==t&&(replaceLoggingMethods.call(this,r,n),this[e].apply(this,arguments))}}.apply(this,arguments)}function Logger(e,r,i){var s,o=this,a="loglevel";function getPersistedLevel(){var e;if(typeof window!==t){try{e=window.localStorage[a]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(a)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}e&&(a+=":"+e),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||defaultMethodFactory,o.getLevel=function(){return s},o.setLevel=function(r,i){if("string"==typeof r&&void 0!==o.levels[r.toUpperCase()]&&(r=o.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==i&&function persistLevelIfPossible(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[a]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+r+";"}catch(e){}}}(r),replaceLoggingMethods.call(o,r,e),typeof console===t&&r<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){getPersistedLevel()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var c=getPersistedLevel();null==c&&(c=null==r?"WARN":r),o.setLevel(c,!1)}var i=new Logger,s={};i.getLogger=function getLogger(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=s[e];return t||(t=s[e]=new Logger(e,i.getLevel(),i.methodFactory)),t};var o=typeof window!==t?window.log:void 0;return i.noConflict=function(){return typeof window!==t&&window.log===i&&(window.log=o),i},i.getLoggers=function getLoggers(){return s},i})},{}],64:[function(e,t,r){var n=1e3,i=60*n,s=60*i,o=24*s,a=7*o,c=365.25*o;function plural(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function parse(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*c;case"weeks":case"week":case"w":return r*a;case"days":case"day":case"d":return r*o;case"hours":case"hour":case"hrs":case"hr":case"h":return r*s;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function fmtLong(e){var t=Math.abs(e);if(t>=o)return plural(e,t,o,"day");if(t>=s)return plural(e,t,s,"hour");if(t>=i)return plural(e,t,i,"minute");if(t>=n)return plural(e,t,n,"second");return e+" ms"}(e):function fmtShort(e){var t=Math.abs(e);if(t>=o)return Math.round(e/o)+"d";if(t>=s)return Math.round(e/s)+"h";if(t>=i)return Math.round(e/i)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],65:[function(e,t,r){var n,i,s=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)return setTimeout(e,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{i="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){i=defaultClearTimeout}}();var o,a=[],c=!1,u=-1;function cleanUpNextTick(){c&&o&&(c=!1,o.length?a=o.concat(a):u=-1,a.length&&drainQueue())}function drainQueue(){if(!c){var e=runTimeout(cleanUpNextTick);c=!0;for(var t=a.length;t;){for(o=a,a=[];++u<t;)o&&o[u].run();u=-1,t=a.length}o=null,c=!1,function runClearTimeout(e){if(i===clearTimeout)return clearTimeout(e);if((i===defaultClearTimeout||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new Item(e,t)),1!==a.length||c||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=noop,s.addListener=noop,s.once=noop,s.off=noop,s.removeListener=noop,s.removeAllListeners=noop,s.emit=noop,s.prependListener=noop,s.prependOnceListener=noop,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],66:[function(e,t,r){const{iterateReports:n}=e("./utils");t.exports=function calculateMos(e){let t,r,i,s=0,o=0,a=0,c=0;return n(e,e=>{"inbound-rtp"===e.type&&(s=e.jitter,a=e.packetsLost,o=e.packetsReceived)}),o+a>0&&(c=a/(o+a)*100),r=(t=100+2*s+10)<160?93.2-t/40:93.2-(t-120)/10,(r-=2.5*c)<1&&(r=1),parseFloat(i=1+.035*r+7e-6*r*(r-60)*(100-r)).toFixed(6)}},{"./utils":69}],67:[function(e,t,r){const{iterateReports:n}=e("./utils"),{parsers:i}=e("./parsers/new-api"),s=e("./calculate-mos");t.exports=function parse(e){const t={};return n(e,e=>{if(e.type in i){const r=i[e.type](e);Object.assign(t,r)}}),t.networkMos=parseFloat(s(e)),t}},{"./calculate-mos":66,"./parsers/new-api":68,"./utils":69}],68:[function(e,t,r){const n={"outbound-rtp":{packetsSent:"audioSentPackets",bytesSent:"audioSentBytes"},"inbound-rtp":{packetsReceived:"audioRecvPackets",packetsLost:"audioRecvPacketsLost",bytesReceived:"audioRecvBytes",jitter:"audioRecvJitter"},"remote-inbound-rtp":{packetsLost:"audioSentPacketsLost",roundTripTime:"audioRtt",jitter:"audioSentJitter"}},i={"remote-candidate":function(e){return s(e)},"inbound-rtp":function(e){return s(e)},"outbound-rtp":function(e){return s(e)},"remote-inbound-rtp":function(e){return s(e)}},s=e=>{const{type:t}=e,r=n[t],i={};for(let t in r)if(t in e){let n;i[n="function"==typeof r[t]?r[t](e):r[t]]=e[t]}else i[r[t]]=null;return i};t.exports={rules:n,parsers:i}},{}],69:[function(e,t,r){t.exports={iterateReports:function iterateReports(e,t){if("function"==typeof e[Symbol.iterator])for(const r of e)t(Array.isArray(r)?r[1]:r);else for(const r in e)e.hasOwnProperty(r)&&t(e[r])}}},{}],70:[function(e,t,r){"use strict";var n=e("sdp");function writeMediaSection(e,t,r,i,s){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":s||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o}function getCommonCapabilities(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var s=n(e.parameters.apt,r),o=n(t.parameters.apt,i);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach(function(n){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!i(n,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function isActionAllowedInSignalingState(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function maybeAddCandidate(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function makeError(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function addTrackToStreamAndFireEvent(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function fireAddTrack(t,r,n,i){var s=new Event("track");s.track=r,s.receiver=n,s.transceiver={receiver:n},s.streams=i,e.setTimeout(function(){t._dispatchEvent("track",s)})}var r=function(r){var i=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=s[e].bind(s)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function filterIceServers(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},r.prototype.addTrack=function(t,r){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw makeError("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},r.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},r.prototype.removeTrack=function(t){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw makeError("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},r.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},r.prototype._gather=function(t,r){var i=this,s=this.transceivers[r].iceGatherer;if(!s.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),s.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==s.state&&"gathering"!==s.state||(s.state="completed");else{"new"===s.state&&(s.state="gathering"),a.component=1,a.ufrag=s.getLocalParameters().usernameFragment;var u=n.writeCandidate(a);o.candidate=Object.assign(o.candidate,n.parseCandidate(u)),o.candidate.candidate=u,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=n.getMediaSections(i._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+d.join("");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",o),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){s.onlocalcandidate(e)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,r,i){var s=getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},r.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+e.type+'"'));if(!isActionAllowedInSignalingState("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var s=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var o=i.transceivers[t],a=o.iceGatherer,c=o.iceTransport,u=o.dtlsTransport,d=o.localCapabilities,l=o.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var p=n.getIceParameters(e,r),h=n.getDtlsParameters(e,r);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===c.state&&c.start(a,p,s?"controlling":"controlled"),"new"===u.state&&u.start(h));var f=getCommonCapabilities(d,l);i._transceive(o,f.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(r){var i=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+r.type+'"'));if(!isActionAllowedInSignalingState("setRemoteDescription",r.type,i.signalingState)||i._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set remote "+r.type+" in state "+i.signalingState));var s={};i.remoteStreams.forEach(function(e){s[e.id]=e});var o=[],a=n.splitSections(r.sdp),c=a.shift(),u=n.matchPrefix(c,"a=ice-lite").length>0,d=n.matchPrefix(c,"a=group:BUNDLE ").length>0;i.usingBundle=d;var l=n.matchPrefix(c,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!l&&l.substr(14).split(" ").indexOf("trickle")>=0,a.forEach(function(a,l){var p=n.splitLines(a),h=n.getKind(a),f=n.isRejected(a)&&0===n.matchPrefix(a,"a=bundle-only").length,m=p[0].substr(2).split(" ")[2],g=n.getDirection(a,c),v=n.parseMsid(a),y=n.getMid(a)||n.generateIdentifier();if(f||"application"===h&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))i.transceivers[l]={mid:y,kind:h,protocol:m,rejected:!0};else{var b,_,w,C,S,E,T,k,R;!f&&i.transceivers[l]&&i.transceivers[l].rejected&&(i.transceivers[l]=i._createTransceiver(h,!0));var P,x,O=n.parseRtpParameters(a);f||(P=n.getIceParameters(a,c),(x=n.getDtlsParameters(a,c)).role="client"),T=n.parseRtpEncodingParameters(a);var A=n.parseRtcpParameters(a),M=n.matchPrefix(a,"a=end-of-candidates",c).length>0,j=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!f&&d&&l>0&&i.transceivers[l]&&(i._disposeIceAndDtlsTransports(l),i.transceivers[l].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[l].iceTransport=i.transceivers[0].iceTransport,i.transceivers[l].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[l].rtpSender&&i.transceivers[l].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[l].rtpReceiver&&i.transceivers[l].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==r.type||f){if("answer"===r.type&&!f){_=(b=i.transceivers[l]).iceGatherer,w=b.iceTransport,C=b.dtlsTransport,S=b.rtpReceiver,E=b.sendEncodingParameters,k=b.localCapabilities,i.transceivers[l].recvEncodingParameters=T,i.transceivers[l].remoteCapabilities=O,i.transceivers[l].rtcpParameters=A,j.length&&"new"===w.state&&(!u&&!M||d&&0!==l?j.forEach(function(e){maybeAddCandidate(b.iceTransport,e)}):w.setRemoteCandidates(j)),d&&0!==l||("new"===w.state&&w.start(_,P,"controlling"),"new"===C.state&&C.start(x)),!getCommonCapabilities(b.localCapabilities,b.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,i._transceive(b,"sendrecv"===g||"recvonly"===g,"sendrecv"===g||"sendonly"===g),!S||"sendrecv"!==g&&"sendonly"!==g?delete b.rtpReceiver:(R=S.track,v?(s[v.stream]||(s[v.stream]=new e.MediaStream),addTrackToStreamAndFireEvent(R,s[v.stream]),o.push([R,S,s[v.stream]])):(s.default||(s.default=new e.MediaStream),addTrackToStreamAndFireEvent(R,s.default),o.push([R,S,s.default])))}}else{(b=i.transceivers[l]||i._createTransceiver(h)).mid=y,b.iceGatherer||(b.iceGatherer=i._createIceGatherer(l,d)),j.length&&"new"===b.iceTransport.state&&(!M||d&&0!==l?j.forEach(function(e){maybeAddCandidate(b.iceTransport,e)}):b.iceTransport.setRemoteCandidates(j)),k=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(k.codecs=k.codecs.filter(function(e){return"rtx"!==e.name})),E=b.sendEncodingParameters||[{ssrc:1001*(2*l+2)}];var N,I=!1;if("sendrecv"===g||"sendonly"===g){if(I=!b.rtpReceiver,S=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,h),I)R=S.track,v&&"-"===v.stream||(v?(s[v.stream]||(s[v.stream]=new e.MediaStream,Object.defineProperty(s[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(R,"id",{get:function(){return v.track}}),N=s[v.stream]):(s.default||(s.default=new e.MediaStream),N=s.default)),N&&(addTrackToStreamAndFireEvent(R,N),b.associatedRemoteMediaStreams.push(N)),o.push([R,S,N])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===b.rtpReceiver.track.id});r&&function removeTrackFromStreamAndFireEvent(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),b.associatedRemoteMediaStreams=[]);b.localCapabilities=k,b.remoteCapabilities=O,b.rtpReceiver=S,b.rtcpParameters=A,b.sendEncodingParameters=E,b.recvEncodingParameters=T,i._transceive(i.transceivers[l],!1,I)}}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===r.type?"active":"passive"),i._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(s).forEach(function(t){var r=s[t];if(r.getTracks().length){if(-1===i.remoteStreams.indexOf(r)){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i._dispatchEvent("addstream",n)})}o.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&fireAddTrack(i,t,n,[r])})}}),o.forEach(function(e){e[2]||fireAddTrack(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},r.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},r.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},r.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,s=r.transceivers.filter(function(e){return"video"===e.kind}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(i=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(s=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});i>0||s>0;)i>0&&(r._createTransceiver("audio"),i--),s>0&&(r._createTransceiver("video"),s--);var a=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,s){var o=i.track,a=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(s,r.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=i.sendEncodingParameters||[{ssrc:1001*(2*s+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=u,i.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){a+=writeMediaSection(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,a+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:a});return Promise.resolve(c)},r.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var i=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(i+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n";var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var o;if(e.stream)"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var a=getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);!a.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=writeMediaSection(e,a,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var o=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(o)},r.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,s){if(!r._remoteDescription)return s(makeError("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<r.transceivers.length;a++)if(r.transceivers[a].mid===e.sdpMid){o=a;break}var c=r.transceivers[o];if(!c)return s(makeError("OperationError","Can not add ICE candidate"));if(c.rejected)return i();var u=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===o||o>0&&c.iceTransport!==r.transceivers[0].iceTransport)&&!maybeAddCandidate(c.iceTransport,u))return s(makeError("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[o]+="a="+(u.type?d:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var l=0;l<r.transceivers.length&&(r.transceivers[l].rejected||(r.transceivers[l].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[l]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));l++);i()})},r.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw makeError("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=function fixStatsType(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[r]),t.set(r,e[r])}),t})}}});var i=["createOffer","createAnswer"];return i.forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(i=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),r}},{sdp:75}],71:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],72:[function(e,t,r){var n=e("./parser"),i=e("./writer");r.write=i,r.parse=n.parse,r.parseParams=n.parseParams,r.parseFmtpConfig=n.parseFmtpConfig,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":73,"./writer":74}],73:[function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var s=0;s<r.length;s+=1)null!=e[s+1]&&(t[r[s]]=n(e[s+1]))}(r.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=e("./grammar"),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach(function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var c=s[t][a];if(c.reg.test(o))return i(c,n,o)}}),t.media=r,t};var a=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":71}],74:[function(e,t,r){var n=e("./grammar"),i=/%[sdv%]/g,s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var s=0;s<t.names.length;s+=1){var o=t.names[s];t.name?n.push(r[t.name][o]):n.push(r[t.names[s]])}else n.push(r[t.name]);return function(e){var t=1,r=arguments,n=r.length;return e.replace(i,function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,n)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||o,i=t.innerOrder||a,c=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(s(t,r,e))})})}),e.media.forEach(function(e){c.push(s("m",n.m[0],e)),i.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(s(t,r,e))})})})}),c.join("\r\n")+"\r\n"}},{"./grammar":71}],75:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,t){return n.matchPrefix(e+t,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(e,t){var r=n.matchPrefix(e+t,"a=ice-ufrag:")[0],i=n.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var s=r[i],o=n.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=n.parseRtpMap(o),c=n.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?n.parseFmtp(c[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),s&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var s=n.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,r=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var s=n.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var o=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,s=void 0!==t?t:2;return i=e||n.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}],76:[function(e,t,r){"use strict";function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Object.defineProperty(r,"__esModule",{value:!0}),r.Backoff=void 0,r.Backoff=Backoff,Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e}},{}],77:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.connect=r.io=r.Socket=r.Manager=r.protocol=void 0;const i=e("./url.js"),s=e("./manager.js");Object.defineProperty(r,"Manager",{enumerable:!0,get:function(){return s.Manager}});const o=e("./socket.js");Object.defineProperty(r,"Socket",{enumerable:!0,get:function(){return o.Socket}});const a=n(e("debug")).default("socket.io-client"),c={};function lookup(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const r=i.url(e,t.path||"/socket.io"),n=r.source,o=r.id,u=r.path,d=c[o]&&u in c[o].nsps;let l;return t.forceNew||t["force new connection"]||!1===t.multiplex||d?(a("ignoring socket cache for %s",n),l=new s.Manager(n,t)):(c[o]||(a("new io instance for %s",n),c[o]=new s.Manager(n,t)),l=c[o]),r.query&&!t.query&&(t.query=r.queryKey),l.socket(r.path,t)}r.io=lookup,r.connect=lookup,r.default=lookup,Object.assign(lookup,{Manager:s.Manager,Socket:o.Socket,io:lookup,connect:lookup});var u=e("socket.io-parser");Object.defineProperty(r,"protocol",{enumerable:!0,get:function(){return u.protocol}}),t.exports=lookup},{"./manager.js":78,"./socket.js":80,"./url.js":81,debug:82,"socket.io-parser":85}],78:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Manager=void 0;const a=e("engine.io-client"),c=e("./socket.js"),u=s(e("socket.io-parser")),d=e("./on.js"),l=e("./contrib/backo2.js"),p=e("@socket.io/component-emitter"),h=o(e("debug")).default("socket.io-client:manager");r.Manager=class Manager extends p.Emitter{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,a.installTimerFunctions(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new l.Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||u;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(h("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;h("opening %s",this.uri),this.engine=new a.Socket(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=d.on(t,"open",function(){r.onopen(),e&&e()}),i=d.on(t,"error",t=>{h("error"),r.cleanup(),r._readyState="closed",this.emitReserved("error",t),e?e(t):r.maybeReconnectOnOpen()});if(!1!==this._timeout){const e=this._timeout;h("connect attempt will timeout after %d",e),0===e&&n();const r=this.setTimeoutFn(()=>{h("connect attempt timed out after %d",e),n(),t.close(),t.emit("error",new Error("timeout"))},e);this.opts.autoUnref&&r.unref(),this.subs.push(function subDestroy(){clearTimeout(r)})}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){h("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(d.on(e,"ping",this.onping.bind(this)),d.on(e,"data",this.ondata.bind(this)),d.on(e,"error",this.onerror.bind(this)),d.on(e,"close",this.onclose.bind(this)),d.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){a.nextTick(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){h("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new c.Socket(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return void h("socket %s is still active, skipping close",e);this._close()}_packet(e){h("writing packet %j",e);const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){h("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){h("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){h("closed due to %s",e),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)h("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();h("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(h("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(h("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(h("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function subDestroy(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}},{"./contrib/backo2.js":76,"./on.js":79,"./socket.js":80,"@socket.io/component-emitter":34,debug:82,"engine.io-client":44,"socket.io-parser":85}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.on=void 0,r.on=function on(e,t,r){return e.on(t,r),function subDestroy(){e.off(t,r)}}},{}],80:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Socket=void 0;const i=e("socket.io-parser"),s=e("./on.js"),o=e("@socket.io/component-emitter"),a=n(e("debug")).default("socket.io-client:socket"),c=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});r.Socket=class Socket extends o.Emitter{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[s.on(e,"open",this.onopen.bind(this)),s.on(e,"packet",this.onpacket.bind(this)),s.on(e,"error",this.onerror.bind(this)),s.on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(c.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:i.PacketType.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++;a("emitting packet with ack id %d",e);const n=t.pop();this._registerAckCallback(e,n),r.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return!this.flags.volatile||n&&this.connected?this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r):a("discard packet as the transport is not currently writable"),this.flags={},this}_registerAckCallback(e,t){var r;const n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&(a("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(t,1));a("event with ack id %d has timed out after %d ms",e,n),t.call(this,new Error("operation has timed out"))},n);this.acks[e]=((...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])})}emitWithAck(e,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((n,i)=>{t.push((e,t)=>r?e?i(e):n(t):n(e)),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...n)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(a("packet [%d] is discarded after %d tries",r.id,r.tryCount),this._queue.shift(),t&&t(e)):(a("packet [%d] was successfully sent",r.id),this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(a("draining queue"),!this.connected||0===this._queue.length)return;const t=this._queue[0];!t.pending||e?(t.pending=!0,t.tryCount++,a("sending packet [%d] (try n°%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)):a("packet [%d] has already been sent and is waiting for an ack",t.id)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){a("transport is open - connecting"),"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:i.PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){a("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case i.PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case i.PacketType.EVENT:case i.PacketType.BINARY_EVENT:this.onevent(e);break;case i.PacketType.ACK:case i.PacketType.BINARY_ACK:this.onack(e);break;case i.PacketType.DISCONNECT:this.ondisconnect();break;case i.PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];a("emitting event %j",t),null!=e.id&&(a("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,a("sending ack %j",n),t.packet({type:i.PacketType.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(a("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):a("bad ack %s",e.id)}onconnect(e,t){a("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:i.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}},{"./on.js":79,"@socket.io/component-emitter":34,debug:82,"socket.io-parser":85}],81:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.url=void 0;const i=e("engine.io-client"),s=n(e("debug")).default("socket.io-client:url");r.url=function url(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(s("protocol-less url %s",e),e=void 0!==r?r.protocol+"//"+e:"https://"+e),s("parse %s",e),n=i.parse(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+t,n.href=n.protocol+"://"+o+(r&&r.port===n.port?"":":"+n.port),n}},{debug:82,"engine.io-client":44}],82:[function(e,t,r){(function(n){(function(){r.formatArgs=function formatArgs(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&"%c"===e&&(i=++n)}),e.splice(i,0,r)},r.save=function save(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function load(){let e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},r.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function localstorage(){try{return localStorage}catch(e){}}(),r.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(r);const{formatters:i}=t.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":83,_process:65}],83:[function(e,t,r){t.exports=function setup(t){function createDebug(e){let t,r,n,i=null;function debug(...e){if(!debug.enabled)return;const r=debug,n=Number(new Date),i=n-(t||n);r.diff=i,r.prev=t,r.curr=n,t=n,e[0]=createDebug.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,n)=>{if("%%"===t)return"%";s++;const i=createDebug.formatters[n];if("function"==typeof i){const n=e[s];t=i.call(r,n),e.splice(s,1),s--}return t}),createDebug.formatArgs.call(r,e),(r.log||createDebug.log).apply(r,e)}return debug.namespace=e,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(e),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(r!==createDebug.namespaces&&(r=createDebug.namespaces,n=createDebug.enabled(e)),n),set:e=>{i=e}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(e,t){const r=createDebug(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function toNamespace(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(e){return e instanceof Error?e.stack||e.message:e},createDebug.disable=function disable(){const e=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(e=>"-"+e)].join(",");return createDebug.enable(""),e},createDebug.enable=function enable(e){let t;createDebug.save(e),createDebug.namespaces=e,createDebug.names=[],createDebug.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+e.slice(1)+"$")):createDebug.names.push(new RegExp("^"+e+"$")))},createDebug.enabled=function enabled(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=createDebug.skips.length;t<r;t++)if(createDebug.skips[t].test(e))return!1;for(t=0,r=createDebug.names.length;t<r;t++)if(createDebug.names[t].test(e))return!0;return!1},createDebug.humanize=e("ms"),createDebug.destroy=function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{createDebug[e]=t[e]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=function selectColor(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return createDebug.colors[Math.abs(t)%createDebug.colors.length]},createDebug.enable(createDebug.load()),createDebug}},{ms:64}],84:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reconstructPacket=r.deconstructPacket=void 0;const n=e("./is-binary.js");r.deconstructPacket=function deconstructPacket(e){const t=[],r=e.data,i=e;return i.data=function _deconstructPacket(e,t){if(!e)return e;if((0,n.isBinary)(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=_deconstructPacket(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=_deconstructPacket(e[n],t));return r}return e}(r,t),i.attachments=t.length,{packet:i,buffers:t}},r.reconstructPacket=function reconstructPacket(e,t){return e.data=function _reconstructPacket(e,t){if(!e)return e;if(e&&!0===e._placeholder){const r="number"==typeof e.num&&e.num>=0&&e.num<t.length;if(r)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=_reconstructPacket(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=_reconstructPacket(e[r],t));return e}(e.data,t),delete e.attachments,e}},{"./is-binary.js":86}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Decoder=r.Encoder=r.PacketType=r.protocol=void 0;const n=e("@socket.io/component-emitter"),i=e("./binary.js"),s=e("./is-binary.js"),o=(0,e("debug").default)("socket.io-parser"),a=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var c;r.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(c=r.PacketType||(r.PacketType={}));function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}r.Encoder=class Encoder{constructor(e){this.replacer=e}encode(e){return o("encoding packet %j",e),e.type!==c.EVENT&&e.type!==c.ACK||!(0,s.hasBinary)(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===c.EVENT?c.BINARY_EVENT:c.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==c.BINARY_EVENT&&e.type!==c.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),o("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=(0,i.deconstructPacket)(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}};class Decoder extends n.Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");const r=(t=this.decodeString(e)).type===c.BINARY_EVENT;r||t.type===c.BINARY_ACK?(t.type=r?c.EVENT:c.ACK,this.reconstructor=new BinaryReconstructor(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!(0,s.isBinary)(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===c[r.type])throw new Error("unknown packet type "+r.type);if(r.type===c.BINARY_EVENT||r.type===c.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Decoder.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return o("decoded %s as %j",e,r),r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case c.CONNECT:return isObject(t);case c.DISCONNECT:return void 0===t;case c.CONNECT_ERROR:return"string"==typeof t||isObject(t);case c.EVENT:case c.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===a.indexOf(t[0]));case c.ACK:case c.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}r.Decoder=Decoder;class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=(0,i.reconstructPacket)(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},{"./binary.js":84,"./is-binary.js":86,"@socket.io/component-emitter":34,debug:36}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.hasBinary=r.isBinary=void 0;const n="function"==typeof ArrayBuffer,i=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,s=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);function isBinary(e){return n&&(e instanceof ArrayBuffer||i(e))||o&&e instanceof Blob||a&&e instanceof File}r.isBinary=isBinary,r.hasBinary=function hasBinary(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(hasBinary(e[t]))return!0;return!1}if(isBinary(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return hasBinary(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&hasBinary(e[t]))return!0;return!1}},{}],87:[function(e,t,r){var n=e("./v1"),i=e("./v4"),s=i;s.v1=n,s.v4=i,t.exports=s},{"./v1":90,"./v4":91}],88:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function bytesToUuid(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},{}],89:[function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function whatwgRNG(){return n(i),i}}else{var s=new Array(16);t.exports=function mathRNG(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}},{}],90:[function(e,t,r){var n,i,s=e("./lib/rng"),o=e("./lib/bytesToUuid"),a=0,c=0;t.exports=function v1(e,t,r){var u=t&&r||0,d=t||[],l=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:i;if(null==l||null==p){var h=s();null==l&&(l=n=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=i=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:c+1,g=f-a+(m-c)/1e4;if(g<0&&void 0===e.clockseq&&(p=p+1&16383),(g<0||f>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=m,i=p;var v=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;d[u++]=v>>>24&255,d[u++]=v>>>16&255,d[u++]=v>>>8&255,d[u++]=255&v;var y=f/4294967296*1e4&268435455;d[u++]=y>>>8&255,d[u++]=255&y,d[u++]=y>>>24&15|16,d[u++]=y>>>16&255,d[u++]=p>>>8|128,d[u++]=255&p;for(var b=0;b<6;++b)d[u+b]=l[b];return t||o(d)}},{"./lib/bytesToUuid":88,"./lib/rng":89}],91:[function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function v4(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||n)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[s+a]=o[a];return t||i(o)}},{"./lib/bytesToUuid":88,"./lib/rng":89}],92:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});r.default=n},{"./adapter_factory.js":93}],93:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function adapterFactory(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,u=n.detectBrowser(e),d={browserDetails:u,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),d;if(null===u.version)return r("Chrome shim can not determine version, not shimming."),d;r("adapter.js shimming chrome."),d.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!o||!o.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=o,o.shimGetUserMedia(e),o.shimPeerConnection(e),o.shimOnTrack(e),o.shimRemoveStream(e),o.shimSenderGetStats(e),o.shimReceiverGetStats(e),o.shimRTCDataChannel(e),o.shimAddTransceiver(e),o.shimGetParameters(e),o.shimCreateOffer(e),o.shimCreateAnswer(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!s||!s.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),d;r("adapter.js shimming edge."),d.browserShim=s,s.shimGetUserMedia(e),s.shimGetDisplayMedia(e),s.shimPeerConnection(e),s.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),a.shimAudioContext(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return d};var n=_interopRequireWildcard(e("./utils")),i=_interopRequireWildcard(e("./chrome/chrome_shim")),s=_interopRequireWildcard(e("./edge/edge_shim")),o=_interopRequireWildcard(e("./firefox/firefox_shim")),a=_interopRequireWildcard(e("./safari/safari_shim")),c=_interopRequireWildcard(e("./common_shim"));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":94,"./common_shim":97,"./edge/edge_shim":98,"./firefox/firefox_shim":102,"./safari/safari_shim":105,"./utils":106}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function get(){return i.shimGetUserMedia}});var s=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function get(){return s.shimGetDisplayMedia}}),r.shimMediaStream=function shimMediaStream(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function shimOnTrack(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)o.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function get(){return this._ontrack},set:function set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var s=new Event("track");s.track=n.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],r.dispatchEvent(s)}),t.stream.getTracks().forEach(function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],r.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function shimGetSendersWithDtmf(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function shimSenderWithDtmf(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function getSenders(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function addTrack(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function removeTrack(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function addStream(e){var r=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function removeStream(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function getSenders(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function shimGetStats(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function getStats(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],s=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var o=function fixChromeStats_(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function makeMapStats(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return t.apply(this,[function successCallbackWrapper_(e){i(a(o(e)))},n])}return new Promise(function(r,n){t.apply(e,[function(e){r(a(o(e)))},n])}).then(i,s)}},r.shimSenderReceiverGetStats=function shimSenderReceiverGetStats(e){if(!("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function getSenders(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function addTrack(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function getStats(){var e=this;return this._pc.getStats().then(function(t){return o.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function getReceivers(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function getStats(){var e=this;return this._pc.getStats().then(function(t){return o.filterStats(t,e.track,!1)})}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function getStats(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}},r.shimAddTrackRemoveTrackWithNative=shimAddTrackRemoveTrackWithNative,r.shimAddTrackRemoveTrack=function shimAddTrackRemoveTrack(e){if(!e.RTCPeerConnection)return;var t=o.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function addStream(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;function replaceInternalStreamId(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function removeStream(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function addTrack(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var s=this.getSenders().find(function(e){return e.track===t});if(s)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty({},t,function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=replaceInternalStreamId(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return replaceInternalStreamId(e,t)})});e.RTCPeerConnection.prototype[t]=n[t]});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function setLocalDescription(){return arguments.length&&arguments[0].type?(arguments[0]=function replaceExternalStreamId(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function get(){var e=a.get.apply(this);return""===e.type?e:replaceInternalStreamId(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function removeTrack(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r=e._pc===this;if(!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(r){var i=t._streams[r].getTracks().find(function(t){return e.track===t});i&&(n=t._streams[r])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}},r.shimPeerConnection=function shimPeerConnection(e){var t=o.detectBrowser(e);!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection);if(!e.RTCPeerConnection)return;var r=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function addIceCandidate(){return r||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},r.fixNegotiationNeeded=function fixNegotiationNeeded(e){var t=o.detectBrowser(e);o.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})};var o=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function shimAddTrackRemoveTrackWithNative(e){e.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function addTrack(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function addStream(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function removeStream(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function removeTrack(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}},{"../utils.js":106,"./getdisplaymedia":95,"./getusermedia":96}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function shimGetDisplayMedia(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function getDisplayMedia(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})}}},{}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function shimGetUserMedia(e){var t=e&&e.navigator;if(!t.mediaDevices)return;var r=i.detectBrowser(e),o=function constraintsToChrome_(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var s=function oldname_(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var o={};"number"==typeof i.ideal?(o[s("min",r)]=i.ideal,t.optional.push(o),(o={})[s("max",r)]=i.ideal,t.optional.push(o)):(o[s("",r)]=i.ideal,t.optional.push(o))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function shimConstraints_(e,i){if(r.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var a=function remap(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var u=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||u)){delete e.video.facingMode;var d=void 0;if("environment"===c.exact||"environment"===c.ideal?d=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return d.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&d.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),s("chrome: "+JSON.stringify(e)),i(e)})}e.video=o(e.video)}return s("chrome: "+JSON.stringify(e)),i(e)},c=function shimError_(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function getUserMedia_(e,r,n){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){n&&n(c(e))})})}.bind(t),t.mediaDevices.getUserMedia){var u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}};var i=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));var s=i.log},{"../utils.js":106}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function shimRTCIceCandidate(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;var t=e.RTCIceCandidate;e.RTCIceCandidate=function RTCIceCandidate(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),s=i.default.parseCandidate(e.candidate),o=Object.assign(r,s);return o.toJSON=function toJSON(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})},r.shimMaxMessageSize=function shimMaxMessageSize(e){if(!e.RTCPeerConnection)return;var t=s.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function get(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),n=e.sdpSemantics;"plan-b"===n&&Object.defineProperty(this,"sctp",{get:function get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function sctpInDescription(e){if(!e||!e.sdp)return!1;var t=i.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=i.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var s=function getRemoteFirefoxVersion(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),o=function getCanSendMaxMessageSize(e){var r=65536;"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637);return r}(s),a=function getMaxMessageSize(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var s=i.default.matchPrefix(e.sdp,"a=max-message-size:");s.length>0?n=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637);return n}(arguments[0],s),c=void 0;c=0===o&&0===a?Number.POSITIVE_INFINITY:0===o||0===a?Math.max(o,a):Math.min(o,a);var u={};Object.defineProperty(u,"maxMessageSize",{get:function get(){return c}}),this._sctp=u}return r.apply(this,arguments)}},r.shimSendThrowTypeError=function shimSendThrowTypeError(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function wrapDcSend(e,t){var r=e.send;e.send=function send(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function createDataChannel(){var e=t.apply(this,arguments);return wrapDcSend(e,this),e},s.wrapPeerConnectionEvent(e,"datachannel",function(e){return wrapDcSend(e.channel,e.target),e})},r.shimConnectionState=function shimConnectionState(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function get(){return this._onconnectionstatechange||null},set:function set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})},r.removeAllowExtmapMixed=function removeAllowExtmapMixed(e){if(!e.RTCPeerConnection)return;var t=s.detectBrowser(e);if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}};var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(e("sdp")),s=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":106,sdp:75}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function get(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function get(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function shimPeerConnection(e){var t=s.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function RTCIceCandidate(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function RTCSessionDescription(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function set(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,a.default)(e,t.version);e.RTCPeerConnection=function RTCPeerConnection(e){return e&&e.iceServers&&(e.iceServers=(0,o.filterIceServers)(e.iceServers,t.version),s.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},r.shimReplaceTrack=function shimReplaceTrack(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var s=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),o=e("./filtericeservers"),a=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(e("rtcpeerconnection-shim"))},{"../utils":106,"./filtericeservers":99,"./getdisplaymedia":100,"./getusermedia":101,"rtcpeerconnection-shim":70}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function filterIceServers(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=i?t[0]:t,!!t.length}})};var n=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":106}],100:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function shimGetDisplayMedia(e){if(!("getDisplayMedia"in e.navigator))return;if(!e.navigator.mediaDevices)return;if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},{}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function shimGetUserMedia(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function shimError_(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function toString(){return this.name}}}(e))})}}},{}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function get(){return i.shimGetUserMedia}});var s=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function get(){return s.shimGetDisplayMedia}}),r.shimOnTrack=function shimOnTrack(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function get(){return{receiver:this.receiver}}})},r.shimPeerConnection=function shimPeerConnection(e){var t=o.detectBrowser(e);if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection);t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=function _defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});if(t.version<68){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function addIceCandidate(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function getStats(){var e=Array.prototype.slice.call(arguments),r=e[0],n=e[1],o=e[2];return s.apply(this,[r||null]).then(function(e){if(t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,o)}},r.shimSenderGetStats=function shimSenderGetStats(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function getSenders(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function addTrack(){var e=r.apply(this,arguments);return e._pc=this,e});e.RTCRtpSender.prototype.getStats=function getStats(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},r.shimReceiverGetStats=function shimReceiverGetStats(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function getReceivers(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function getStats(){return this._pc.getStats(this.track)}},r.shimRemoveStream=function shimRemoveStream(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function removeStream(e){var t=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})}},r.shimRTCDataChannel=function shimRTCDataChannel(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function shimAddTransceiver(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function addTransceiver(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var i=n.sender,s=i.getParameters();"encodings"in s&&(1!==s.encodings.length||0!==Object.keys(s.encodings[0]).length)||(s.encodings=e.sendEncodings,i.sendEncodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(s).then(function(){delete i.sendEncodings}).catch(function(){delete i.sendEncodings})))}return n})},r.shimGetParameters=function shimGetParameters(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCRtpSender)return;var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function getParameters(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},r.shimCreateOffer=function shimCreateOffer(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function createOffer(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}},r.shimCreateAnswer=function shimCreateAnswer(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function createAnswer(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}};var o=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":106,"./getdisplaymedia":103,"./getusermedia":104}],103:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function shimGetDisplayMedia(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=function getDisplayMedia(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)}}},{}],104:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function shimGetUserMedia(e){var t=i.detectBrowser(e),r=e&&e.navigator,s=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var o=function remap(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),o(e.audio,"autoGainControl","mozAutoGainControl"),o(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},s&&s.prototype.getSettings){var c=s.prototype.getSettings;s.prototype.getSettings=function(){var e=c.apply(this,arguments);return o(e,"mozAutoGainControl","autoGainControl"),o(e,"mozNoiseSuppression","noiseSuppression"),e}}if(s&&s.prototype.applyConstraints){var u=s.prototype.applyConstraints;s.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),o(e,"autoGainControl","mozAutoGainControl"),o(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}};var i=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":106}],105:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function shimLocalStreamsAPI(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function addStream(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(n){return t.call(r,n,e)}),e.getVideoTracks().forEach(function(n){return t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function addTrack(e){for(var r=this,n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i&&i.forEach(function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function removeStream(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})},r.shimRemoteStreamsAPI=function shimRemoteStreamsAPI(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function getRemoteStreams(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function get(){return this._onaddstream},set:function set(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function shimCallbacksAPI(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function createOffer(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function createAnswer(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var c=function withCallback(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function withCallback(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function withCallback(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c},r.shimGetUserMedia=function shimGetUserMedia(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(shimConstraints(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function getUserMedia(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))},r.shimConstraints=shimConstraints,r.shimRTCIceServerUrls=function shimRTCIceServerUrls(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection;e.RTCPeerConnection=function RTCPeerConnection(e,r){if(e&&e.iceServers){for(var n=[],s=0;s<e.iceServers.length;s++){var o=e.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[s])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function get(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function shimTrackEventTransceiver(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function get(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function shimCreateOfferLegacy(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function createOffer(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}},r.shimAudioContext=function shimAudioContext(e){if("object"!==(void 0===e?"undefined":n(e))||e.AudioContext)return;e.AudioContext=e.webkitAudioContext};var i=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function shimConstraints(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":106}],106:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=extractVersion,r.wrapPeerConnectionEvent=function wrapPeerConnectionEvent(e,t,r){if(!e.RTCPeerConnection)return;var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var s=function wrappedCallback(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),i.apply(this,[e,s])};var s=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(r))return s.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function get(){return this["_on"+t]},set:function set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})},r.disableLog=function disableLog(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.");return i=e,e?"adapter.js logging disabled":"adapter.js logging enabled"},r.disableWarnings=function disableWarnings(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.");return s=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")},r.log=function log(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function deprecated(e,t){if(!s)return;console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function detectBrowser(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=extractVersion(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=extractVersion(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=extractVersion(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=extractVersion(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},r.compactObject=function compactObject(e){if(!isObject(e))return e;return Object.keys(e).reduce(function(t,r){var n=isObject(e[r]),i=n?compactObject(e[r]):e[r],s=n&&!Object.keys(i).length;return void 0===i||s?t:Object.assign(t,function _defineProperty(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},r,i))},{})},r.walkStats=walkStats,r.filterStats=function filterStats(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var s=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&walkStats(e,r,i)})}),i};var i=!0,s=!0;function extractVersion(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function walkStats(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?walkStats(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){walkStats(e,e.get(t),r)})}))}},{}],107:[function(e,t,r){function WildEmitter(){}t.exports=WildEmitter,WildEmitter.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,i=n?arguments[1]:void 0,s=n?arguments[2]:arguments[1];return s._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(s),this},t.once=function(e,t,r){var n=this,i=3===arguments.length,s=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];return this.on(e,s,function on(){n.off(e,on),o.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,r,n,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=0,n=(i=this.callbacks[t]).length;r<n;r++)i[r]._groupName===e&&(i.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(-1!==(r=n.indexOf(t))&&(n.splice(r,1),0===n.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,i=[].slice.call(arguments,1),s=this.callbacks[e],o=this.getWildcardCallbacks(e);if(s)for(t=0,r=(n=s.slice()).length;t<r&&n[t];++t)n[t].apply(this,i);if(o)for(r=o.length,t=0,r=(n=o.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split("*"),("*"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},WildEmitter.mixin(WildEmitter)},{}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,26,25,27,28,30,29,31]);