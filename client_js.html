<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="./node_modules/nexmo-client/dist/nexmoClient.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>Gate Control App</h1>
    <label for="phone-number">Your Phone Number:</label>
    <input
      type="text"
      name="phone-number"
      value="19174146014"
      placeholder="i.e. 14155550100"
      id="phone-number"
      size="30"
    />
    <button id="call">Unlock Gate</button>
    <button type="button" id="hangup">Hang Up</button>
    <div id="status"></div>
    <script>
      const USER_JWT =
        "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3MDAwNTgyMjMsImp0aSI6Ijk0YzA3OTAwLTgzYzItMTFlZS04ZjY0LWRmNjgwZTJkMmFhYiIsImFwcGxpY2F0aW9uX2lkIjoiNzg2OTA1NzgtZjRkOC00YjFiLTk0NzYtZjI2YjdmMTA2ODg1Iiwic3ViIjoiUGFwdW5hIiwiZXhwIjoxNzAwMDU4MjQ1MzU5LCJhY2wiOnsicGF0aHMiOnsiLyovdXNlcnMvKioiOnt9LCIvKi9jb252ZXJzYXRpb25zLyoqIjp7fSwiLyovc2Vzc2lvbnMvKioiOnt9LCIvKi9kZXZpY2VzLyoqIjp7fSwiLyovaW1hZ2UvKioiOnt9LCIvKi9tZWRpYS8qKiI6e30sIi8qL2FwcGxpY2F0aW9ucy8qKiI6e30sIi8qL3B1c2gvKioiOnt9LCIvKi9rbm9ja2luZy8qKiI6e30sIi8qL2xlZ3MvKioiOnt9fX19.Gp_G4ucE-MdDvGVashDuu5JmkeJIHUor8sRorEQiMw4nq33JlsWfJE9IqDLs7Xa0eSgrVqXVaba95Lv33BrZd1hiQJxejeAxU4vEgvvP2u5KJiRplapMtTDIL8yEwww7c5RJvRM0s035DYqYmLTnQDYWrINyMSOYv22EsNbO_aoSE9ahpz-1XeK16WJ8Yr2npWgljZEBIBvQs5YovHOy6X10pUOZdkzo0ry_HM1sD1_QgzKbDxYi0pkXKCx9ji2k_oH-g0B3DZbftYF2zOHgLVSqEz4Te1y0DC6LevH9h4-0td5JS1-x74h0uQbjFEIx6kGp-AQViHn5xBMT9fInjQ";

      const callButton = document.getElementById("call");
      const hangupButton = document.getElementById("hangup");
      const statusElement = document.getElementById("status");
      new NexmoClient({ debug: true })
        .createSession(USER_JWT)
        .then((app) => {
          callButton.addEventListener("click", (event) => {
            event.preventDefault();
            let destination = document.getElementById("phone-number").value;
            if (destination !== "") {
              app.callServer(destination);
            } else {
              statusElement.innerText = "Please enter your phone number.";
            }
          });
          app.on("member:call", (member, call) => {
            hangupButton.addEventListener("click", () => {
              call.hangUp();
            });
          });
          app.on("call:status:changed", (call) => {
            statusElement.innerText = `Call status: ${call.status}`;
            if (call.status === call.CALL_STATUS.STARTED) {
              callButton.style.display = "none";
              hangupButton.style.display = "inline";
            }
            if (call.status === call.CALL_STATUS.COMPLETED) {
              callButton.style.display = "inline";
              hangupButton.style.display = "none";
            }
          });
        })
        .catch(console.error);
    </script>
  </body>
</html>
